"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const vscode_languageserver_protocol_1=require("vscode-languageserver-protocol"),lspUtil_1=require("../../base/lspUtil"),type_resolve_1=require("../common/type-resolve"),htmlDataUtils_1=require("../tool/htmlDataUtils"),index_1=require("./index"),{positionKeywords:positionKeywords,repeatStyleKeywords:repeatStyleKeywords,lineStyleKeywords:lineStyleKeywords,lineWidthKeywords:lineWidthKeywords,geometryBoxKeywords:geometryBoxKeywords,boxKeywords:boxKeywords,imageFunctions:imageFunctions,transitionTimingFunctions:transitionTimingFunctions,basicShapeFunctions:basicShapeFunctions}=require("vscode-css-languageservice/lib/umd/languageFacts/builtinData"),{colors:colors,colorKeywords:colorKeywords,colorFunctions:colorFunctions}=require("vscode-css-languageservice/lib/umd/languageFacts/colors"),dataProvider=(0,htmlDataUtils_1.cssDataProvider)();function getColorProposals(e,o){for(const t in colors)e.push({label:t,documentation:colors[t],textEdit:o?vscode_languageserver_protocol_1.TextEdit.replace(o,t):void 0,kind:vscode_languageserver_protocol_1.CompletionItemKind.Color});for(const t in colorKeywords)e.push({label:t,documentation:colorKeywords[t],textEdit:o?vscode_languageserver_protocol_1.TextEdit.replace(o,t):void 0,kind:vscode_languageserver_protocol_1.CompletionItemKind.Value});for(const t of colorFunctions){let r=1;const n=(e,o)=>"${"+r+++":"+o+"}",s=t.func.replace(/\[?\$(\w+)\]?/g,n);e.push({label:t.func.substring(0,t.func.indexOf("(")),detail:t.func,documentation:t.desc,textEdit:o?vscode_languageserver_protocol_1.TextEdit.replace(o,s):void 0,insertTextFormat:vscode_languageserver_protocol_1.InsertTextFormat.Snippet,kind:vscode_languageserver_protocol_1.CompletionItemKind.Function})}return e}function getPositionProposals(e,o){for(const t in positionKeywords)e.push({label:t,documentation:positionKeywords[t],textEdit:o?vscode_languageserver_protocol_1.TextEdit.replace(o,t):void 0,kind:vscode_languageserver_protocol_1.CompletionItemKind.Value});return e}function getRepeatStyleProposals(e,o){for(const t in repeatStyleKeywords)e.push({label:t,documentation:repeatStyleKeywords[t],textEdit:o?vscode_languageserver_protocol_1.TextEdit.replace(o,t):void 0,kind:vscode_languageserver_protocol_1.CompletionItemKind.Value});return e}function getLineStyleProposals(e,o){for(const t in lineStyleKeywords)e.push({label:t,documentation:lineStyleKeywords[t],textEdit:o?vscode_languageserver_protocol_1.TextEdit.replace(o,t):void 0,kind:vscode_languageserver_protocol_1.CompletionItemKind.Value});return e}function getLineWidthProposals(e,o){for(const t of lineWidthKeywords)e.push({label:t,textEdit:o?vscode_languageserver_protocol_1.TextEdit.replace(o,t):void 0,kind:vscode_languageserver_protocol_1.CompletionItemKind.Value});return e}function getGeometryBoxProposals(e,o){for(const t in geometryBoxKeywords)e.push({label:t,documentation:geometryBoxKeywords[t],textEdit:o?vscode_languageserver_protocol_1.TextEdit.replace(o,t):void 0,kind:vscode_languageserver_protocol_1.CompletionItemKind.Value});return e}function getBoxProposals(e,o){for(const t in boxKeywords)e.push({label:t,documentation:boxKeywords[t],textEdit:o?vscode_languageserver_protocol_1.TextEdit.replace(o,t):void 0,kind:vscode_languageserver_protocol_1.CompletionItemKind.Value});return e}function moveCursorInsideParenthesis(e){return e.replace(/\(\)$/,"($1)")}function getImageProposals(e,o){for(const t in imageFunctions){const r=moveCursorInsideParenthesis(t);e.push({label:t,documentation:imageFunctions[t],textEdit:o?vscode_languageserver_protocol_1.TextEdit.replace(o,r):void 0,kind:vscode_languageserver_protocol_1.CompletionItemKind.Function,insertTextFormat:t!==r?vscode_languageserver_protocol_1.InsertTextFormat.Snippet:void 0})}return e}function getBasicShapeProposals(e,o){for(const t in basicShapeFunctions){const r=moveCursorInsideParenthesis(t);e.push({label:t,documentation:basicShapeFunctions[t],textEdit:o?vscode_languageserver_protocol_1.TextEdit.replace(o,r):void 0,kind:vscode_languageserver_protocol_1.CompletionItemKind.Function,insertTextFormat:t!==r?vscode_languageserver_protocol_1.InsertTextFormat.Snippet:void 0})}return e}function getTimingFunctionProposals(e,o){for(const t in transitionTimingFunctions){const r=moveCursorInsideParenthesis(t);e.push({label:t,documentation:transitionTimingFunctions[t],textEdit:o?vscode_languageserver_protocol_1.TextEdit.replace(o,r):void 0,kind:vscode_languageserver_protocol_1.CompletionItemKind.Function,insertTextFormat:t!==r?vscode_languageserver_protocol_1.InsertTextFormat.Snippet:void 0})}return e}class CssPropertyValueHandler{doComplete(e,o,t,r,n,s){var i,a;let l=t.ast,c=e.offsetAt(o),d=(0,type_resolve_1.getTokenAtPosition)(l,c);if(!d)return[];let u="",p=d.parent,g=r.get(index_1.LanguageServiceType.TS);if(p&&p.kind==g.SyntaxKind.CallExpression){let e=p.arguments,o=-1;for(let t=0;t<e.length;t++){let r=e[t];if(c>=r.getStart()&&c<=r.getEnd()){o=t-1;break}}if(o>=0){let t=e[o];t.kind==g.SyntaxKind.StringLiteral&&(u=t.getText(),"'"!==u[0]&&'"'!=u[0]||(u=u.slice(1,-1)))}}if(u){let e=dataProvider.provideProperties().find((e=>e.name==u));const o=t.range;if(e){let t=[];null===(i=e.values)||void 0===i||i.forEach((e=>{t.push({label:e.name,documentation:e.description,kind:vscode_languageserver_protocol_1.CompletionItemKind.Value,textEdit:o?vscode_languageserver_protocol_1.TextEdit.replace(o,e.name):void 0,data:{hxKind:lspUtil_1.HxIconKind.ATTRIBUTE}})}));e.restrictions;return null===(a=e.restrictions)||void 0===a||a.forEach((e=>{let r=[];switch(e){case"color":getColorProposals(r,o);break;case"position":getPositionProposals(r,o);break;case"repeat":getRepeatStyleProposals(r,o);break;case"line-style":getLineStyleProposals(r,o);break;case"line-width":getLineWidthProposals(r,o);break;case"geometry-box":getGeometryBoxProposals(r,o);break;case"box":getBoxProposals(r,o);break;case"image":getImageProposals(r,o);break;case"timing-function":getTimingFunctionProposals(r,o);break;case"shape":getBasicShapeProposals(r,o)}t.push(...r)})),t}}return[]}doCompleteResolve(e,o,t,r,n){return e}doHover(e,o,t,r){}doDefinition(e,o,t,r){return[]}doReference(e,o,t,r){return[]}}exports.default=CssPropertyValueHandler;