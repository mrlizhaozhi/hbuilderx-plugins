"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const fs=require("fs"),path=require("path"),vscode_languageserver_protocol_1=require("vscode-languageserver-protocol"),lspUtil_1=require("../../base/lspUtil"),uniCloudPath_1=require("../common/uniCloudPath");function getUniModuleValidateFunction(e,t){let i=path.join(t,(0,uniCloudPath_1.getUniModulesDir)());fs.existsSync(i)&&fs.statSync(i).isDirectory()&&fs.readdirSync(i).forEach((n=>{let r=path.join(i,n);if(fs.statSync(r).isDirectory()){let i=path.join(t,(0,uniCloudPath_1.getUniModuleValidate)(n,""));if(!fs.existsSync(i))return;if(!fs.statSync(i).isDirectory())return;fs.readdirSync(i).forEach((t=>{let n=path.join(i,t);fs.statSync(n).isFile()&&t.endsWith(".js")&&e.add(t.substr(0,t.lastIndexOf(".")))}))}}))}class ValidateFunctionHandler{doComplete(e,t,i,n,r,s){let o=[],a=new Set,l=i.project.fsPath;for(let e=0;e<uniCloudPath_1.providers.length;++e){let t=path.join(l,(0,uniCloudPath_1.getValidationRoot)(uniCloudPath_1.providers[e]));fs.existsSync(t)&&(fs.statSync(t).isDirectory()&&fs.readdirSync(t).forEach((e=>{let i=path.join(t,e);fs.statSync(i).isFile()&&e.endsWith(".js")&&a.add(e.substr(0,e.lastIndexOf(".")))})))}return getUniModuleValidateFunction(a,l),a.forEach((e=>{o.push({label:e,kind:vscode_languageserver_protocol_1.CompletionItemKind.File,documentation:e})})),o}doCompleteResolve(e,t,i,n,r){return e}doHover(e,t,i,n){}doDefinition(e,t,i,n){let r=i.project.fsPath,s=e.getText(i.range);for(let e=0;e<uniCloudPath_1.providers.length;++e){let t=path.join(r,(0,uniCloudPath_1.getValidationRoot)(uniCloudPath_1.providers[e]));if(!fs.existsSync(t))continue;if(!fs.statSync(t).isDirectory())continue;let n=fs.readdirSync(t);for(let e of n){let n=path.join(t,e);if(fs.statSync(n).isFile()&&e.endsWith(".js")){if(path.basename(n,".js")==s)return[{targetUri:n,targetRange:(0,lspUtil_1.getNullRange)(),targetSelectionRange:(0,lspUtil_1.getNullRange)(),originSelectionRange:i.range}]}}}let o=path.join(r,(0,uniCloudPath_1.getUniModulesDir)());if(!fs.existsSync(o))return;if(!fs.statSync(o).isDirectory())return;let a=fs.readdirSync(o);for(let e of a){let t=path.join(o,e);if(fs.statSync(t).isDirectory()){let t=path.join(r,(0,uniCloudPath_1.getUniModuleValidate)(e,""));if(!fs.existsSync(t))continue;if(!fs.statSync(t).isDirectory())continue;let n=fs.readdirSync(t);for(let e of n){let n=path.join(t,e);if(fs.statSync(n).isFile()&&e.endsWith(".js")){if(path.basename(n,".js")==s)return[{targetUri:n,targetRange:(0,lspUtil_1.getNullRange)(),targetSelectionRange:(0,lspUtil_1.getNullRange)(),originSelectionRange:i.range}]}}}}return[]}doReference(e,t,i,n){return[]}}exports.default=ValidateFunctionHandler;