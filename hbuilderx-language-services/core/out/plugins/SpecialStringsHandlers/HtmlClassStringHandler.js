"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const vscode_languageserver_protocol_1=require("vscode-languageserver-protocol"),vscode_uri_1=require("vscode-uri"),indexlib_1=require("../../../../indexlib"),HtmlIDStringHandler_1=require("./HtmlIDStringHandler");function addCSSResultClasses(e,s,t){for(const[r,n]of t.entries())n.has(s)&&e.set(r,s)}function addClassResults(e,s,t,r){var n;let l=new Set;l.add(e);let o=t.get(e);null===(n=null==o?void 0:o.references)||void 0===n||n.forEach((e=>{l.add(e.uri)}));for(const[e,t]of s.entries()){let s=new Set;for(let e of l)t.has(e)&&s.add(e);r.set(e,Array.from(s).join("\n"))}}class HtmlClassStringHandler{doComplete(e,s,t,r,n,l){let o=[],i=indexlib_1.IndexDataStore.load({uri:vscode_uri_1.URI.file(t.project.fsPath).toString(),name:""}),a=(0,HtmlIDStringHandler_1.getClassList)(i),d=new Map;for(const[e,s]of i.allIndexData().entries())(e.endsWith(".css")||e.endsWith(".scss")||e.endsWith(".sass")||e.endsWith(".stylus"))&&d.set(e,s);let u=new Map;if((0,HtmlIDStringHandler_1.isHTMLDocument)(e))addClassResults(e.uri,a,d,u);else if((0,HtmlIDStringHandler_1.isJSDocument)(e)){let s=new Map;for(const[e,t]of i.allIndexData().entries())(e.endsWith(".js")||e.endsWith(".ts"))&&s.set(e,t);if(s.has(e.uri)){s.get(e.uri).references.forEach((e=>{addClassResults(e.uri,a,d,u)}))}}else(0,HtmlIDStringHandler_1.isCSSDocument)(e)&&addCSSResultClasses(u,e.uri,a);for(const[e,s]of u.entries())o.push({kind:vscode_languageserver_protocol_1.CompletionItemKind.Class,label:e,detail:s});for(const[e,s]of a.entries())u.has(e)||o.push({kind:vscode_languageserver_protocol_1.CompletionItemKind.Class,label:e,detail:Array.from(u.get(e)).join("\n")});return o}doCompleteResolve(e,s,t,r,n){return e}doHover(e,s,t,r){}doDefinition(e,s,t,r){return[]}doReference(e,s,t,r){return[]}}exports.default=HtmlClassStringHandler;