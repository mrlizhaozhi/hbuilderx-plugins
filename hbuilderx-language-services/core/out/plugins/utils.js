"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.translateText=exports.removeRoot=exports.addRoot=exports.getLibraries=exports.getSettingPath=void 0;const fs=require("fs"),jsonc_1=require("jsonc"),os=require("os"),path=require("path"),md5=require("md5");function getSettingPath(t){t=fs.realpathSync.native(t).replace(/\\/g,"/");let e=md5(t),r=os.platform();return r="win32"==os.platform()?path.join(os.homedir(),"AppData/Roaming/HBuilder X"):path.join(os.homedir(),"Library/Application Support/.extensions_development/"),path.join(r,"projects",e,"setting.json")}function getLibraries(t){let e=getSettingPath(t);if(fs.existsSync(e)){let t=fs.readFileSync(e).toString();const[r,o]=jsonc_1.jsonc.safe.parse(t);if(!r&&o.libraries)return o.libraries}return[]}function addRoot(t,e){const r=t.ts.server.toNormalizedPath(e);let o=t.tsinfo.project.getScriptInfo(r);if(!o){let e=e=>t.tsinfo.project.useCaseSensitiveFileNames()?e:e.toLowerCase();o=new t.ts.server.ScriptInfo(t.tsinfo.serverHost,r,t.ts.ScriptKind.TS,!1,t.ts.server.normalizedPathToPath(r,t.tsinfo.project.getCurrentDirectory(),e)),o.open(t.tsinfo.serverHost.readFile(r)),t.ts.server.Project.prototype.addRoot.call(t.tsinfo.project,o),t.tsinfo.project.markAsDirty(),t.tsinfo.languageService.getProgram()}t.ts.server.Project.prototype.addRoot.call(t.tsinfo.project,o),t.tsinfo.project.markAsDirty(),t.tsinfo.languageService.getProgram()}function removeRoot(t,e){const r=t.ts.server.toNormalizedPath(e),o=t.tsinfo.project.getScriptInfo(r);if(o&&o.isAttached(t.tsinfo.project)){let e=t.tsinfo.project.rootFilesMap.delete(o.fileName.toLowerCase());return t.tsinfo.project.removeFile(o,!0,!0),e}return!0}function language(){return"zh_cn"}function getNlsFilePath(t){if("string"!=typeof t)return;let e=t.split("."),r=null,o=null;e.length>2&&(r=e[0],o=e[1]);let s=path.resolve(__dirname,"../nls");if(r&&o){let t=path.join(s,language(),r,`${r}.${o}.js`);if(fs.existsSync(t))return t}}function translate(t,e){let r=require(t).content;if(r.hasOwnProperty(e))return r[e]}function translateText(t){let e=getNlsFilePath(t);if(e){let r=translate(e,t);r&&(t=r)}return t}exports.getSettingPath=getSettingPath,exports.getLibraries=getLibraries,exports.addRoot=addRoot,exports.removeRoot=removeRoot,exports.translateText=translateText;