function stripComments(e){return e.replace(/("(?:[^\\\"]*(?:\\.)?)*")|('(?:[^\\\']*(?:\\.)?)*')|(\/\*(?:\r?\n|.)*?\*\/)|(\/{2,}.*?(?:(?:\r?\n)|$))/g,(function(e,n,t,s,a){if(s)return"";if(a){var r=a.length;return r>2&&"\n"===a[r-1]?"\r"===a[r-2]?"\r\n":"\n":""}return e}))}function bindLanguage(e,n){return es.through((function(t){var s=this;function a(e){return void 0!==e}function r(e){return void 0===e}var i=path.basename(t.relative),u="package.nls.json"===i;if(u||null!==i.match(/nls.metadata.json$/)){var o=u?t.relative.substr(0,t.relative.length-".nls.json".length):t.relative.substr(0,t.relative.length-".nls.metadata.json".length);if(t.isBuffer()){var l=t.contents,c=JSON.parse(l.toString("utf8")),p=null,f=!1;if(c&&a(c.keys)&&a(c.messages)){if(c.messages.length==c.keys.length){var g=[],h=Object.create(null);c.keys.forEach((function(e,n){var t,s=(t=e,"[object String]"===toString.call(t)?e:e.key);g.push(s),h[s]=c.messages[n]})),p={messages:c.messages,keys:g,map:h},f=!1}}else p=c,f=!0;p&&languages.forEach((function(a){var i,u=a.folderName||a.id,l=(n?path.join(e,u,n,o):path.join(e,u,o))+".i18n.json";if(fs.existsSync(l)){var c=stripComments(fs.readFileSync(l,"utf8"));i=JSON.parse(c)}i&&(f?(Object.keys(p).forEach((function(e){var n=i[e];r(n)||(p[e]=n)})),s.queue(new File({base:t.base,path:path.join(t.base,o)+".nls."+a.id+".json",contents:new Buffer(JSON.stringify(p,null,"\t").replace(/\r\n/g,"\n"),"utf8")}))):(p.keys.forEach((function(e){var n=i[e];r(n)||(p.map[e]=n)})),s.queue(new File({base:t.base,path:path.join(t.base,o)+".nls."+a.id+".json",contents:new Buffer(JSON.stringify(p.map,null,"\t").replace(/\r\n/g,"\n"),"utf8")}))))}))}}}))}gulp.task("publishnls",function(){const e="./packout/.cache";return gulp.series((function(){return gulp.src("package.nls.json").pipe(bindLanguage("i18n","")).pipe(gulp.dest(e))}),(function(){return gulp.src(["./**/*.js","!node_modules/**","!out/**","!gulpfile.js"]).pipe(nls.rewriteLocalizeCalls()).pipe(nls.createKeyValuePairFile()).pipe(bindLanguage("i18n","")).pipe(gulp.dest(e))}),(function(){return gulp.src([e+"/**/*.json"]).pipe((n="hx-nls-sample",t="1.0.0",s="",a=Object.create(null),es.through((function(e){var n=path.basename(e.path).match(/.nls\.(?:(.*)\.)?json/);if(n&&e.isBuffer()){var r=n[1]?n[1]:"en",i=a[r];i||(i={base:e.base,content:{version:t,contents:{}}},a[r]=i);var u=e.relative.match(/(.*)\.nls\.(?:.*\.)?json/)[1].replace(/\\/g,"/");"package"==u?i.content.contents[u]=JSON.parse(e.contents.toString("utf8")):i.content.contents[s+"/"+u]=JSON.parse(e.contents.toString("utf8"))}}),(function(){for(var e in a){var t=a[e],s="en"===e?"":e+".",r=new File({base:t.base,path:path.join(t.base,n+"."+s+"json"),contents:new Buffer(JSON.stringify(t.content,void 0,4),"utf8")});this.queue(r)}this.queue(null)})))).pipe(gulp.dest("./packout"));var n,t,s,a}),(function(){return del([e])}))}());