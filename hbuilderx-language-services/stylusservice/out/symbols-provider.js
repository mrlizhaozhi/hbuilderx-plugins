"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.StylusDocumentSimbolsProvider=exports.uniq=exports._buildHashFromSymbol=void 0;const vscode_1=require("vscode"),parser_1=require("./parser"),utils_1=require("./utils");function _buildHashFromSymbol(e){return`${e.kind}_${e.name}_${e.location.range.start.line}_${e.location.range.end.line}`}function uniq(e){const o={};return e.reduce(((e,n,s)=>{const t=_buildHashFromSymbol(n);return o[t]?e:(o[t]=!0,e.concat(n))}),[])}function _variableSymbol(e,o){const n=e.name,s=Number(e.val.lineno)-1,t=Math.max(o[s].indexOf(n),0),i=new vscode_1.Position(s,t),r=new vscode_1.Position(s,t+n.length);return new vscode_1.SymbolInformation(n,vscode_1.SymbolKind.Variable,new vscode_1.Range(i,r))}function _functionSymbol(e,o){const n=e.name,s=Number(e.val.lineno)-1,t=Math.max(o[s].indexOf(n),0),i=new vscode_1.Position(s,t),r=new vscode_1.Position(s,t+n.length);return new vscode_1.SymbolInformation(n,vscode_1.SymbolKind.Function,new vscode_1.Range(i,r))}function _selectorSymbol(e,o){const n=e.segments[0],s=n.string?e.segments.map((e=>e.string)).join(""):n.nodes.map((e=>e.name)).join(""),t=Number(n.lineno)-1,i=e.column-1,r=new vscode_1.Position(t,i),l=new vscode_1.Position(t,i+s.length);return new vscode_1.SymbolInformation(s,vscode_1.SymbolKind.Class,new vscode_1.Range(r,l))}function _selectorCallSymbol(e,o){const n=Number(e.lineno)-1,s=(0,utils_1.prepareName)(o[n]),t=Math.max(o[n].indexOf(s),0),i=new vscode_1.Position(n,t),r=new vscode_1.Position(n,t+s.length);return new vscode_1.SymbolInformation(s,vscode_1.SymbolKind.Class,new vscode_1.Range(i,r))}function _atRuleSymbol(e,o){const n=Number(e.lineno)-1,s=(0,utils_1.prepareName)(o[n]),t=Math.max(o[n].indexOf(s),0),i=new vscode_1.Position(n,t),r=new vscode_1.Position(n,t+s.length);return new vscode_1.SymbolInformation(s,vscode_1.SymbolKind.Namespace,new vscode_1.Range(i,r))}function processRawSymbols(e,o){return e.map((e=>(0,parser_1.isVariableNode)(e)?_variableSymbol(e,o):(0,parser_1.isFunctionNode)(e)?_functionSymbol(e,o):(0,parser_1.isSelectorNode)(e)?_selectorSymbol(e,o):(0,parser_1.isSelectorCallNode)(e)?_selectorCallSymbol(e,o):(0,parser_1.isAtRuleNode)(e)?_atRuleSymbol(e,o):void 0))}exports._buildHashFromSymbol=_buildHashFromSymbol,exports.uniq=uniq;class StylusDocumentSimbolsProvider{provideDocumentSymbols(e,o){const n=e.getText(),s=(0,parser_1.buildAst)(n),t=(0,utils_1.compact)((0,parser_1.flattenAndFilterAst)(s));return uniq((0,utils_1.compact)(processRawSymbols(t,n.split("\n"))))}}exports.StylusDocumentSimbolsProvider=StylusDocumentSimbolsProvider;