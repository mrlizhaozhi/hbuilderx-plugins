"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.startClient=void 0;const vscode_1=require("vscode"),vscode_languageclient_1=require("vscode-languageclient"),nls=require("vscode-nls"),client_1=require("../../../utils/client"),customData_1=require("./customData"),requests_1=require("./requests");var CustomDataChangedNotification;!function(e){e.type=new vscode_languageclient_1.NotificationType("css/customDataChanged")}(CustomDataChangedNotification||(CustomDataChangedNotification={}));const localize=nls.loadMessageBundle();function startClient(e,t,n){let o=e.subscriptions,s=["css","scss","less"];const i=(0,customData_1.getCustomDataSource)(e.subscriptions);let a={documentSelector:s,synchronize:{configurationSection:["css","scss","less"]},initializationOptions:{handledSchemas:["file"]},outputChannel:new client_1.LogRedirectOutputChannel(localize("cssserver.name","CSS Language Server")),middleware:{provideCompletionItem(e,t,n,o,s){function i(e){const n=e.range;n instanceof vscode_1.Range&&n.end.isAfter(t)&&n.start.isBeforeOrEqual(t)&&(e.range={inserting:new vscode_1.Range(n.start,t),replacing:n})}function a(e){e.kind===vscode_1.CompletionItemKind.Color&&(e.label2={name:e.label,type:e.documentation})}function r(e){return e&&((Array.isArray(e)?e:e.items).forEach(i),(Array.isArray(e)?e:e.items).forEach(a)),e}const c=s(e,t,n,o);return(l=c)&&l.then?c.then(r):r(c);var l}}};let r=t("css",localize("cssserver.name","CSS Language Server"),a);r.registerProposedFeatures(),r.onReady().then((()=>{r.sendNotification(CustomDataChangedNotification.type,i.uris),i.onDidChange((()=>{r.sendNotification(CustomDataChangedNotification.type,i.uris)})),(0,requests_1.serveFileSystemRequests)(r,n)}));let c=r.start();o.push(c);let l={increaseIndentPattern:/(^.*\{[^}]*$)/,decreaseIndentPattern:/^\s*\}/};vscode_1.languages.setLanguageConfiguration("css",{wordPattern:/(#?-?\d*\.\d\w*%?)|(::?[\w-]*(?=[^,{;]*[,{]))|(([@#.!])?[\w-?]+%?|[@#!.])/g,indentationRules:l}),vscode_1.languages.setLanguageConfiguration("less",{wordPattern:/(#?-?\d*\.\d\w*%?)|(::?[\w-]+(?=[^,{;]*[,{]))|(([@#.!])?[\w-?]+%?|[@#!.])/g,indentationRules:l}),vscode_1.languages.setLanguageConfiguration("scss",{wordPattern:/(#?-?\d*\.\d\w*%?)|(::?[\w-]*(?=[^,{;]*[,{]))|(([@$#.!])?[\w-?]+%?|[@#!$.])/g,indentationRules:l}),r.onReady().then((()=>{o.push(function(){const e=/^(\s*)(\/(\*\s*(#\w*)?)?)?$/;return vscode_1.languages.registerCompletionItemProvider(s,{provideCompletionItems(t,n){let o=t.getText(new vscode_1.Range(new vscode_1.Position(n.line,0),n)).match(e);if(o){let e=new vscode_1.Range(new vscode_1.Position(n.line,o[1].length),n),t=new vscode_1.CompletionItem("#region",vscode_1.CompletionItemKind.Snippet);t.range=e,vscode_1.TextEdit.replace(e,"/* #region */"),t.insertText=new vscode_1.SnippetString("/* #region $1*/"),t.documentation=localize("folding.start","Folding Region Start"),t.filterText=o[2],t.sortText="za";let s=new vscode_1.CompletionItem("#endregion",vscode_1.CompletionItemKind.Snippet);return s.range=e,s.insertText="/* #endregion */",s.documentation=localize("folding.end","Folding Region End"),s.sortText="zb",s.filterText=o[2],[t,s]}return null}})}())}))}exports.startClient=startClient;