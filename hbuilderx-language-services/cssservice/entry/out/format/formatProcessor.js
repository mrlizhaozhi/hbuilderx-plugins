"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getFormattingInHtml=exports.getFormattingData=void 0;const jsBeautify=require("js-beautify");var Diff=require("../../../../lib/diff.js");const vscode_languageserver_1=require("vscode-languageserver"),util_1=require("../utils/util");async function getFormattingData(e,t,n,i){var r;let s=[];if(!n)return s;if(!i)return s;if("css"!==e.languageId)return s;const a=e.getText(),l=vscode_languageserver_1.Position.create(0,0),o=e.positionAt(a.length),_=vscode_languageserver_1.Range.create(l,o);let d=e.getText(_),g=await(0,util_1.getHXSettings)("editor.showDefaultEndOfLine",n,i),c={indent_size:null!==(r=t.tabSize)&&void 0!==r?r:4,indent_char:" ",indent_level:0,indent_with_tabs:!t.insertSpaces,eol:null!=g?g:"\n",end_with_newline:!1,brace_style:"collapse",selector_separator_newline:!0,newline_between_rules:!0,indent_empty_lines:!1};const u=await(0,util_1.getHXSettings)("css.format",n,i);null!=u&&(c={indent_size:u.indentSize,indent_char:u.indentChar,indent_level:u.indentLevel,indent_with_tabs:u.indentWithTabs,eol:u.eol,end_with_newline:u.endWithNewline,brace_style:u.braceStyle,selector_separator_newline:u.selectorSeparatorNewline,newline_between_rules:u.newlineBetweenRules,indent_empty_lines:u.indentEmptyLines}),0===c.indent_level&&(d=d.trim());const f=jsBeautify.css_beautify(d,c);if(f){const t=Diff.stringDiff(a,f);for(let n of t){const t=e.positionAt(n.originalStart),i=e.positionAt(n.originalStart+n.originalLength),r=vscode_languageserver_1.Range.create(t,i),a=f.substring(n.modifiedStart,n.modifiedStart+n.modifiedLength);s.push(vscode_languageserver_1.TextEdit.replace(r,a))}}return s}async function getFormattingInHtml(e,t,n){let i=[];const r=e.offsetAt(t.start),s=e.getText(t);let a=s,l={indent_size:4,indent_char:" ",indent_level:0,indent_with_tabs:!1,eol:"\n",end_with_newline:!1,brace_style:"collapse",selector_separator_newline:!0,newline_between_rules:!0,indent_empty_lines:!1};l={indent_size:n.indentSize,indent_char:n.indentChar,indent_level:n.indentLevel,indent_with_tabs:n.indentWithTabs,eol:n.eol,end_with_newline:n.endWithNewline,brace_style:n.braceStyle,selector_separator_newline:n.selectorSeparatorNewline,newline_between_rules:n.newlineBetweenRules,indent_empty_lines:n.indentEmptyLines},n.indentLevel&&n.indentLevel<0&&(l.indent_level=0),a="a"+a,a=a.trim().substring(1),0===n.indentLevel&&(a=a.trim());let o=jsBeautify.css_beautify(a,l);if(o){n.isNeedLineBreak&&(o="\n"+o);const t=Diff.stringDiff(s,o);for(let n of t){const t=e.positionAt(n.originalStart+r),s=e.positionAt(n.originalStart+n.originalLength+r),a=vscode_languageserver_1.Range.create(t,s),l=o.substring(n.modifiedStart,n.modifiedStart+n.modifiedLength);i.push(vscode_languageserver_1.TextEdit.replace(a,l))}}return i}exports.getFormattingData=getFormattingData,exports.getFormattingInHtml=getFormattingInHtml;