"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.createFileIndexProcessor=exports.LessExtraServer=void 0;const vscode_css_languageservice_1=require("vscode-css-languageservice"),baseExtraServer_1=require("./baseExtraServer"),lessCompletionProcessor_1=require("./completion/lessCompletionProcessor"),baseDefinitionProcessor_1=require("./definition/baseDefinitionProcessor"),lessIndexProcessor_1=require("./index/lessIndexProcessor"),baseSymbolProcessor_1=require("./symbol/baseSymbolProcessor");class LessExtraServer extends baseExtraServer_1.BaseExtraServer{constructor(){super(...arguments),this.completionProcessor=new lessCompletionProcessor_1.LessCompletionProcessor,this.doExtraCompletion=this.completionProcessor.doExtraCompletion.bind(this.completionProcessor)}support(e,s){return!("less"!==e.languageId&&!e.uri.endsWith(".less"))}doIndex(e,s){return(new lessIndexProcessor_1.LessIndexProcessor).createIndexData(s,e)}getLanguageServiceExt(){return{findSymbol:async(e,s,r)=>Promise.resolve().then((()=>(new baseDefinitionProcessor_1.BaseDefinitionProcessor).getDefinitionFromClass(r,e,s))),async doComplete(e,s,r){let o=null==r?void 0:r.docStylesheet;if(!r||!r.workspaceFolder||!r.documentContext)return{isIncomplete:!1,items:[]};r.docStylesheet||(o=(0,vscode_css_languageservice_1.getLESSLanguageService)().parseStylesheet(e));let t=await(0,vscode_css_languageservice_1.getLESSLanguageService)().doComplete2(e,s,o,r.documentContext);return Promise.resolve().then((async()=>{let n=new lessCompletionProcessor_1.LessCompletionProcessor;const i=r.workspaceFolder,c=r.serverConnection,a=r.scopedSettingsSupport;return t=await n.doExtraCompletion(i,e,s,o,c,a,t),t}))},findDocumentSymbols(e,s){let r=null==s?void 0:s.docStylesheet;if(!s)return[];s.docStylesheet||(r=(0,vscode_css_languageservice_1.getLESSLanguageService)().parseStylesheet(e));let o=(0,vscode_css_languageservice_1.getLESSLanguageService)().findDocumentSymbols(e,r),t=s.workspaceFolder;return o=(new baseSymbolProcessor_1.BaseSymbolProcessor).getHxKindConvertedSymbolsData(t,o),o},async findDefinition(e,s,r){let o=null==r?void 0:r.docStylesheet;r&&r.docStylesheet||(o=(0,vscode_css_languageservice_1.getLESSLanguageService)().parseStylesheet(e));let t=(0,vscode_css_languageservice_1.getLESSLanguageService)().findDefinition(e,s,o);return Promise.resolve().then((async()=>(new baseDefinitionProcessor_1.BaseDefinitionProcessor).getBaseLocationLink(null==r?void 0:r.workspaceFolder,e,s,o,t)))}}}}function createFileIndexProcessor(e){return new LessExtraServer}exports.LessExtraServer=LessExtraServer,exports.createFileIndexProcessor=createFileIndexProcessor;