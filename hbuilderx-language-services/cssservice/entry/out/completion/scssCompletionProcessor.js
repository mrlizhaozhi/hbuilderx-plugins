"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ScssCompletionProcessor=void 0;const vscode_languageserver_1=require("vscode-languageserver"),entry_1=require("../../../../htmlservice/entry"),utils_1=require("../../../../utils"),grammarProcessor_1=require("../grammar/grammarProcessor"),util_1=require("../utils/util"),baseCompletionProcessor_1=require("./baseCompletionProcessor"),{SCSSScanner:SCSSScanner}=require("vscode-css-languageservice/lib/umd/parser/scssScanner");class ScssCompletionProcessor extends baseCompletionProcessor_1.BaseCompletionProcessor{constructor(){super(...arguments),this.baseCompletionProcessor=new baseCompletionProcessor_1.BaseCompletionProcessor,this.getGrammarCompletionData=this.getScssGrammarCompletionData}async getTagCompletionData(e,t,o,a,i){if(!(0,util_1.isRightCompletionType)(a,[util_1.NodeType.Media,util_1.NodeType.MediaQuery],void 0,util_1.NodeType.Media))return i;const r=t.offsetAt(o),s=(0,util_1.getCurrentWord)(t,r);let n=(0,entry_1.getHtmlTags)(e),l=vscode_languageserver_1.Position.create(o.line,o.character-s.length);for(const e of n)i.items.push({label:e,textEdit:vscode_languageserver_1.TextEdit.replace(vscode_languageserver_1.Range.create(l,o),e),kind:vscode_languageserver_1.CompletionItemKind.Keyword,data:{hxKind:utils_1.HxIconKind.ELEMENT}});return i}async getExclamatoryKeyword(e,t,o,a,i){if(!(0,util_1.isRightCompletionType)(a,[util_1.NodeType.Declaration,util_1.NodeType.Declarations],void 0,util_1.NodeType.Declaration))return i;const r=t.offsetAt(o),s=(0,util_1.getContextData)(t,r,";"),n=(0,util_1.getLineTextFromOffset)(t,r);let l=["!global","!default"];if((0,util_1.getOffsetLeftLineText)(t,r).includes("$"));else{if(!n.includes("@extend"))return i;l=["!optional"]}for(const e of l)i.items.push({label:e,textEdit:vscode_languageserver_1.TextEdit.replace(s.contextRange,e),kind:vscode_languageserver_1.CompletionItemKind.Property});return i}async getExtraCompletionData(e,t,o,a,i,r,s){return s=await this.getTagCompletionData(e,t,o,a,s),s=await this.getExclamatoryKeyword(e,t,o,a,s)}async getScssGrammarCompletionData(e,t,o,a,i){a=this.getCompletionTypeFromScanner(t,o);const r=(0,util_1.isRightCompletionType)(a,[util_1.NodeType.Identifier],[util_1.NodeType.Property],util_1.NodeType.Property);return a&&r&&(a.nodeType=util_1.NodeType.Selector),(0,grammarProcessor_1.getGrammarCompletionData)(e,t,o,a,i)}async doExtraCompletion(e,t,o,a,i,r,s){const n=this.isErrorAstNode(t,o,a);let l=this.getCompletionTypeFromAstNode(t,o,a);return(n||0===s.items.length)&&(l=this.getCompletionTypeFromScanner(t,o),s=await this.getCompletionDataFromScanner(t,o,l)),s=await this.getHxKindConvertedCompletionData(s),s=await this.getSelfIdSelectorCompletionData(t,o,l,s),s=await this.getDeprecatedCompletionData(t,o,l,s),s=await this.getFunctionsCompletionData(t,o,l,s),s=await this.getMediaCompletionData(t,o,l,s),s=await this.getCharsetCompletionData(t,o,l,s),s=await this.getPathCompletionData(e,t,o,l,s),s=await this.getPropertySelectorCompletionData(e,t,o,l,s),s=await this.getExtraCompletionData(e,t,o,l,i,r,s),s=await this.getIndexIdSelectorsCompletionData(e,t,o,l,s),s=await this.getIndexClassSelectorsCompletionData(e,t,o,l,s),s=await this.getGrammarCompletionData(e,t,o,l,s),s=await this.getPxConversionCompletionData(e,t,o,l,i,r,s),s=await this.getDeduplicationData(s),s=await this.getFiltrationPseudoData(t,o,l,s),s=await this.retrieveRange(t,o,l,s),s=await this.getMoveCursorData(t,o,l,s),s=await this.getAltMode(t,o,s)}}exports.ScssCompletionProcessor=ScssCompletionProcessor;