"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.splitJoinTag=void 0;const vscode=require("vscode"),util_1=require("./util"),parseDocument_1=require("./parseDocument");function splitJoinTag(){if(!(0,util_1.validate)(!1)||!vscode.window.activeTextEditor)return;const e=vscode.window.activeTextEditor,t=e.document,o=(0,parseDocument_1.getRootNode)(e.document,!0);return o?e.edit((n=>{Array.from(e.selections).reverse().forEach((e=>{const s=t.getText(),i=t.offsetAt(e.start),r=(0,util_1.getHtmlFlatNode)(s,o,i,!0);if(r){const e=getRangesToReplace(t,r);n.replace(e.range,e.newText)}}))})):void 0}function getRangesToReplace(e,t){var o;let n,s;if(t.open&&t.close){const i=t.open.end-1,r=t.end;n=(0,util_1.offsetRangeToVsRange)(e,i,r),s="/>";const l=null!==(o=(0,util_1.getEmmetMode)(e.languageId,{},[]))&&void 0!==o?o:"",a=(0,util_1.getEmmetConfiguration)(l);l&&a.syntaxProfiles[l]&&("xhtml"===a.syntaxProfiles[l].selfClosingStyle||"xhtml"===a.syntaxProfiles[l].self_closing_tag)&&(s=" "+s)}else{const o=e.getText().substring(t.start,t.end).match(/(\s*\/)?>$/),i=t.end,r=o?i-o[0].length:i;n=(0,util_1.offsetRangeToVsRange)(e,r,i),s=`></${t.name}>`}return new vscode.TextEdit(n,s)}exports.splitJoinTag=splitJoinTag;