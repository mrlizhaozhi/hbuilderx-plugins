"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.prevItemHTML=exports.nextItemHTML=void 0;const util_1=require("./util");function nextItemHTML(t,e,n,i){const o=t.offsetAt(n);let r,l=(0,util_1.getHtmlFlatNode)(t.getText(),i,o,!1);if(l){if("comment"!==l.type){if(l.open&&o<=l.open.start+l.name.length)return getSelectionFromNode(t,l);if(l.open&&o<l.open.end){const n=t.offsetAt(e),i=getNextAttribute(t,n,o,l);if(i)return i}for(r=l.firstChild;r&&(o>=r.end||"comment"===r.type);)r=r.nextSibling}for(;!r&&l;)l.nextSibling?"comment"!==l.nextSibling.type?r=l.nextSibling:l=l.nextSibling:l=l.parent;return r&&getSelectionFromNode(t,r)}}function prevItemHTML(t,e,n,i){const o=t.offsetAt(e);let r,l=(0,util_1.getHtmlFlatNode)(t.getText(),i,o,!1);if(!l)return;const u=t.offsetAt(n);if(l.open&&"comment"!==l.type&&o-1>l.open.start)if(o<l.open.end||!l.firstChild||u<=l.firstChild.start)r=l;else{let t;for(r=l.firstChild;r.nextSibling&&o>=r.nextSibling.end;)r&&"comment"!==r.type&&(t=r),r=r.nextSibling;r=(0,util_1.getDeepestFlatNode)(r&&"comment"!==r.type?r:t)}for(;!r&&l;)l.previousSibling?"comment"!==l.previousSibling.type?r=(0,util_1.getDeepestFlatNode)(l.previousSibling):l=l.previousSibling:r=l.parent;if(!r)return;const a=getPrevAttribute(t,o,u,r);return a||getSelectionFromNode(t,r)}function getSelectionFromNode(t,e){if(e&&e.open){const n=e.open.start+1,i=n+e.name.length;return(0,util_1.offsetRangeToSelection)(t,n,i)}}function getNextAttribute(t,e,n,i){if(i.attributes&&0!==i.attributes.length&&"comment"!==i.type)for(const o of i.attributes){if(n<o.start)return(0,util_1.offsetRangeToSelection)(t,o.start,o.end);if(!o.value||o.value.start===o.value.end)continue;if(e===o.start&&n===o.end||n<o.value.start)return(0,util_1.offsetRangeToSelection)(t,o.value.start,o.value.end);if(-1===o.value.toString().indexOf(" "))continue;let i;if(e===o.value.start&&n===o.value.end&&(i=-1),void 0===i&&n<o.end){i=t.positionAt(n).character-t.positionAt(o.value.start).character-1}if(void 0!==i){const[e,n]=(0,util_1.findNextWord)(o.value.toString(),i);if(void 0===e||void 0===n)return;if(e>=0&&n>=0){const i=o.value.start+e,r=o.value.start+n;return(0,util_1.offsetRangeToSelection)(t,i,r)}}}}function getPrevAttribute(t,e,n,i){if(i.attributes&&0!==i.attributes.length&&"comment"!==i.type)for(let o=i.attributes.length-1;o>=0;o--){const r=i.attributes[o];if(e<=r.start)continue;if(!r.value||r.value.start===r.value.end||e<r.value.start)return(0,util_1.offsetRangeToSelection)(t,r.start,r.end);if(e===r.value.start)return n>=r.value.end?(0,util_1.offsetRangeToSelection)(t,r.start,r.end):(0,util_1.offsetRangeToSelection)(t,r.value.start,r.value.end);const l=t.positionAt(e).character,u=t.positionAt(r.value.start).character,a=e>r.value.end?r.value.toString().length:l-u,[s,f]=(0,util_1.findPrevWord)(r.value.toString(),a);if(void 0===s||void 0===f)return;if(s>=0&&f>=0){const e=r.value.start+s,n=r.value.start+f;return(0,util_1.offsetRangeToSelection)(t,e,n)}}}exports.nextItemHTML=nextItemHTML,exports.prevItemHTML=prevItemHTML;