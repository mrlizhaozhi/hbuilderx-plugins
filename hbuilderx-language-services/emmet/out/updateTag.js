"use strict";var __awaiter=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(a,r){function i(e){try{c(o.next(e))}catch(e){r(e)}}function s(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.updateTag=void 0;const vscode=require("vscode"),util_1=require("./util"),parseDocument_1=require("./parseDocument");function updateTag(e){return __awaiter(this,void 0,void 0,(function*(){if(!(0,util_1.validate)(!1)||!vscode.window.activeTextEditor)return;const t=vscode.window.activeTextEditor,n=t.document,o=(0,parseDocument_1.getRootNode)(n,!0);if(!o)return;const a=Array.from(t.selections).reverse().reduce(((e,t)=>e.concat(getRangesToUpdate(n,t,o))),[]);if(!a.length)return;const r=a[0].name,i=a.every((e=>e.name===r));return!(void 0===e&&!(e=yield vscode.window.showInputBox({prompt:"Enter Tag",value:i?r:void 0})))&&t.edit((t=>{a.forEach((n=>{t.replace(n.range,e)}))}))}))}function getRangesFromNode(e,t){let n=[];if(e.open){const o=t.positionAt(e.open.start);n.push({name:e.name,range:new vscode.Range(o.translate(0,1),o.translate(0,1).translate(0,e.name.length))})}if(e.close){const o=t.positionAt(e.close.start),a=t.positionAt(e.close.end);n.push({name:e.name,range:new vscode.Range(o.translate(0,2),a.translate(0,-1))})}return n}function getRangesToUpdate(e,t,n){const o=e.getText(),a=e.offsetAt(t.start),r=(0,util_1.getHtmlFlatNode)(o,n,a,!0);return r?getRangesFromNode(r,e):[]}exports.updateTag=updateTag;