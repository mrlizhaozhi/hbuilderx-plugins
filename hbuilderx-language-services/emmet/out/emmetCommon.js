"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.deactivate=exports.activateEmmetExtension=exports.expandEmmetAbbreviation=void 0;const vscode=require("vscode"),defaultCompletionProvider_1=require("./defaultCompletionProvider"),abbreviationActions_1=require("./abbreviationActions");Object.defineProperty(exports,"expandEmmetAbbreviation",{enumerable:!0,get:function(){return abbreviationActions_1.expandEmmetAbbreviation}});const removeTag_1=require("./removeTag"),updateTag_1=require("./updateTag"),matchTag_1=require("./matchTag"),balance_1=require("./balance"),splitJoinTag_1=require("./splitJoinTag"),mergeLines_1=require("./mergeLines"),toggleComment_1=require("./toggleComment"),editPoint_1=require("./editPoint"),selectItem_1=require("./selectItem"),evaluateMathExpression_1=require("./evaluateMathExpression"),incrementDecrement_1=require("./incrementDecrement"),util_1=require("./util"),reflectCssValue_1=require("./reflectCssValue"),parseDocument_1=require("./parseDocument");function activateEmmetExtension(e){(0,util_1.migrateEmmetExtensionsPath)(),registerCompletionProviders(e),(0,util_1.updateEmmetExtensionsPath)(),e.subscriptions.push(vscode.commands.registerCommand("editor.emmet.action.wrapWithAbbreviation",(e=>{(0,abbreviationActions_1.wrapWithAbbreviation)(e)}))),e.subscriptions.push(vscode.commands.registerCommand("emmet.expandAbbreviation",(e=>{(0,abbreviationActions_1.expandEmmetAbbreviation)(e)}))),e.subscriptions.push(vscode.commands.registerCommand("editor.emmet.action.removeTag",(()=>(0,removeTag_1.removeTag)()))),e.subscriptions.push(vscode.commands.registerCommand("editor.emmet.action.updateTag",(e=>e&&"string"==typeof e?(0,updateTag_1.updateTag)(e):(0,updateTag_1.updateTag)(void 0)))),e.subscriptions.push(vscode.commands.registerCommand("editor.emmet.action.matchTag",(()=>{(0,matchTag_1.matchTag)()}))),e.subscriptions.push(vscode.commands.registerCommand("editor.emmet.action.balanceOut",(()=>{(0,balance_1.balanceOut)()}))),e.subscriptions.push(vscode.commands.registerCommand("editor.emmet.action.balanceIn",(()=>{(0,balance_1.balanceIn)()}))),e.subscriptions.push(vscode.commands.registerCommand("editor.emmet.action.splitJoinTag",(()=>(0,splitJoinTag_1.splitJoinTag)()))),e.subscriptions.push(vscode.commands.registerCommand("editor.emmet.action.mergeLines",(()=>{(0,mergeLines_1.mergeLines)()}))),e.subscriptions.push(vscode.commands.registerCommand("editor.emmet.action.toggleComment",(()=>{(0,toggleComment_1.toggleComment)()}))),e.subscriptions.push(vscode.commands.registerCommand("editor.emmet.action.nextEditPoint",(()=>{(0,editPoint_1.fetchEditPoint)("next")}))),e.subscriptions.push(vscode.commands.registerCommand("editor.emmet.action.prevEditPoint",(()=>{(0,editPoint_1.fetchEditPoint)("prev")}))),e.subscriptions.push(vscode.commands.registerCommand("editor.emmet.action.selectNextItem",(()=>{(0,selectItem_1.fetchSelectItem)("next")}))),e.subscriptions.push(vscode.commands.registerCommand("editor.emmet.action.selectPrevItem",(()=>{(0,selectItem_1.fetchSelectItem)("prev")}))),e.subscriptions.push(vscode.commands.registerCommand("editor.emmet.action.evaluateMathExpression",(()=>{(0,evaluateMathExpression_1.evaluateMathExpression)()}))),e.subscriptions.push(vscode.commands.registerCommand("editor.emmet.action.incrementNumberByOneTenth",(()=>(0,incrementDecrement_1.incrementDecrement)(.1)))),e.subscriptions.push(vscode.commands.registerCommand("editor.emmet.action.incrementNumberByOne",(()=>(0,incrementDecrement_1.incrementDecrement)(1)))),e.subscriptions.push(vscode.commands.registerCommand("editor.emmet.action.incrementNumberByTen",(()=>(0,incrementDecrement_1.incrementDecrement)(10)))),e.subscriptions.push(vscode.commands.registerCommand("editor.emmet.action.decrementNumberByOneTenth",(()=>(0,incrementDecrement_1.incrementDecrement)(-.1)))),e.subscriptions.push(vscode.commands.registerCommand("editor.emmet.action.decrementNumberByOne",(()=>(0,incrementDecrement_1.incrementDecrement)(-1)))),e.subscriptions.push(vscode.commands.registerCommand("editor.emmet.action.decrementNumberByTen",(()=>(0,incrementDecrement_1.incrementDecrement)(-10)))),e.subscriptions.push(vscode.commands.registerCommand("editor.emmet.action.reflectCSSValue",(()=>(0,reflectCssValue_1.reflectCssValue)()))),e.subscriptions.push(vscode.commands.registerCommand("workbench.action.showEmmetCommands",(()=>{vscode.commands.executeCommand("workbench.action.quickOpen",">Emmet: ")}))),e.subscriptions.push(vscode.workspace.onDidChangeConfiguration((t=>{t.affectsConfiguration("emmet.includeLanguages")&&registerCompletionProviders(e),t.affectsConfiguration("emmet.extensionsPath")&&(0,util_1.updateEmmetExtensionsPath)()}))),e.subscriptions.push(vscode.workspace.onDidSaveTextDocument((e=>{const t=(0,util_1.getPathBaseName)(e.fileName);t.startsWith("snippets")&&t.endsWith(".json")&&(0,util_1.updateEmmetExtensionsPath)(!0)}))),e.subscriptions.push(vscode.workspace.onDidOpenTextDocument((e=>{var t;const i=null!==(t=(0,util_1.getEmmetMode)(e.languageId,{},[]))&&void 0!==t?t:"",n=(0,util_1.getSyntaxes)();(n.markup.includes(i)||n.stylesheet.includes(i))&&(0,parseDocument_1.addFileToParseCache)(e)}))),e.subscriptions.push(vscode.workspace.onDidCloseTextDocument((e=>{var t;const i=null!==(t=(0,util_1.getEmmetMode)(e.languageId,{},[]))&&void 0!==t?t:"",n=(0,util_1.getSyntaxes)();(n.markup.includes(i)||n.stylesheet.includes(i))&&(0,parseDocument_1.removeFileFromParseCache)(e)})))}exports.activateEmmetExtension=activateEmmetExtension;const languageMappingForCompletionProviders=new Map,completionProvidersMapping=new Map;function registerCompletionProviders(e){let t=new defaultCompletionProvider_1.DefaultCompletionItemProvider,i=(0,util_1.getMappingForIncludedLanguages)();Object.keys(i).forEach((n=>{if(languageMappingForCompletionProviders.has(n)&&languageMappingForCompletionProviders.get(n)===i[n])return;if(languageMappingForCompletionProviders.has(n)){const e=completionProvidersMapping.get(n);e&&e.dispose(),languageMappingForCompletionProviders.delete(n),completionProvidersMapping.delete(n)}const o=vscode.languages.registerCompletionItemProvider({language:n,scheme:"*"},t,...util_1.LANGUAGE_MODES[i[n]]);e.subscriptions.push(o),languageMappingForCompletionProviders.set(n,i[n]),completionProvidersMapping.set(n,o)})),Object.keys(util_1.LANGUAGE_MODES).forEach((i=>{if(!languageMappingForCompletionProviders.has(i)){const n=vscode.languages.registerCompletionItemProvider({language:i,scheme:"*"},t,...util_1.LANGUAGE_MODES[i]);e.subscriptions.push(n),languageMappingForCompletionProviders.set(i,i),completionProvidersMapping.set(i,n)}}))}function deactivate(){completionProvidersMapping.clear(),(0,parseDocument_1.clearParseCache)()}exports.deactivate=deactivate;