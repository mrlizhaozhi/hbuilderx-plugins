"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.requireSomeCapability=exports.requireConfiguration=exports.requireMinVersion=exports.conditionalRegistration=exports.Condition=void 0;const vscode=require("vscode"),dispose_1=require("./dispose");class Condition extends dispose_1.Disposable{constructor(i,e){super(),this.getValue=i,this._onDidChange=this._register(new vscode.EventEmitter),this.onDidChange=this._onDidChange.event,this._value=this.getValue(),e((()=>{const i=this.getValue();i!==this._value&&(this._value=i,this._onDidChange.fire())}))}get value(){return this._value}}exports.Condition=Condition;class ConditionalRegistration{constructor(i,e){this.conditions=i,this.doRegister=e,this.registration=void 0;for(const e of i)e.onDidChange((()=>this.update()));this.update()}dispose(){var i;null===(i=this.registration)||void 0===i||i.dispose(),this.registration=void 0}update(){this.conditions.every((i=>i.value))?this.registration||(this.registration=this.doRegister()):this.registration&&(this.registration.dispose(),this.registration=void 0)}}function conditionalRegistration(i,e){return new ConditionalRegistration(i,e)}function requireMinVersion(i,e){return new Condition((()=>i.apiVersion.gte(e)),i.onTsServerStarted)}function requireConfiguration(i,e){return new Condition((()=>!!vscode.workspace.getConfiguration(i,null).get(e)),vscode.workspace.onDidChangeConfiguration)}function requireSomeCapability(i,...e){return new Condition((()=>e.some((e=>i.capabilities.has(e)))),i.onDidChangeCapabilities)}exports.conditionalRegistration=conditionalRegistration,exports.requireMinVersion=requireMinVersion,exports.requireConfiguration=requireConfiguration,exports.requireSomeCapability=requireSomeCapability;