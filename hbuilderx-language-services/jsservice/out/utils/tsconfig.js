"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.openProjectConfigForFile=exports.openProjectConfigOrPromptToCreate=exports.openOrCreateConfig=exports.inferredProjectCompilerOptions=exports.isImplicitProjectConfigFile=void 0;const path=require("path"),vscode=require("vscode"),nls=require("vscode-nls"),cancellation_1=require("../utils/cancellation"),localize=nls.loadMessageBundle();function isImplicitProjectConfigFile(e){return e.startsWith("/dev/null/")}function inferredProjectCompilerOptions(e,o){const t={module:"commonjs",target:"ESNext",jsx:"preserve"};return o.checkJs&&(t.checkJs=!0,0===e&&(t.allowJs=!0)),o.experimentalDecorators&&(t.experimentalDecorators=!0),0===e&&(t.sourceMap=!0),t}function inferredProjectConfigSnippet(e,o){const t=inferredProjectCompilerOptions(e,o),i=Object.keys(t).map((e=>`"${e}": ${JSON.stringify(t[e])}`));return new vscode.SnippetString(`{\n\t"compilerOptions": {\n\t\t${i.join(",\n\t\t")}$0\n\t},\n\t"exclude": [\n\t\t"node_modules",\n\t\t"**/node_modules/*"\n\t]\n}`)}async function openOrCreateConfig(e,o,t){var i;const n=vscode.Uri.file(path.join(o,0===e?"tsconfig.json":"jsconfig.json")),r=null===(i=vscode.window.activeTextEditor)||void 0===i?void 0:i.viewColumn;try{const e=await vscode.workspace.openTextDocument(n);return vscode.window.showTextDocument(e,r)}catch(o){const i=await vscode.workspace.openTextDocument(n.with({scheme:"untitled"})),c=await vscode.window.showTextDocument(i,r);return 0===c.document.getText().length&&await c.insertSnippet(inferredProjectConfigSnippet(e,t)),c}}async function openProjectConfigOrPromptToCreate(e,o,t,i){var n;if(!isImplicitProjectConfigFile(i)){const e=await vscode.workspace.openTextDocument(i);return void vscode.window.showTextDocument(e,null===(n=vscode.window.activeTextEditor)||void 0===n?void 0:n.viewColumn)}const r={title:0===e?localize("typescript.configureTsconfigQuickPick","Configure tsconfig.json"):localize("typescript.configureJsconfigQuickPick","Configure jsconfig.json")};await vscode.window.showInformationMessage(0===e?localize("typescript.noTypeScriptProjectConfig","File is not part of a TypeScript project. Click [here]({0}) to learn more.","https://go.microsoft.com/fwlink/?linkid=841896"):localize("typescript.noJavaScriptProjectConfig","File is not part of a JavaScript project Click [here]({0}) to learn more.","https://go.microsoft.com/fwlink/?linkid=759670"),r)!==r||openOrCreateConfig(e,t,o.configuration)}async function openProjectConfigForFile(e,o,t){const i=o.getWorkspaceRootForResource(t);if(!i)return void vscode.window.showInformationMessage(localize("typescript.projectConfigNoWorkspace","Please open a folder in VS Code to use a TypeScript or JavaScript project"));const n=o.toPath(t);if(!n||!await o.toPath(t))return void vscode.window.showWarningMessage(localize("typescript.projectConfigUnsupportedFile","Could not determine TypeScript or JavaScript project. Unsupported file type"));let r;try{r=await o.execute("projectInfo",{file:n,needFileNameList:!1},cancellation_1.nulToken)}catch(e){}if("response"===(null==r?void 0:r.type)&&r.body)return openProjectConfigOrPromptToCreate(e,o,i,r.body.configFileName);vscode.window.showWarningMessage(localize("typescript.projectConfigCouldNotGetInfo","Could not determine TypeScript or JavaScript project"))}exports.isImplicitProjectConfigFile=isImplicitProjectConfigFile,exports.inferredProjectCompilerOptions=inferredProjectCompilerOptions,exports.openOrCreateConfig=openOrCreateConfig,exports.openProjectConfigOrPromptToCreate=openProjectConfigOrPromptToCreate,exports.openProjectConfigForFile=openProjectConfigForFile;