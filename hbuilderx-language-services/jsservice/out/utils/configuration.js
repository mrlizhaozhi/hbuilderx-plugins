"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TypeScriptServiceConfiguration=exports.TsServerLogLevel=void 0;const os=require("os"),path=require("path"),vscode=require("vscode"),objects=require("../utils/objects"),arrays=require("./arrays");var TsServerLogLevel;!function(e){e[e.Off=0]="Off",e[e.Normal=1]="Normal",e[e.Terse=2]="Terse",e[e.Verbose=3]="Verbose"}(TsServerLogLevel=exports.TsServerLogLevel||(exports.TsServerLogLevel={})),function(e){e.fromString=function(r){switch(r&&r.toLowerCase()){case"normal":return e.Normal;case"terse":return e.Terse;case"verbose":return e.Verbose;default:return e.Off}},e.toString=function(r){switch(r){case e.Normal:return"normal";case e.Terse:return"terse";case e.Verbose:return"verbose";case e.Off:default:return"off"}}}(TsServerLogLevel=exports.TsServerLogLevel||(exports.TsServerLogLevel={}));class TypeScriptServiceConfiguration{constructor(){this.tsServerLogLevel=TsServerLogLevel.Off;const e=vscode.workspace.getConfiguration();this.locale=TypeScriptServiceConfiguration.extractLocale(e),this.globalTsdk=TypeScriptServiceConfiguration.extractGlobalTsdk(e),this.localTsdk=TypeScriptServiceConfiguration.extractLocalTsdk(e),this.npmLocation=TypeScriptServiceConfiguration.readNpmLocation(e),this.tsServerLogLevel=TypeScriptServiceConfiguration.readTsServerLogLevel(e),this.tsServerPluginPaths=TypeScriptServiceConfiguration.readTsServerPluginPaths(e),this.checkJs=TypeScriptServiceConfiguration.readCheckJs(e),this.experimentalDecorators=TypeScriptServiceConfiguration.readExperimentalDecorators(e),this.disableAutomaticTypeAcquisition=TypeScriptServiceConfiguration.readDisableAutomaticTypeAcquisition(e),this.separateSyntaxServer=TypeScriptServiceConfiguration.readUseSeparateSyntaxServer(e),this.enableProjectDiagnostics=TypeScriptServiceConfiguration.readEnableProjectDiagnostics(e),this.maxTsServerMemory=TypeScriptServiceConfiguration.readMaxTsServerMemory(e),this.enablePromptUseWorkspaceTsdk=TypeScriptServiceConfiguration.readEnablePromptUseWorkspaceTsdk(e),this.watchOptions=TypeScriptServiceConfiguration.readWatchOptions(e),this.includePackageJsonAutoImports=TypeScriptServiceConfiguration.readIncludePackageJsonAutoImports(e)}static loadFromWorkspace(){return new TypeScriptServiceConfiguration}isEqualTo(e){return this.locale===e.locale&&this.globalTsdk===e.globalTsdk&&this.localTsdk===e.localTsdk&&this.npmLocation===e.npmLocation&&this.tsServerLogLevel===e.tsServerLogLevel&&this.checkJs===e.checkJs&&this.experimentalDecorators===e.experimentalDecorators&&this.disableAutomaticTypeAcquisition===e.disableAutomaticTypeAcquisition&&arrays.equals(this.tsServerPluginPaths,e.tsServerPluginPaths)&&this.separateSyntaxServer===e.separateSyntaxServer&&this.enableProjectDiagnostics===e.enableProjectDiagnostics&&this.maxTsServerMemory===e.maxTsServerMemory&&objects.equals(this.watchOptions,e.watchOptions)&&this.enablePromptUseWorkspaceTsdk===e.enablePromptUseWorkspaceTsdk&&this.includePackageJsonAutoImports===e.includePackageJsonAutoImports}static fixPathPrefixes(e){const r=["~"+path.sep];for(const t of r)if(e.startsWith(t))return path.join(os.homedir(),e.slice(t.length));return e}static extractGlobalTsdk(e){const r=e.get("typescript.tsdk","");return r?this.fixPathPrefixes(r):null}static extractLocalTsdk(e){const r=e.get("typescript.tsdk","");return r?this.fixPathPrefixes(r):null}static readTsServerLogLevel(e){const r=e.get("typescript.tsserver.log","off");return TsServerLogLevel.fromString(r)}static readTsServerPluginPaths(e){return e.get("typescript.tsserver.pluginPaths",[])}static readCheckJs(e){return e.get("javascript.implicitProjectConfig.checkJs",!1)}static readExperimentalDecorators(e){return e.get("javascript.implicitProjectConfig.experimentalDecorators",!1)}static readNpmLocation(e){return e.get("typescript.npm",null)}static readDisableAutomaticTypeAcquisition(e){return e.get("typescript.disableAutomaticTypeAcquisition",!1)}static extractLocale(e){return e.get("typescript.locale",null)}static readUseSeparateSyntaxServer(e){return!0===e.get("typescript.tsserver.useSeparateSyntaxServer",!0)?1:0}static readEnableProjectDiagnostics(e){return e.get("typescript.tsserver.experimental.enableProjectDiagnostics",!1)}static readWatchOptions(e){return e.get("typescript.tsserver.watchOptions")}static readIncludePackageJsonAutoImports(e){return e.get("typescript.preferences.includePackageJsonAutoImports")}static readMaxTsServerMemory(e){const r=e.get("typescript.tsserver.maxTsServerMemory",3072);return Number.isSafeInteger(r)?Math.max(r,128):3072}static readEnablePromptUseWorkspaceTsdk(e){return e.get("typescript.enablePromptUseWorkspaceTsdk",!1)}}exports.TypeScriptServiceConfiguration=TypeScriptServiceConfiguration;