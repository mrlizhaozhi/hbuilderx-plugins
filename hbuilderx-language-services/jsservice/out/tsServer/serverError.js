"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TypeScriptServerError=void 0;class TypeScriptServerError extends Error{constructor(r,e,s,t,i,n){super(`<${r}> TypeScript Server Error (${e.displayName})\n${t}\n${i}`),this.serverId=r,this.version=e,this.response=s,this.serverMessage=t,this.serverStack=i,this.sanitizedStack=n}static create(r,e,s){const t=TypeScriptServerError.parseErrorText(s);return new TypeScriptServerError(r,e,s,null==t?void 0:t.message,null==t?void 0:t.stack,null==t?void 0:t.sanitizedStack)}get serverErrorText(){return this.response.message}get serverCommand(){return this.response.command}get telemetry(){return{command:this.serverCommand,serverid:this.serverId,sanitizedstack:this.sanitizedStack||""}}static parseErrorText(r){const e=r.message;if(e){const r="Error processing request. ";if(e.startsWith(r)){const s=e.substr(r.length),t=s.indexOf("\n");if(t>=0){const r=s.substring(t+1);return{message:s.substring(0,t),stack:r,sanitizedStack:TypeScriptServerError.sanitizeStack(r)}}}}}static sanitizeStack(r){if(!r)return"";const e=/(\btsserver)?(\.(?:ts|tsx|js|jsx)(?::\d+(?::\d+)?)?)\)?$/gim;let s="";for(;;){const t=e.exec(r);if(!t)break;s+=`${t[1]||"suppressed"}${t[2]}\n`}return s}}exports.TypeScriptServerError=TypeScriptServerError;