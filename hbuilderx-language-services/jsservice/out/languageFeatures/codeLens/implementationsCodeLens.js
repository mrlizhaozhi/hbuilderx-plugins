"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.register=void 0;const vscode=require("vscode"),nls=require("vscode-nls"),PConst=require("../../protocol.const"),typescriptService_1=require("../../typescriptService"),dependentRegistration_1=require("../../utils/dependentRegistration"),typeConverters=require("../../utils/typeConverters"),baseCodeLensProvider_1=require("./baseCodeLensProvider"),localize=nls.loadMessageBundle();class TypeScriptImplementationsCodeLensProvider extends baseCodeLensProvider_1.TypeScriptBaseCodeLensProvider{async resolveCodeLens(e,t){const n=e,r=typeConverters.Position.toFileLocationRequestArgs(n.file,n.range.start),o=await this.client.execute("implementation",r,t,{lowPriority:!0,cancelOnResourceChange:n.document});if("response"!==o.type||!o.body)return n.command="cancelled"===o.type?baseCodeLensProvider_1.TypeScriptBaseCodeLensProvider.cancelledCommand:baseCodeLensProvider_1.TypeScriptBaseCodeLensProvider.errorCommand,n;const i=o.body.map((e=>new vscode.Location(this.client.toResource(e.file),e.start.line===e.end.line?typeConverters.Range.fromTextSpan(e):new vscode.Range(typeConverters.Position.fromLocation(e.start),new vscode.Position(e.start.line,0))))).filter((e=>!(e.uri.toString()===n.document.toString()&&e.range.start.line===n.range.start.line&&e.range.start.character===n.range.start.character)));return n.command=this.getCommand(i,n),n}getCommand(e,t){return{title:this.getTitle(e),command:e.length?"editor.action.showReferences":"",arguments:[t.document,t.range.start,e]}}getTitle(e){return 1===e.length?localize("oneImplementationLabel","1 implementation"):localize("manyImplementationLabel","{0} implementations",e.length)}extractSymbol(e,t,n){switch(t.kind){case PConst.Kind.interface:return(0,baseCodeLensProvider_1.getSymbolRange)(e,t);case PConst.Kind.class:case PConst.Kind.method:case PConst.Kind.memberVariable:case PConst.Kind.memberGetAccessor:case PConst.Kind.memberSetAccessor:if(t.kindModifiers.match(/\babstract\b/g))return(0,baseCodeLensProvider_1.getSymbolRange)(e,t)}return null}}function register(e,t,n,r){return(0,dependentRegistration_1.conditionalRegistration)([(0,dependentRegistration_1.requireConfiguration)(t,"implementationsCodeLens.enabled"),(0,dependentRegistration_1.requireSomeCapability)(n,typescriptService_1.ClientCapability.Semantic)],(()=>vscode.languages.registerCodeLensProvider(e.semantic,new TypeScriptImplementationsCodeLensProvider(n,r))))}exports.default=TypeScriptImplementationsCodeLensProvider,exports.register=register;