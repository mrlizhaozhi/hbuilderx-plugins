"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.register=void 0;const vscode=require("vscode"),typescriptService_1=require("../typescriptService"),api_1=require("../utils/api"),dependentRegistration_1=require("../utils/dependentRegistration"),typeConverters=require("../utils/typeConverters"),definitionProviderBase_1=require("./definitionProviderBase");class TypeScriptDefinitionProvider extends definitionProviderBase_1.default{constructor(e){super(e)}async provideDefinition(e,t,i){if(this.client.apiVersion.gte(api_1.default.v270)){const r=this.client.toOpenedFilePath(e);if(!r)return;const n=typeConverters.Position.toFileLocationRequestArgs(r,t),o=await this.client.execute("definitionAndBoundSpan",n,i);if("response"!==o.type||!o.body)return;const s=o.body.textSpan?typeConverters.Range.fromTextSpan(o.body.textSpan):void 0;return o.body.definitions.map((e=>{const t=typeConverters.Location.fromTextSpan(this.client.toResource(e.file),e);return e.contextStart&&e.contextEnd?{originSelectionRange:s,targetRange:typeConverters.Range.fromLocations(e.contextStart,e.contextEnd),targetUri:t.uri,targetSelectionRange:t.range}:{originSelectionRange:s,targetRange:t.range,targetUri:t.uri}}))}return this.getSymbolLocations("definition",e,t,i)}}function register(e,t){return(0,dependentRegistration_1.conditionalRegistration)([(0,dependentRegistration_1.requireSomeCapability)(t,typescriptService_1.ClientCapability.EnhancedSyntax,typescriptService_1.ClientCapability.Semantic)],(()=>vscode.languages.registerDefinitionProvider(e.syntax,new TypeScriptDefinitionProvider(t))))}exports.default=TypeScriptDefinitionProvider,exports.register=register;