"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.register=exports.OrganizeImportsCodeActionProvider=void 0;const vscode=require("vscode"),nls=require("vscode-nls"),typescriptService_1=require("../typescriptService"),api_1=require("../utils/api"),cancellation_1=require("../utils/cancellation"),dependentRegistration_1=require("../utils/dependentRegistration"),typeconverts=require("../utils/typeConverters"),localize=nls.loadMessageBundle();class OrganizeImportsCommand{constructor(e,t){this.client=e,this.telemetryReporter=t,this.id=OrganizeImportsCommand.Id}async execute(e){this.telemetryReporter.logTelemetry("organizeImports.execute",{});const t={scope:{type:"file",args:{file:e}}},r=await this.client.interruptGetErr((()=>this.client.execute("organizeImports",t,cancellation_1.nulToken)));if("response"!==r.type||!r.body)return!1;const i=typeconverts.WorkspaceEdit.fromFileCodeEdits(this.client,r.body);return vscode.workspace.applyEdit(i)}}OrganizeImportsCommand.Id="_typescript.organizeImports";class OrganizeImportsCodeActionProvider{constructor(e,t,r,i){this.client=e,this.fileConfigManager=r,this.metadata={providedCodeActionKinds:[vscode.CodeActionKind.SourceOrganizeImports]},t.register(new OrganizeImportsCommand(e,i))}provideCodeActions(e,t,r,i){const o=this.client.toOpenedFilePath(e);if(!o)return[];if(!r.only||!r.only.contains(vscode.CodeActionKind.SourceOrganizeImports))return[];this.fileConfigManager.ensureConfigurationForDocument(e,i);const n=new vscode.CodeAction(localize("organizeImportsAction.title","Organize Imports"),vscode.CodeActionKind.SourceOrganizeImports);return n.command={title:"",command:OrganizeImportsCommand.Id,arguments:[o]},[n]}}function register(e,t,r,i,o){return(0,dependentRegistration_1.conditionalRegistration)([(0,dependentRegistration_1.requireMinVersion)(t,OrganizeImportsCodeActionProvider.minVersion),(0,dependentRegistration_1.requireSomeCapability)(t,typescriptService_1.ClientCapability.Semantic)],(()=>{const n=new OrganizeImportsCodeActionProvider(t,r,i,o);return vscode.languages.registerCodeActionsProvider(e.semantic,n,n.metadata)}))}exports.OrganizeImportsCodeActionProvider=OrganizeImportsCodeActionProvider,OrganizeImportsCodeActionProvider.minVersion=api_1.default.v280,exports.register=register;