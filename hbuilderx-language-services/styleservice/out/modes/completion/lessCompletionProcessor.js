"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.LessCompletionProcessor=void 0;const vscode_languageserver_1=require("vscode-languageserver"),vscode_uri_1=require("vscode-uri"),core_1=require("../../../../core"),entry_1=require("../../../../htmlservice/entry"),extraProcessor_1=require("../grammar/extraProcessor"),util_1=require("../utils/util"),baseCompletionProcessor_1=require("./baseCompletionProcessor"),{LESSScanner:LESSScanner}=require("vscode-css-languageservice/lib/umd/parser/lessScanner");class LessCompletionProcessor extends baseCompletionProcessor_1.BaseCompletionProcessor{constructor(){super(...arguments),this.baseCompletionProcessor=new baseCompletionProcessor_1.BaseCompletionProcessor}getTagCompletionData(e,t,o,r,s){if(!(0,util_1.styleIsRightCompletionType)(r,[core_1.NodeType.Media,core_1.NodeType.MediaQuery],void 0,core_1.NodeType.Media))return s;const i=t.offsetAt(o),a=(0,core_1.getContextData)(t,i,void 0).leftText;let n={uri:vscode_uri_1.URI.parse(e.sourceRoot).toString(),name:e.sourceRoot},l=(0,entry_1.getHtmlTags)(n),c=vscode_languageserver_1.Position.create(o.line,o.character-a.length);for(const e of l)s.items.push({label:e,textEdit:vscode_languageserver_1.TextEdit.replace(vscode_languageserver_1.Range.create(c,o),e),kind:vscode_languageserver_1.CompletionItemKind.Keyword,data:{hxKind:core_1.HxIconKind.ELEMENT}});return s}getScopedFunctionsCompletionData(e,t,o,r,s){if(!r)return s;const i=t.offsetAt(o),a=(0,core_1.getContextData)(t,i,' \t\n\r":{[()]},*>+;');if(""===a.context){if(!(0,util_1.styleIsRightCompletionType)(r,[core_1.NodeType.Declarations,core_1.NodeType.Ruleset],void 0,core_1.NodeType.Value))return s}else{const e=(0,util_1.styleIsRightCompletionType)(r,[core_1.NodeType.Identifier,core_1.NodeType.Term],void 0,core_1.NodeType.Value);if(r.parentType===core_1.NodeType.MixinReference)return s;if(!e)return s}let n=vscode_uri_1.URI.parse(t.uri).fsPath;if(n.includes(".nvue.")||n.includes(".vue."))for(const e of extraProcessor_1.vueStyleScopedFunction)s.items.push({label:e.label,textEdit:vscode_languageserver_1.TextEdit.replace(a.contextRange,e.insertText),kind:vscode_languageserver_1.CompletionItemKind.Function,data:{hxKind:core_1.HxIconKind.FUNCTION}});return s}getExtraCompletionData(e,t,o,r,s){return s=this.baseCompletionProcessor.getExtraCompletionData(e,t,o,r,s),s=this.getTagCompletionData(e,t,o,r,s),s=this.getScopedFunctionsCompletionData(e,t,o,r,s)}doExtraCompletion(e,t,o,r,s,i,a){const n=this.isErrorAstNode(t,o,r);let l=this.getCompletionTypeFromAstNode(t,o,r);return(n||0===s.items.length)&&(l=this.getCompletionTypeFromScanner(t,o),s=this.getCompletionDataFromScanner(t,o,l,a)),s.items&&(s.items=s.items.map((e=>(e=this.initData(e),e=this.kindConverted(e))))),s=this.getDeprecatedCompletionData(t,o,l,s),s=this.getFunctionsCompletionData(t,o,l,s),s=this.getMediaCompletionData(t,o,l,s),s=this.getCharsetCompletionData(t,o,l,s),s=this.getPathCompletionData(e,t,o,l,s),s=this.getPropertySelectorCompletionData(e,t,o,l,s),s=this.getExtraCompletionData(e,t,o,l,s),s=this.getSelfIdSelectorCompletionData(t,o,l,s),s=this.getIndexIdSelectorsCompletionData(e,t,o,l,s),s=this.getIndexClassSelectorsCompletionData(e,t,o,l,s),s=this.getGrammarCompletionData(e,t,o,l,s),s=this.getPxConversionCompletionData(e,t,o,l,s,i),s=this.getDeduplicationData(s),s=this.getFiltrationPseudoData(t,o,l,s),s=this.retrieveRange(t,o,l,s),s=this.getMoveCursorData(t,o,l,s),s=this.getAltMode(t,o,s),s=this.setData(s)}}exports.LessCompletionProcessor=LessCompletionProcessor;