"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const fs=require("fs"),path=require("path"),vscode_languageserver_protocol_1=require("vscode-languageserver-protocol"),core_1=require("../../../core");function getUniModuleActionNames(e,t){let r=[],o=(0,core_1.getUniModulesDir)(),n=path.join(e,o);if(fs.existsSync(n)&&fs.statSync(n).isDirectory()){let e=fs.readdirSync(n);for(let o of e){let e=path.join(n,o);if(fs.statSync(e).isDirectory())for(let o=0;o<core_1.providers.length;++o){let o=path.join(e,"/uniCloud/cloudfunctions/uni-clientDB-actions");if(fs.existsSync(o)&&fs.statSync(o).isDirectory()){let e=fs.readdirSync(o);for(let n=0;n<e.length;++n){let i=path.basename(e[n],".js");if(i==t)return[path.join(o,e[n])];r.push(i)}}}}}return r}class ClientDBActionHandler{doComplete(e,t,r,o,n,i){let l=[],a=new Set,s=r.project.fsPath;for(let e=0;e<core_1.providers.length;++e){let t=path.join(s,(0,core_1.getCloudActionRoot)(core_1.providers[e]));fs.existsSync(t)&&fs.readdirSync(t).forEach((e=>{let t=e.substr(0,e.lastIndexOf("."));a.add(t)}))}return getUniModuleActionNames(s).forEach((e=>{a.add(e)})),a.forEach((e=>{l.push({label:e,kind:vscode_languageserver_protocol_1.CompletionItemKind.Property,documentation:e})})),l}doCompleteResolve(e,t,r,o,n){return e}doHover(e,t,r,o){}doDefinition(e,t,r,o){let n=e.getText(r.range),i=r.project.fsPath;for(let e=0;e<core_1.providers.length;++e){let t=path.join(i,(0,core_1.getCloudActionRoot)(core_1.providers[e]));if(!fs.existsSync(t))continue;let o=fs.readdirSync(t);for(let e=0;e<o.length;++e){if(path.basename(o[e],".js")==n)return[{targetUri:path.join(t,o[e]),targetRange:(0,core_1.getNullRange)(),targetSelectionRange:(0,core_1.getNullRange)(),originSelectionRange:r.range}]}}let l=getUniModuleActionNames(i,n);return 1===l.length?[{targetUri:l[0],targetRange:(0,core_1.getNullRange)(),targetSelectionRange:(0,core_1.getNullRange)(),originSelectionRange:r.range}]:[]}doReference(e,t,r,o){return[]}}exports.default=ClientDBActionHandler;