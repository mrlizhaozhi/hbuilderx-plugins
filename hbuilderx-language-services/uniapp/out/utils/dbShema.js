"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getDbSchemaFields=void 0;const fs=require("fs"),path=require("path"),out_1=require("../../../core/out");function readDbSchemaFields(e){let s=[];try{const i=JSON.parse((0,out_1.readFileToString)(e)).properties;Object.keys(i).forEach((e=>{"_id"!==e&&s.push({name:e,type:i[e].bsonType?i[e].bsonType:"string",description:i[e].description?i[e].description:""})}))}catch(e){}return s}function readSpecifyDbSchemaFields(e,s){return readDbSchemaFields(e).filter((e=>s.has(e.name)))}function getDbSchemaFields(e,s,i){let t=[];if(e.kind!=out_1.HXProjectKind.UniApp&&e.kind!=out_1.HXProjectKind.UniApp_Cli)return t;const a=path.join(e.fsPath,"uniCloud-aliyun/database");fs.existsSync(a)&&s.forEach((e=>{const s=path.join(a,e+".schema.json");fs.existsSync(s)&&t.push({name:e,fields:i?readSpecifyDbSchemaFields(s,i):readDbSchemaFields(s)})}));const n=path.join(e.fsPath,"uniCloud-tcb/database");fs.existsSync(n)&&s.forEach((e=>{const s=path.join(n,e+".schema.json");fs.existsSync(s)&&t.push({name:e,fields:i?readSpecifyDbSchemaFields(s,i):readDbSchemaFields(s)})}));let c=e.kind===out_1.HXProjectKind.UniApp_Cli?path.join(e.fsPath,"uni_modules"):path.join(e.fsPath,"src/uni_modules");if(fs.existsSync(c)){fs.readdirSync(c).forEach((e=>{const a=path.join(c,e,"uniCloud/database");fs.existsSync(a)&&s.forEach((e=>{const s=path.join(a,e+".schema.json");fs.existsSync(s)&&t.push({name:e,fields:i?readSpecifyDbSchemaFields(s,i):readDbSchemaFields(s)})}))}))}return t}exports.getDbSchemaFields=getDbSchemaFields;