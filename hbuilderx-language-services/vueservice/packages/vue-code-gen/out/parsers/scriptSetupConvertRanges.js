"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.parseUseScriptSetupRanges=exports.parseUnuseScriptSetupRanges=void 0;const scriptSetupRanges_1=require("./scriptSetupRanges");function parseUnuseScriptSetupRanges(e,t){const s=[],n=(0,scriptSetupRanges_1.parseBindingRanges)(e,t,!1);let i,r,o,a;const p=new Map;return t.forEachChild((e=>{l(e,t,void 0)})),i&&"typeArgs"in i&&i.typeArgs.length&&t.forEachChild((e=>{u(e)})),{imports:s,defineProps:i,defineEmits:r,useSlots:o,useAttrs:a,bindings:n};function g(e){return(0,scriptSetupRanges_1.getStartEnd)(e,t)}function l(n,u,c){var m;if(e.isImportDeclaration(n))s.push(g(n));else if(e.isCallExpression(n)&&e.isIdentifier(n.expression)){const s=n.expression.getText(t),l=e.isVariableDeclaration(u)?u:void 0,d=l&&null!=c?c:n,f=l?g(l.name):void 0,h=(null===(m=n.typeArguments)||void 0===m?void 0:m.length)&&e.isTypeLiteralNode(n.typeArguments[0])?n.typeArguments[0]:void 0;if("defineProps"===s&&n.arguments.length&&(i={range:g(d),binding:f,args:g(n.arguments[0])}),"defineEmits"===s&&n.arguments.length&&(r={range:g(d),binding:f,args:g(n.arguments[0])}),"useSlots"===s&&(o={range:g(d),binding:f}),"useAttrs"===s&&(a={range:g(d),binding:f}),"defineProps"===s&&h){i={range:g(d),binding:f,typeArgs:[]};for(const s of h.members)if(e.isPropertySignature(s)&&s.type){const e=g(s.name),n=g(s.type);i.typeArgs.push({name:e,type:n,required:!s.questionToken,default:void 0}),p.set(s.name.getText(t),i.typeArgs[i.typeArgs.length-1])}}if("defineEmits"===s&&h){r={range:g(d),binding:f,typeArgs:[]};for(const s of h.members)if(e.isCallSignatureDeclaration(s)&&s.parameters.length){const e=s.parameters[0].type;if(e){let n;if(s.parameters.length>=2){const e=s.parameters[1],i=s.parameters[s.parameters.length-1];n={start:e.getStart(t),end:i.getEnd()}}r.typeArgs.push({name:g(e),restArgs:n})}}}}n.forEachChild((e=>l(e,n,u)))}function u(s){if(e.isCallExpression(s)&&e.isIdentifier(s.expression)&&"withDefaults"===s.expression.getText(t)&&s.arguments.length>=2){const n=s.arguments[1];if(e.isObjectLiteralExpression(n))for(const s of n.properties)if(s.name){const n=e.isPropertyAssignment(s)?s.initializer:s.name,i=s.name.getText(t),r=p.get(i);r&&(r.default=g(n))}}s.forEachChild((e=>u(e)))}}function parseUseScriptSetupRanges(e,t){const s=[];let n,i,r,o;const a=[],p=[];return t.forEachChild((l=>{var u,c;if(e.isImportDeclaration(l))s.push(g(l));else if(e.isExportAssignment(l)){let s;if(e.isObjectLiteralExpression(l.expression))s=l.expression;else if(e.isCallExpression(l.expression)&&l.expression.arguments.length){const t=l.expression.arguments[0];e.isObjectLiteralExpression(t)&&(s=t)}if(n=g(l),s)for(const n of s.properties){const s=null===(u=n.name)||void 0===u?void 0:u.getText(t);let p;if("props"===s&&e.isPropertyAssignment(n)?i=g(n.initializer):"emits"===s&&e.isPropertyAssignment(n)?r=g(n.initializer):"setup"===s&&e.isPropertyAssignment(n)&&e.isArrowFunction(n.initializer)?p=n.initializer:"setup"===s&&e.isMethodDeclaration(n)?p=n:"components"===s||a.push(g(n)),null==p?void 0:p.body){if(o={props:void 0,context:void 0,body:g(p.body),bodyReturn:void 0},p.parameters.length>=1&&(o.props=g(p.parameters[0].name)),p.parameters.length>=2){const s=p.parameters[1];if(e.isObjectBindingPattern(s.name)){o.context={emit:void 0,slots:void 0,attrs:void 0};for(const e of s.name.elements){const s=(null!==(c=e.propertyName)&&void 0!==c?c:e.name).getText(t);"emit"===s?o.context.emit=g(e.name):"slots"===s?o.context.slots=g(e.name):"attrs"===s&&(o.context.attrs=g(e.name))}}else o.context=g(s.name)}p.body.forEachChild((t=>{e.isReturnStatement(t)&&(o.bodyReturn=g(t))}))}}}else p.push(g(l))})),{imports:s,exportDefault:n,propsOption:i,emitsOption:r,setupOption:o,otherOptions:a,otherScriptStatements:p};function g(e){return(0,scriptSetupRanges_1.getStartEnd)(e,t)}}exports.parseUnuseScriptSetupRanges=parseUnuseScriptSetupRanges,exports.parseUseScriptSetupRanges=parseUseScriptSetupRanges;