"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&__createBinding(t,e,n);return __setModuleDefault(t,e),t};Object.defineProperty(exports,"__esModule",{value:!0}),exports.genConstructorOverloads=exports.generate=exports.getVueLibraryName=exports.getSlotsPropertyName=void 0;const code_gen_1=require("../../../code-gen"),SourceMaps=__importStar(require("../../../source-map")),shared_1=require("@vue/shared"),path=__importStar(require("path"));function getSlotsPropertyName(e){return e<3?"$scopedSlots":"$slots"}function getVueLibraryName(e){return e<2.7?"@vue/runtime-dom":"vue"}function generate(e,t,n,r,s,i,a,o,d,p,u,c,f){const l=getVueLibraryName(u),g=new code_gen_1.CodeGen,x=[],T={DefinePropsToOptions:!1,mergePropDefaults:!1,ConstructorOverloads:!1};let m,_;return"template"===e&&(c||g.addText("// @ts-nocheck\n")),function(){if(!(null==n?void 0:n.src))return;let t=n.src;t.endsWith(".d.ts")?t=t.substring(0,t.length-".d.ts".length):t.endsWith(".ts")?t=t.substring(0,t.length-".ts".length):t.endsWith(".tsx")&&(t=t.substring(0,t.length-".tsx".length));g.addText("export * from "),g.addCode(`'${t}'`,{start:-1,end:-1},SourceMaps.Mode.Offset,{vueTag:"scriptSrc",capabilities:{basic:"script"===e,references:!0,definitions:"script"===e,rename:!0,diagnostic:"script"===e,completion:"script"===e,semanticTokens:"script"===e}}),g.addText(";\n"),g.addText(`export { default } from '${t}';\n`)}(),function(){if(!r)return;if(!i)return;g.addCode(r.content.substring(0,i.importSectionEndOffset),{start:0,end:i.importSectionEndOffset},SourceMaps.Mode.Offset,{vueTag:"scriptSetup",capabilities:{basic:"script"===e,references:!0,definitions:"script"===e,diagnostic:"script"===e,rename:!0,completion:"script"===e,semanticTokens:"script"===e}})}(),function(){if(!n)return;if(r&&(null==s?void 0:s.exportDefault))S("script",0,s.exportDefault.expression.start),m=g.getText().length-(s.exportDefault.expression.start-s.exportDefault.start);else{let t=!1;if((null==s?void 0:s.exportDefault)&&(t=n.content.substring(s.exportDefault.expression.start,s.exportDefault.expression.end).startsWith("{")),t&&d&&(null==s?void 0:s.exportDefault)){S("script",0,s.exportDefault.expression.start),g.addText(`(await import('${l}')).defineComponent(`);let t=s.exportDefault.argsNode;if(t){g.addText("{");let n=!1,r=!1;t.forEachChild((e=>{if(f.isPropertyAssignment(e)&&f.isIdentifier(e.name)){if("props"===e.name.escapedText&&f.isArrayLiteralExpression(e.initializer)){let t=e.initializer;S("script",e.name.pos,e.name.end),g.addText(":"),g.addText("{"),t.elements.forEach((e=>{f.isStringLiteralLike(e)?(S("script",e.pos,e.end),g.addText(":any")):S("script",e.pos,e.end),g.addText(",")})),g.addText("}")}else S("script",e.pos,e.end);"data"===e.name.escapedText&&(n=!0),"props"===e.name.escapedText&&(r=!0)}else S("script",e.pos,e.end);f.isFunctionLike(e)&&e.name&&f.isIdentifier(e.name)&&"data"===e.name.escapedText&&(n=!0),g.addText(",\n")})),"template"===e&&(n||g.addText("\ndata:()=>{},"),r||g.addText("\nprops:{},")),g.addText("}")}else S("script",s.exportDefault.expression.start,s.exportDefault.expression.end);g.addText(")"),S("script",s.exportDefault.expression.end,n.content.length)}else S("script",0,n.content.length)}}(),function(){var d;if(!r)return;if(!i)return;(null==s?void 0:s.exportDefault)?g.addText("await (async () => {\n"):(m=g.getText().length,g.addText("export default await (async () => {\n"));g.addCode(r.content.substring(i.importSectionEndOffset),{start:i.importSectionEndOffset,end:r.content.length},SourceMaps.Mode.Offset,{vueTag:"scriptSetup",capabilities:{basic:"script"===e,references:!0,definitions:"script"===e,diagnostic:"script"===e,rename:!0,completion:"script"===e,semanticTokens:"script"===e}}),i.propsTypeArg&&(null==i?void 0:i.withDefaultsArg)&&(g.addText("const __VLS_withDefaultsArg = (function <T>(t: T) { return t })("),y("scriptSetup",i.withDefaultsArg.start,i.withDefaultsArg.end),g.addText(");\n"));(null==s?void 0:s.exportDefault)&&s.exportDefault.expression.start!==s.exportDefault.args.start?(g.addText("const __VLS_Component = "),S("script",s.exportDefault.expression.start,s.exportDefault.args.start),g.addText("{\n")):g.addText(`const __VLS_Component = (await import('${l}')).defineComponent({\n`);if(r&&i){p||((i.propsRuntimeArg||i.propsTypeArg)&&(g.addText("props: ("),i.propsTypeArg?(T.DefinePropsToOptions=!0,g.addText("{} as "),i.withDefaultsArg&&(T.mergePropDefaults=!0,g.addText("__VLS_WithDefaults<")),g.addText("__VLS_TypePropsToRuntimeProps<"),y("scriptSetup",i.propsTypeArg.start,i.propsTypeArg.end),g.addText(">"),i.withDefaultsArg&&(g.addText(", typeof __VLS_withDefaultsArg"),g.addText(">"))):i.propsRuntimeArg&&y("scriptSetup",i.propsRuntimeArg.start,i.propsRuntimeArg.end),g.addText("),\n")),i.emitsTypeArg?(T.ConstructorOverloads=!0,g.addText("emits: ({} as __VLS_UnionToIntersection<__VLS_ConstructorOverloads<"),y("scriptSetup",i.emitsTypeArg.start,i.emitsTypeArg.end),g.addText(">>),\n")):i.emitsRuntimeArg&&(g.addText("emits: ("),y("scriptSetup",i.emitsRuntimeArg.start,i.emitsRuntimeArg.end),g.addText("),\n")));const t=[];if(i&&t.push({bindings:i.bindings,content:r.content,vueTag:"scriptSetup"}),s&&n&&t.push({bindings:s.bindings,content:n.content,vueTag:"script"}),g.addText("setup() {\n"),"script"===e){g.addText("() => {\n");for(const e of o())g.addText("// @ts-ignore\n"),g.addText(e+";\n");!function(){const e=a();if(!e)return;let t=[];i&&(t=t.concat(i.bindings.map((e=>{var t;return null!==(t=null==r?void 0:r.content.substring(e.start,e.end))&&void 0!==t?t:""}))));s&&(t=t.concat(s.bindings.map((e=>{var t;return null!==(t=null==n?void 0:n.content.substring(e.start,e.end))&&void 0!==t?t:""}))));g.addText("// @ts-ignore\n"),g.addText("[");for(const n of t)(e.tagNames[n]||e.tagNames[(0,shared_1.hyphenate)(n)])&&g.addText(n+", ");for(const t of Object.keys(e.tagNames))t.indexOf(".")>=0&&g.addText(t+", ");g.addText("];\n"),g.addText("// @ts-ignore\n"),g.addText("["),g.addText([...e.identifiers].join(", ")),g.addText("];\n")}(),g.addText("};\n")}if(g.addText("return {\n"),p&&(i.propsTypeArg?(g.addText("$props: (await import('./__VLS_types')).makeOptional(defineProps<"),y("scriptSetup",i.propsTypeArg.start,i.propsTypeArg.end),g.addText(">()),\n")):i.propsRuntimeArg&&(g.addText("$props: (await import('./__VLS_types')).makeOptional(defineProps("),y("scriptSetup",i.propsRuntimeArg.start,i.propsRuntimeArg.end),g.addText(")),\n")),i.emitsAssignName?g.addText(`$emit: ${i.emitsAssignName},\n`):i.emitsTypeArg?(g.addText("$emit: defineEmits<"),y("scriptSetup",i.emitsTypeArg.start,i.emitsTypeArg.end),g.addText(">(),\n")):i.emitsRuntimeArg&&(g.addText("$emit: defineEmits("),y("scriptSetup",i.emitsRuntimeArg.start,i.emitsRuntimeArg.end),g.addText("),\n"))),"script"===e&&(i.exposeTypeArg?(g.addText("...({} as "),y("scriptSetup",i.exposeTypeArg.start,i.exposeTypeArg.end),g.addText("),\n")):i.exposeRuntimeArg&&(g.addText("...("),y("scriptSetup",i.exposeRuntimeArg.start,i.exposeRuntimeArg.end),g.addText("),\n"))),"template"===e){p&&(i.propsAssignName?g.addText(`...${i.propsAssignName},\n`):i.withDefaultsArg&&i.propsTypeArg?(g.addText("...withDefaults(defineProps<"),y("scriptSetup",i.propsTypeArg.start,i.propsTypeArg.end),g.addText(">(), "),y("scriptSetup",i.withDefaultsArg.start,i.withDefaultsArg.end),g.addText("),\n")):i.propsRuntimeArg&&(g.addText("...defineProps("),y("scriptSetup",i.propsRuntimeArg.start,i.propsRuntimeArg.end),g.addText("),\n")));for(const{bindings:e,content:n}of t)for(const t of e){const e=n.substring(t.start,t.end),r=g.addCode(e,t,SourceMaps.Mode.Offset,{vueTag:"scriptSetup",capabilities:{definitions:!0,references:!0}});g.addText(": ");const s=g.addText(e);g.addText(",\n"),x.push({sourceRange:s,mappedRange:r,mode:SourceMaps.Mode.Offset,data:{toSource:{capabilities:{definitions:!0,references:!0,rename:!0}},toTarget:{capabilities:{definitions:!0,references:!0,rename:!0}}}})}}g.addText("};\n"),g.addText("},\n")}n&&(null===(d=null==s?void 0:s.exportDefault)||void 0===d?void 0:d.args)&&S("script",s.exportDefault.args.start+1,s.exportDefault.args.end-1);g.addText("});\n"),"template"===e?g.addText("return __VLS_Component;\n"):(g.addText(`const __VLS_slots = (await import('./${path.basename(t)}.__VLS_template')).default;\n`),g.addText(`return {} as typeof __VLS_Component & (new () => { ${getSlotsPropertyName(u)}: typeof __VLS_slots });\n`));g.addText("})();"),_=g.getText().length,g.addText("\n")}(),function(){T.DefinePropsToOptions&&(g.addText("type __VLS_NonUndefinedable<T> = T extends undefined ? never : T;\n"),g.addText(`type __VLS_TypePropsToRuntimeProps<T> = { [K in keyof T]-?: {} extends Pick<T, K> ? { type: import('${l}').PropType<__VLS_NonUndefinedable<T[K]>> } : { type: import('${l}').PropType<T[K]>, required: true } };\n`));T.mergePropDefaults&&g.addText("type __VLS_WithDefaults<P, D> = {\n\t\t\t\t// use 'keyof Pick<P, keyof P>' instead of 'keyof P' to keep props jsdoc\n\t\t\t\t[K in keyof Pick<P, keyof P>]: K extends keyof D ? P[K] & {\n\t\t\t\t\tdefault: D[K]\n\t\t\t\t} : P[K]\n\t\t\t};\n");T.ConstructorOverloads&&(g.addText("type __VLS_UnionToIntersection<U> = (U extends unknown ? (arg: U) => unknown : never) extends ((arg: infer P) => unknown) ? P : never;\n"),i&&-1!==i.emitsTypeNums?g.addText(genConstructorOverloads("__VLS_ConstructorOverloads",i.emitsTypeNums)):g.addText(genConstructorOverloads("__VLS_ConstructorOverloads")))}(),function(){if(!n)return;r&&(null==s?void 0:s.exportDefault)&&S("script",s.exportDefault.end,n.content.length)}(),"script"===e&&(n||r?n&&!(null==s?void 0:s.exportDefault)&&g.addText("export default {} as any"):g.addCode("export default {} as any",{start:0,end:0},SourceMaps.Mode.Expand,{vueTag:void 0,capabilities:{}})),"template"===e&&(function(){var e;if(g.addText("\n"),g.addText("export const __VLS_options = {\n"),n&&(null===(e=null==s?void 0:s.exportDefault)||void 0===e?void 0:e.args)){const e=s.exportDefault.args;g.addText("...("),g.addCode(n.content.substring(e.start,e.end),e,SourceMaps.Mode.Offset,{vueTag:"script",capabilities:{references:!0,rename:!0}}),g.addText("),\n")}(null==i?void 0:i.propsRuntimeArg)&&r?(g.addText("props: ("),g.addCode(r.content.substring(i.propsRuntimeArg.start,i.propsRuntimeArg.end),i.propsRuntimeArg,SourceMaps.Mode.Offset,{vueTag:"scriptSetup",capabilities:{references:!0,definitions:!0,rename:!0}}),g.addText("),\n")):(null==i?void 0:i.propsTypeArg)&&r&&(g.addText("props: ({} as "),g.addCode(r.content.substring(i.propsTypeArg.start,i.propsTypeArg.end),i.propsTypeArg,SourceMaps.Mode.Offset,{vueTag:"scriptSetup",capabilities:{references:!0,definitions:!0,rename:!0}}),g.addText("),\n"));(null==i?void 0:i.emitsRuntimeArg)&&r?(g.addText("emits: ("),g.addCode(r.content.substring(i.emitsRuntimeArg.start,i.emitsRuntimeArg.end),i.emitsRuntimeArg,SourceMaps.Mode.Offset,{vueTag:"scriptSetup",capabilities:{references:!0,definitions:!0,rename:!0}}),g.addText("),\n")):(null==i?void 0:i.emitsTypeArg)&&r&&(g.addText("emits: ({} as "),g.addCode(r.content.substring(i.emitsTypeArg.start,i.emitsTypeArg.end),i.emitsTypeArg,SourceMaps.Mode.Offset,{vueTag:"scriptSetup",capabilities:{}}),g.addText("),\n"));g.addText("};\n")}(),function(){var e;if(g.addText("\n"),n&&(null===(e=null==s?void 0:s.exportDefault)||void 0===e?void 0:e.args)){const e=s.exportDefault.args;g.addText("export const __VLS_name = (await import('./__VLS_types')).getNameOption("),g.addText(`${n.content.substring(e.start,e.end)} as const`),g.addText(");\n")}else r?g.addText(`export declare const __VLS_name: '${path.basename(t.substring(0,t.lastIndexOf(".")))}';\n`):g.addText("export const __VLS_name = undefined;\n")}(),function(){const e=[];i&&r&&e.push({typeBindings:i.typeBindings,content:r.content});g.addText("export {\n");for(const t of e)for(const e of t.typeBindings){const n=t.content.substring(e.start,e.end);g.addText(`${n} as __VLS_types_${n},\n`)}g.addText("};\n")}()),"script"===e&&r&&g.addCode("",{start:r.content.length,end:r.content.length},SourceMaps.Mode.Offset,{vueTag:"scriptSetup",capabilities:{}}),r&&void 0!==m&&void 0!==_&&g.addMapping2({data:{vueTag:"scriptSetup",capabilities:{diagnostic:"script"===e}},mode:SourceMaps.Mode.Totally,mappedRange:{start:m,end:_},sourceRange:{start:0,end:r.content.length}}),{codeGen:g,teleports:x};function S(t,s,i){g.addCode(("script"===t?n:r).content.substring(s,i),{start:s,end:i},SourceMaps.Mode.Offset,{vueTag:t,capabilities:{basic:"script"===e,references:!0,definitions:"script"===e,rename:!0,diagnostic:!0,completion:"script"===e,semanticTokens:"script"===e}})}function y(e,t,s){g.addCode(("scriptSetup"===e?r:n).content.substring(t,s),{start:t,end:s},SourceMaps.Mode.Offset,{vueTag:e,capabilities:{references:!0,definitions:!0,rename:!0}})}}function genConstructorOverloads(e="ConstructorOverloads",t){let n=`type ${e}<T> =\n`;if(void 0===t)for(let e=8;e>=1;e--)r(e);else r(t);return n+="// 0\n",n+="{};\n",n;function r(e){n+=`// ${e}\n`,n+="T extends {\n";for(let t=1;t<=e;t++)n+=`(event: infer E${t}, ...payload: infer P${t}): void;\n`;n+="} ? (\n";for(let t=1;t<=e;t++)t>1&&(n+="& "),n+=`(E${t} extends string ? { [K${t} in E${t}]: (...payload: P${t}) => void } : {})\n`;n+=") :\n"}}exports.getSlotsPropertyName=getSlotsPropertyName,exports.getVueLibraryName=getVueLibraryName,exports.generate=generate,exports.genConstructorOverloads=genConstructorOverloads;