"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,a,o){void 0===o&&(o=a),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[a]}})}:function(e,t,a,o){void 0===o&&(o=a),e[o]=t[a]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&__createBinding(t,e,a);return __setModuleDefault(t,e),t};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getPatchForSlotNode=exports.walkElementNodes=exports.generate=exports.isIntrinsicElement=exports.transformContext=void 0;const SourceMaps=__importStar(require("../../../source-map")),code_gen_1=require("../../../code-gen"),shared_1=require("@vue/shared"),CompilerDOM=__importStar(require("@vue/compiler-dom")),CompilerCore=__importStar(require("@vue/compiler-core")),transform_1=require("../transform"),scriptSetupRanges_1=require("../parsers/scriptSetupRanges"),script_1=require("./script"),capabilitiesSet={all:{basic:!0,diagnostic:!0,references:!0,definitions:!0,rename:!0,completion:!0,semanticTokens:!0},noDiagnostic:{basic:!0,references:!0,definitions:!0,rename:!0,completion:!0,semanticTokens:!0},diagnosticOnly:{diagnostic:!0},tagHover:{basic:!0},event:{basic:!0,diagnostic:!0},tagReference:{references:!0,definitions:!0,rename:{in:!1,out:!0}},attr:{basic:!0,diagnostic:!0,references:!0,definitions:!0,rename:!0},attrReference:{references:!0,definitions:!0,rename:!0},scopedClassName:{references:!0,definitions:!0,rename:!0,completion:!0},slotName:{basic:!0,diagnostic:!0,references:!0,definitions:!0,completion:!0},slotNameExport:{basic:!0,diagnostic:!0,references:!0,definitions:!0},refAttr:{references:!0,definitions:!0,rename:!0}},formatBrackets={empty:["",""],round:["(",")"],curly:["({ __VLS_foo:","})"],square:["[","]"]},validTsVar=/^[a-zA-Z_$][0-9a-zA-Z_$]*$/;function _isHTMLTag(e){return(0,shared_1.isHTMLTag)(e)||"hgroup"===e||"slot"===e||"component"===e}function isIntrinsicElement(e="runtime-dom",t){return"runtime-dom"===e?_isHTMLTag(t)||(0,shared_1.isSVGTag)(t):["block","component","template","slot"].includes(t)}function generate(e,t,a,o,n,s=[],i,r){const l=new code_gen_1.CodeGen,c=new code_gen_1.CodeGen,d=new Map,p=new Map,f=new Set(s),u={},g={},m={},x=new Set,T=[],v=[];let h=0;walkElementNodes(o,(e=>{u[e.tag]||(u[e.tag]=[]);const t=u[e.tag];t.push(e.loc.start.offset+e.loc.source.indexOf(e.tag)),e.isSelfClosing||"html"!==a||t.push(e.loc.start.offset+e.loc.source.lastIndexOf(e.tag))}));for(const e in u){if(isIntrinsicElement(t.experimentalRuntimeMode,e))continue;const a=u[e],o=(a.map((t=>({start:t,end:t+e.length}))),e.indexOf("."),(0,shared_1.capitalize)((0,shared_1.camelize)(e.replace(/:/g,"-")))),n="__VLS_"+h++;g[e]={component:o,emit:n,offsets:a.map((e=>{var t;return null===(t=i({start:e,end:e}))||void 0===t?void 0:t.start})).filter(notEmpty)}}for(const e of o.children)y(e,void 0);l.addText("if (typeof __VLS_styleScopedClasses === 'object' && !Array.isArray(__VLS_styleScopedClasses)) {\n");for(const{className:e,offset:t}of T)l.addText("__VLS_styleScopedClasses["),N(e,{start:t,end:t+e.length},{vueTag:"template",capabilities:{...capabilitiesSet.scopedClassName,displayWithLink:f.has(e)}}),l.addText("];\n");l.addText("}\n"),l.addText("declare var __VLS_slots:\n");for(const[e,t]of p)l.addText(`Record<NonNullable<typeof ${e}>, typeof ${t.varName}> &\n`);l.addText("{\n");for(const[e,t]of d)S(e,t.loc,SourceMaps.Mode.Expand,{vueTag:"template",capabilities:{...capabilitiesSet.slotNameExport,referencesCodeLens:n}}),l.addText(`: (_: typeof ${t.varName}) => any,\n`);return l.addText("};\n"),{codeGen:l,cssCodeGen:c,tagNames:u,identifiers:x};function y(o,n){var r,f,u,w;if(1===o.type)!function(o,n){var r,f,u,w;const R=getPatchForSlotNode(o);if(R)return void y(R,n);"template"!==o.tag&&(n=o);if("vls-sr"===o.tag){const t=o.loc.source.indexOf(">")+1,a=o.loc.source.lastIndexOf("</"),n=o.loc.source.substring(t,a),s=e.createSourceFile("/foo.ts",n,e.ScriptTarget.ESNext),i=(0,scriptSetupRanges_1.parseBindingRanges)(e,s,!1).map((e=>n.substring(e.start,e.end)));for(const e of i)m[e]=(null!==(r=m[e])&&void 0!==r?r:0)+1;return void O(n,{start:o.loc.start.offset+t,end:o.loc.start.offset+t+n.length},SourceMaps.Mode.Offset,{vueTag:"template",capabilities:capabilitiesSet.all})}l.addText("{\n");{isIntrinsicElement(t.experimentalRuntimeMode,o.tag);const r=null!==(u=null===(f=g[o.tag])||void 0===f?void 0:f.component)&&void 0!==u?u:o.tag,N=l.getText().length,R={},z=o.isSelfClosing||"html"!==a?void 0:o.loc.start.offset+o.loc.source.lastIndexOf(o.tag);l.addText("<"),O(r,{start:o.loc.start.offset+o.loc.source.indexOf(o.tag),end:o.loc.start.offset+o.loc.source.indexOf(o.tag)+o.tag.length},SourceMaps.Mode.Offset,{vueTag:"template",capabilities:R}),l.addText(" ");const{hasRemainStyleOrClass:k}=_(o,!1,"props");let E,L;void 0===z?l.addText("/>"):(l.addText("></"),O(r,{start:z,end:z+o.tag.length},SourceMaps.Mode.Offset,{vueTag:"template",capabilities:R}),l.addText(">")),E=o.loc.source.endsWith("/>")?o.loc.end.offset:o.children.length?o.loc.start.offset+o.loc.source.substring(0,o.children[0].loc.start.offset-o.loc.start.offset).lastIndexOf(">")+1:o.loc.start.offset+o.loc.source.substring(0,o.loc.source.lastIndexOf("</")).lastIndexOf(">")+1,$(l,{sourceRange:{start:o.loc.start.offset,end:E},mappedRange:{start:N,end:l.getText().length},mode:SourceMaps.Mode.Totally,data:{vueTag:"template",capabilities:{}}}),l.addText("\n"),k&&(l.addText(`<${r} `),_(o,!0,"props"),l.addText("/>\n")),function(e){var t,a,o;for(const n of e.props)if(7===n.type&&"bind"===n.name&&4===(null===(t=n.arg)||void 0===t?void 0:t.type)&&4===(null===(a=n.exp)||void 0===a?void 0:a.type)&&"style"===n.arg.content&&3===n.exp.constType){const t=n.arg.loc.source[n.arg.loc.source.length-1],a=n.arg.loc.source.indexOf(t)+1,s=n.arg.loc.source.lastIndexOf(t),r=n.arg.loc.source.substring(a,s),l={start:n.arg.loc.start.offset+a,end:n.arg.loc.start.offset+s},d=null===(o=i({start:l.start,end:l.end}))||void 0===o?void 0:o.start;if(void 0===d)continue;const p=d-l.start;l.start+=p,l.end+=p,c.addText(`${e.tag} { `),c.addCode(r,l,SourceMaps.Mode.Offset,{vueTag:"template",capabilities:{basic:!0,references:!0,definitions:!0,diagnostic:!0,rename:!0,completion:!0,semanticTokens:!0}}),c.addText(" }\n")}}(o),L=[],function(t,a,o){var n,s,i;const r=a?g[a.tag]:void 0;for(const c of t.props)if(7===c.type&&"slot"===c.name){const t="__VLS_"+h++,d="__VLS_"+h++;if(r&&a)if("UnicloudDb"===r.component){let e="";try{let t={},o=null===(n=a.codegenNode.dynamicProps)||void 0===n?void 0:n.match(/"[^"]*"/g).map((e=>e.match(/\w+/g)[0])),s=a.codegenNode.props;s&&s.properties.forEach((e=>{t[e.key.content]={value:e.value.content,isDynamic:!!(null==o?void 0:o.includes(e.key.content))}})),e=JSON.stringify(t)}catch(e){}l.addText(`type UnicloudDbType = {\n                            data:\`__VLS_useCollection(${e})\`,\n                            pagination:{\n                                current: number;\n                                size: number;\n                                count: number;\n                            },\n                            loading:boolean,\n                            hasMore:boolean\n                            error:{\n                                errCode: number | string;\n                                errMsg: string;\n                                name: string;\n                                message: string;\n                                stack?: string;\n                            },\n                            options: any\n                        };\n`),l.addText(`type UnicloudDb = {\n                            '${(0,script_1.getSlotsPropertyName)(2)}':{\n                                default:(arg: UnicloudDbType)=>{}\n                            }\n                        };\n`),l.addText(`declare const ${d}: __VLS_types.ExtractComponentSlots<UnicloudDb>;\n`)}else l.addText(`const ${t} = new ${r.component}({ `),_(a,!1,"slots"),l.addText("});\n"),l.addText(`declare const ${d}: __VLS_types.ExtractComponentSlots<typeof ${t}>;\n`);if(4===(null===(s=c.exp)||void 0===s?void 0:s.type)){l.addText("const ");const t=e.createSourceFile("/foo.ts",`const ${c.exp.content}`,e.ScriptTarget.ESNext);(0,transform_1.colletVars)(e,t,o),O(c.exp.content,{start:c.exp.loc.start.offset,end:c.exp.loc.end.offset},SourceMaps.Mode.Offset,{vueTag:"template",capabilities:capabilitiesSet.all}),l.addText(" = ")}if(!r||!a){l.addText("{} as any;\n");continue}let p="default",f=!0;4===(null===(i=c.arg)||void 0===i?void 0:i.type)&&""!==c.arg.content&&(f=c.arg.isStatic,p=c.arg.content);const u=l.getText().length;l.addText(d);const g=c.arg?{start:c.arg.loc.start.offset,end:c.arg.loc.end.offset}:{start:c.loc.start.offset,end:c.loc.start.offset+c.loc.source.split("=")[0].length};f?b(p,g,{vueTag:"template",capabilities:{...capabilitiesSet.slotName,completion:!!c.arg}},!1):(l.addText("["),M(p,g.start+1,{vueTag:"template",capabilities:capabilitiesSet.all},"",""),l.addText("]"));const m=l.getText().length;if($(l,{mappedRange:{start:u,end:m},sourceRange:g,mode:SourceMaps.Mode.Totally,data:{vueTag:"template",capabilities:capabilitiesSet.diagnosticOnly}}),l.addText(";\n"),f&&!c.arg){let e=c.loc.start.offset;c.loc.source.startsWith("#")?e+="#".length:c.loc.source.startsWith("v-slot:")&&(e+="v-slot:".length),l.addText(d),l.addText("['"),O("",{start:e,end:e},SourceMaps.Mode.Offset,{vueTag:"template",capabilities:{completion:!0}}),l.addText("'];\n")}}}(o,n,L);for(const e of L)m[e]=(null!==(w=m[e])&&void 0!==w?w:0)+1;const C=o.props.find((e=>7===e.type&&("scope"===e.name||"data"===e.name)));let I=!1,P=v.length;if(7===(null==C?void 0:C.type)&&C.exp){const e="__VLS_"+h++,t=`__VLS_types.withScope(__VLS_ctx, ${e})`;l.addText(`const ${e} = `),O(C.exp.loc.source,{start:C.exp.loc.start.offset,end:C.exp.loc.end.offset},SourceMaps.Mode.Offset,{vueTag:"template",capabilities:capabilitiesSet.all}),l.addText(";\n"),l.addText(`if (${t}) {\n`),v.push(t),I=!0}!function(e){var t;for(const a of e.props)if(7===a.type&&"slot"!==a.name&&"on"!==a.name&&"model"!==a.name&&"bind"!==a.name&&"scope"!==a.name&&"data"!==a.name){const e=l.getText().length;l.addText("__VLS_types.directiveFunction(__VLS_ctx."),O((0,shared_1.camelize)("v-"+a.name),{start:a.loc.start.offset,end:a.loc.start.offset+"v-".length+a.name.length},SourceMaps.Mode.Offset,{vueTag:"template",capabilities:capabilitiesSet.noDiagnostic,normalizeNewName:shared_1.camelize,applyNewName:keepHyphenateName}),x.add((0,shared_1.camelize)("v-"+a.name)),l.addText(")("),4===(null===(t=a.exp)||void 0===t?void 0:t.type)&&M(a.exp.content,a.exp.loc.start.offset,{vueTag:"template",capabilities:capabilitiesSet.all},"(",")"),l.addText(")"),$(l,{sourceRange:{start:a.loc.start.offset,end:a.loc.end.offset},mappedRange:{start:e,end:l.getText().length},mode:SourceMaps.Mode.Totally,data:{vueTag:"template",capabilities:capabilitiesSet.diagnosticOnly}}),l.addText(";\n")}}(o),function(e){for(const t of e.props)6===t.type&&"ref"===t.name&&t.value&&(l.addText("// @ts-ignore\n"),M(t.value.content,t.value.loc.start.offset+1,{vueTag:"template",capabilities:capabilitiesSet.refAttr},"(",")"),l.addText(";\n"))}(o),s.length&&function(e){var t,a;for(const o of e.props)if(6===o.type&&"class"===o.name&&o.value){let e=o.value.loc.start.offset,t="";for(const a of o.value.loc.source+" ")""===a.trim()||'"'===a||"'"===a?(""!==t&&(T.push({className:t,offset:e}),e+=t.length,t=""),e+=a.length):t+=a}else 7===o.type&&4===(null===(t=o.arg)||void 0===t?void 0:t.type)&&4===(null===(a=o.exp)||void 0===a?void 0:a.type)&&"class"===o.arg.content&&(l.addText("__VLS_styleScopedClasses = ("),O(o.exp.content,{start:o.exp.loc.start.offset,end:o.exp.loc.end.offset},SourceMaps.Mode.Offset,{vueTag:"template",capabilities:capabilitiesSet.scopedClassName}),l.addText(");\n"))}(o),V(o),function(e){var t,a,o;if("slot"!==e.tag)return;const n="__VLS_"+h++,s="__VLS_"+h++,i="__VLS_"+h++,r=u(),c=g();let f=!1;for(const a of e.props)if(7===a.type&&!a.arg&&4===(null===(t=a.exp)||void 0===t?void 0:t.type)){f=!0,l.addText(`const ${n} = `),M(a.exp.content,a.exp.loc.start.offset,{vueTag:"template",capabilities:capabilitiesSet.attrReference},"(",")"),l.addText(";\n");break}l.addText(`const ${s} = {\n`);for(const t of e.props)if(7===t.type&&4===(null===(a=t.arg)||void 0===a?void 0:a.type)&&4===(null===(o=t.exp)||void 0===o?void 0:o.type)&&"name"!==t.arg.content)S(t.arg.content,{start:t.arg.loc.start.offset,end:t.arg.loc.end.offset},SourceMaps.Mode.Offset,{vueTag:"template",normalizeNewName:shared_1.camelize,applyNewName:keepHyphenateName,capabilities:capabilitiesSet.attrReference}),l.addText(": "),M(t.exp.content,t.exp.loc.start.offset,{vueTag:"template",capabilities:capabilitiesSet.attrReference},"(",")"),l.addText(",\n");else if(6===t.type&&"name"!==t.name){const e=void 0!==t.value?`"${toUnicode(t.value.content)}"`:"true";S(t.name,{start:t.loc.start.offset,end:t.loc.start.offset+t.name.length},SourceMaps.Mode.Offset,{vueTag:"template",normalizeNewName:shared_1.camelize,applyNewName:keepHyphenateName,capabilities:capabilitiesSet.attr}),l.addText(": ("),l.addText(e),l.addText("),\n")}l.addText("};\n"),f?l.addText(`var ${i}!: typeof ${n} & typeof ${s};\n`):l.addText(`var ${i}!: typeof ${s};\n`);if(c){const t="__VLS_"+h++,a="__VLS_"+h++;l.addText(`const ${t} = ${c};\n`),l.addText(`var ${a}!: typeof ${t};\n`),p.set(a,{varName:i,loc:{start:e.loc.start.offset+e.loc.source.indexOf(e.tag),end:e.loc.start.offset+e.loc.source.indexOf(e.tag)+e.tag.length}})}else d.set(r,{varName:i,loc:{start:e.loc.start.offset+e.loc.source.indexOf(e.tag),end:e.loc.start.offset+e.loc.source.indexOf(e.tag)+e.tag.length}});function u(){for(const t of e.props)if("name"===t.name&&6===t.type&&t.value&&t.value.content)return t.value.content;return"default"}function g(){var t,a;for(const o of e.props)if(7===o.type&&"bind"===o.name&&4===(null===(t=o.arg)||void 0===t?void 0:t.type)&&"name"===o.arg.content)return 4===(null===(a=o.exp)||void 0===a?void 0:a.type)?o.exp.content:"'default'"}}(o);for(const e of o.children)y(e,n);if(L)for(const e of L)m[e]--;I&&(l.addText("}\n"),v.length=P)}function V(e){var t,a;const o="__VLS_"+h++;let n=!1;for(const i of e.props){if(7===i.type&&"on"===i.name&&4===(null===(t=i.arg)||void 0===t?void 0:t.type)){const c=CompilerDOM.transformOn(i,e,exports.transformContext);for(const d of c.props){s();const p=g[e.tag],f="__VLS_"+h++;p&&l.addText(`type ${f} = typeof ${o} extends { $props: infer Props } ? Props & Record<string, unknown> : typeof ${p.component} & Record<string, unknown>;\n`),l.addText(`const __VLS_${h++}: {\n`),l.addText(`'${i.arg.loc.source}': __VLS_types.FillingEventArg<\n`);{const u=(0,shared_1.camelize)("on-"+i.arg.loc.source),m="on"+(0,shared_1.capitalize)(i.arg.loc.source);p&&(l.addText("__VLS_types.FirstFunction<\n"),l.addText(`__VLS_types.EmitEvent<typeof ${p.component}, '${i.arg.loc.source}'>,\n`),l.addText(`${f}[`),N(u,[{start:i.arg.loc.start.offset,end:i.arg.loc.end.offset}],{vueTag:"template",capabilities:capabilitiesSet.attrReference,normalizeNewName:e=>(0,shared_1.camelize)("on-"+e),applyNewName(e,t){const a=(0,shared_1.hyphenate)(t);return(0,shared_1.hyphenate)(t).startsWith("on-")?(0,shared_1.camelize)(a.slice("on-".length)):t}}),l.addText("],\n"),m!==u&&(l.addText(`${f}[`),N(m,[{start:i.arg.loc.start.offset,end:i.arg.loc.end.offset}],{vueTag:"template",capabilities:capabilitiesSet.attrReference,normalizeNewName:e=>"on"+(0,shared_1.capitalize)(e),applyNewName(e,t){const a=(0,shared_1.hyphenate)(t);return(0,shared_1.hyphenate)(t).startsWith("on-")?(0,shared_1.camelize)(a.slice("on-".length)):t}}),l.addText("],\n")),l.addText(`typeof ${o} extends { $emit: infer Emit } ? __VLS_types.EmitEvent2<Emit, '${i.arg.loc.source}'> : unknown,\n`)),l.addText("__VLS_types.GlobalAttrs["),N(u,[{start:i.arg.loc.start.offset,end:i.arg.loc.end.offset}],{vueTag:"template",capabilities:capabilitiesSet.attrReference,normalizeNewName:e=>(0,shared_1.camelize)("on-"+e),applyNewName(e,t){const a=(0,shared_1.hyphenate)(t);return(0,shared_1.hyphenate)(t).startsWith("on-")?(0,shared_1.camelize)(a.slice("on-".length)):t}}),l.addText("],\n"),p&&l.addText(">\n")}l.addText(">\n"),l.addText("} = {\n"),S(i.arg.loc.source,{start:i.arg.loc.start.offset,end:i.arg.loc.end.offset},SourceMaps.Mode.Offset,{vueTag:"template",capabilities:capabilitiesSet.event}),l.addText(": "),r(i,d.value),l.addText("};\n")}}else 7===i.type&&"on"===i.name&&4===(null===(a=i.exp)||void 0===a?void 0:a.type)&&(M(i.exp.content,i.exp.loc.start.offset,{vueTag:"template",capabilities:capabilitiesSet.all},"$event => {(",")}"),l.addText(";\n"));function r(e,t){var a;if(4===(null===(a=e.exp)||void 0===a?void 0:a.type)){if(4===t.type)M(e.exp.content,e.exp.loc.start.offset,{vueTag:"template",capabilities:capabilitiesSet.all},"(",")");else if(8===t.type){const a=e.exp,o=t.children.findIndex((e=>"object"==typeof e&&4===e.type&&e.content===a.content)),n=t.children[o];let s=t.children.filter(((e,t)=>"string"==typeof e&&t<o)).map((e=>e)).join(""),i=t.children.filter(((e,t)=>"string"==typeof e&&t>o)).map((e=>e)).join("");if(s&&v.length){s=s.replace("(","{ "),i=i.replace(")","} "),s+="\n";for(const e of v)s+=`if (!(${e})) return;\n`}M(n.content,n.loc.start.offset,{vueTag:"template",capabilities:capabilitiesSet.all},s,i)}}else l.addText("undefined")}}function s(){if(n)return;const t=g[e.tag];t&&(l.addText(`const ${o} = new ${t.component}({ `),_(e,!1,"slots"),l.addText("});\n")),n=!0}}l.addText("}\n")}(o,n);else if(12===o.type)y(o.content,n);else if(8===o.type)for(const e of o.children)"object"==typeof e&&y(e,n);else if(5===o.type){const e=o.loc.source.substring(2,o.loc.source.length-2);let t=o.loc.start.offset+2;l.addText("("),M(e,t,{vueTag:"template",capabilities:capabilitiesSet.all},"",""),l.addText(");\n")}else if(9===o.type){let e=v.length;for(let e=0;e<o.branches.length;e++){const a=o.branches[e];0===e?l.addText("if"):a.condition?l.addText("else if"):l.addText("else");let s=!1;4===(null===(r=a.condition)||void 0===r?void 0:r.type)&&(l.addText(" "),M(a.condition.loc.source,a.condition.loc.start.offset,{vueTag:"template",capabilities:capabilitiesSet.all},"(",")"),t.experimentalAllowTypeNarrowingInInlineHandlers&&(v.push(a.condition.content),s=!0)),l.addText(" {\n");for(const e of a.children)y(e,n);l.addText("}\n"),s&&(v[v.length-1]=`!(${v[v.length-1]})`)}v.length=e}else if(11===o.type){const{source:t,value:a,key:s,index:i}=o.parseResult,r=a?{start:(null!==(f=null!=a?a:s)&&void 0!==f?f:i).loc.start.offset,end:(null!==(u=null!=i?i:s)&&void 0!==u?u:a).loc.end.offset}:void 0,c=r?o.loc.source.substring(r.start-o.loc.start.offset,r.end-o.loc.start.offset):void 0,d=[];if(l.addText("for (const ["),r&&c){const t=e.createSourceFile("/foo.ts",`const [${c}]`,e.ScriptTarget.ESNext);(0,transform_1.colletVars)(e,t,d);for(const e of d)m[e]=(null!==(w=m[e])&&void 0!==w?w:0)+1;O(c,r,SourceMaps.Mode.Offset,{vueTag:"template",capabilities:capabilitiesSet.all})}l.addText("] of __VLS_types.getVforSourceType"),4===t.type&&M(t.content,t.loc.start.offset,{vueTag:"template",capabilities:capabilitiesSet.all},"(",")"),l.addText(") {\n");for(const e of o.children)y(e,n);l.addText("}\n");for(const e of d)m[e]--}else 2===o.type||3===o.type||l.addText(`// Unprocessed node type: ${o.type} json: ${JSON.stringify(o.loc)}\n`)}function _(e,a,o){var n,s,i,r;let c=0,d=0;for(const v of e.props)if(7!==v.type||"bind"!==v.name&&"model"!==v.name||"model"!==v.name&&4!==(null===(n=v.arg)||void 0===n?void 0:n.type)||v.exp&&4!==v.exp.type)if(6===v.type){const e=(0,shared_1.hyphenate)(v.name)===v.name?(0,shared_1.camelize)(v.name):v.name,t=v.name;if(a&&"style"!==e&&"class"!==e)continue;if("style"===e||"class"===e){if(("style"===e?c++:d++)>=1!==a)continue}g(!0);const o=l.getText().length;p(e,!0,{start:v.loc.start.offset,end:v.loc.start.offset+t.length},{vueTag:"template",capabilities:{},normalizeNewName:shared_1.camelize,applyNewName:keepHyphenateName}),f(!0),v.value?T(v.value):l.addText("true"),u(!0),m(!0);const n=l.getText().length;$(l,{sourceRange:{start:v.loc.start.offset,end:v.loc.end.offset},mappedRange:{start:o,end:n},mode:SourceMaps.Mode.Totally,data:{vueTag:"template",capabilities:x(capabilitiesSet.diagnosticOnly)}}),t!==e&&(g(!0),p(t,!0,{start:v.loc.start.offset,end:v.loc.start.offset+t.length},{vueTag:"template",capabilities:x(capabilitiesSet.attr),normalizeNewName:shared_1.camelize,applyNewName:keepHyphenateName}),f(!0),v.value?T(v.value):l.addText("true"),u(!0),m(!0))}else if(7!==v.type||"bind"!==v.name||v.arg||4!==(null===(r=v.exp)||void 0===r?void 0:r.type)){if(a)continue}else{if(a)continue;"props"===o?l.addText("{..."):l.addText("..."),M(v.exp.content,v.exp.loc.start.offset,{vueTag:"template",capabilities:x(capabilitiesSet.all)},"(",")"),"props"===o?l.addText("} "):l.addText(", ")}else{const o=!v.arg||4===v.arg.type&&v.arg.isStatic;let n=4===(null===(s=v.arg)||void 0===s?void 0:s.type)?3===v.arg.constType?v.arg.content:v.arg.loc.source:getModelValuePropName(e,t.target);v.modifiers.some((e=>"prop"===e||"attr"===e))&&(n=n.substring(1));const r=o&&(0,shared_1.hyphenate)(n)===n?(0,shared_1.camelize)(n):n;if(a&&"style"!==r&&"class"!==r)continue;if("style"===r||"class"===r){if(("style"===r?c++:d++)>=1!==a)continue}g(o);const T=l.getText().length;v.arg?3===(null===(i=v.exp)||void 0===i?void 0:i.constType)?p(r,o,{start:v.arg.loc.start.offset,end:v.arg.loc.start.offset+n.length},{vueTag:"template",capabilities:x(capabilitiesSet.attr),normalizeNewName:shared_1.camelize,applyNewName:keepHyphenateName}):p(r,o,{start:v.arg.loc.start.offset,end:v.arg.loc.end.offset},{vueTag:"template",capabilities:x(capabilitiesSet.attr),normalizeNewName:shared_1.camelize,applyNewName:keepHyphenateName}):p(n,o,{start:v.loc.start.offset,end:v.loc.start.offset+"v-model".length},{vueTag:"template",capabilities:x(capabilitiesSet.attr)}),f(o),v.exp&&3!==v.exp.constType?M(v.exp.loc.source,v.exp.loc.start.offset,{vueTag:"template",capabilities:x(capabilitiesSet.all)},"(",")"):l.addText("undefined"),u(o),$(l,{sourceRange:{start:v.loc.start.offset,end:v.loc.end.offset},mappedRange:{start:T,end:l.getText().length},mode:SourceMaps.Mode.Totally,data:{vueTag:"template",capabilities:x(capabilitiesSet.diagnosticOnly)}}),m(o),v.arg&&n!==r&&(g(o),p(n,o,{start:v.arg.loc.start.offset,end:v.arg.loc.end.offset},{vueTag:"template",capabilities:x(capabilitiesSet.attr),normalizeNewName:shared_1.camelize,applyNewName:keepHyphenateName}),f(o),v.exp?M(v.exp.loc.source,void 0,void 0,"(",")"):l.addText("undefined"),u(o),m(o))}return{hasRemainStyleOrClass:c>=2||d>=2};function p(e,t,a,n){"props"===o&&t?O(e,a,SourceMaps.Mode.Offset,n):S(e,a,SourceMaps.Mode.Offset,n)}function f(e){"props"===o&&e?l.addText("={"):l.addText(": (")}function u(e){"props"===o&&e?l.addText("}"):l.addText(")")}function g(e){"props"!==o||e||l.addText("{...{")}function m(e){"props"===o&&e?l.addText(" "):"props"!==o||e?l.addText(", "):l.addText("}} ")}function x(e){return"props"===o?e:{references:e.references,rename:e.rename}}function T(e){l.addText('"');let t=e.loc.start.offset,a=e.loc.end.offset;a-t>e.content.length&&(t++,a--),O(toUnicode(e.content),{start:t,end:a},SourceMaps.Mode.Offset,{vueTag:"template",capabilities:{}}),l.addText('"')}}function S(e,t,a,o){return validTsVar.test(e)?(O(e,t,a,o),1):e.startsWith("[")&&e.endsWith("]")?(M(e,t.start,o,"",""),1):(N(e,t,o),2)}function b(e,t,a,o=!0){return o&&validTsVar.test(e)?(l.addText("."),t.end-t.start===e.length?O(e,t,SourceMaps.Mode.Offset,a):O(e,t,SourceMaps.Mode.Expand,a),1):e.startsWith("[")&&e.endsWith("]")?(O(e,t,SourceMaps.Mode.Offset,a),2):(l.addText("["),N(e,t,a),l.addText("]"),3)}function N(e,t,a){const o=`'${e}'`;for(const e of"length"in t?t:[t])$(l,{sourceRange:e,mappedRange:{start:l.getText().length+1,end:l.getText().length+o.length-1},mode:SourceMaps.Mode.Offset,additional:[{sourceRange:e,mappedRange:{start:l.getText().length,end:l.getText().length+o.length},mode:SourceMaps.Mode.Totally}],data:a});l.addText(o)}function M(t,a,o,n,s){if(0===t.length||0===t.trim().length){let e=t.length+1;t="$".repeat(e),a&&a--}(0,transform_1.walkInterpolationFragment)(e,n+t+s,((e,s,i)=>{if(void 0===s)l.addText(e);else{let r="";const c=(s-=n.length)+e.length-t.length;c>0&&(r=e.substring(e.length-c),e=e.substring(0,e.length-c)),s<0&&(l.addText(e.substring(0,-s)),e=e.substring(-s),s=0),void 0!==a&&void 0!==o?O(e,{start:a+s,end:a+s+e.length},SourceMaps.Mode.Offset,i?{vueTag:o.vueTag,capabilities:{diagnostic:!0}}:o):l.addText(e),l.addText(r)}}),m,x)}function O(e,t,a,o){const n=l.addText(e);$(l,{sourceRange:t,mappedRange:n,mode:a,data:o})}function $(e,t){var a,o;const n={...t},s=null===(a=i(t.sourceRange))||void 0===a?void 0:a.start;if(void 0===s)return;const r=s-t.sourceRange.start;if(n.sourceRange={start:t.sourceRange.start+r,end:t.sourceRange.end+r},t.additional){n.additional=[];for(const e of t.additional){let t=null===(o=i(e.sourceRange))||void 0===o?void 0:o.start;if(void 0===t)continue;const a=t-e.sourceRange.start;n.additional.push({...e,sourceRange:{start:e.sourceRange.start+a,end:e.sourceRange.end+a}})}}e.addMapping2(n)}}function walkElementNodes(e,t){if(0===e.type)for(const a of e.children)walkElementNodes(a,t);else if(1===e.type){const a=getPatchForSlotNode(e);if(a)return void walkElementNodes(a,t);t(e);for(const a of e.children)walkElementNodes(a,t)}else if(9===e.type)for(let a=0;a<e.branches.length;a++){const o=e.branches[a];for(const e of o.children)walkElementNodes(e,t)}else if(11===e.type)for(const a of e.children)walkElementNodes(a,t)}function toUnicode(e){return e.split("").map((e=>{var t=e.charCodeAt(0).toString(16).padStart(4,"0");return t.length>2?"\\u"+t:e})).join("")}function unHyphenatComponentName(e){return(0,shared_1.camelize)("-"+e)}function keepHyphenateName(e,t){return e===(0,shared_1.hyphenate)(e)?(0,shared_1.hyphenate)(t):t}function getModelValuePropName(e,t){var a;const o=e.tag,n=e.props.find((e=>6===e.type&&"type"===e.name)),s=null===(a=null==n?void 0:n.value)||void 0===a?void 0:a.content;return"input"===o&&"checkbox"===s?"checked":"input"===o||"textarea"===o||"select"===o||t<3?"value":"modelValue"}function getPatchForSlotNode(e){const t=e.props.find((e=>7===e.type&&"for"===e.name));if(t){let a;if(CompilerCore.processFor(e,t,exports.transformContext,(e=>{a={...e}})),a)return a.children=[{...e,props:e.props.filter((e=>e!==t))}],a}}function notEmpty(e){return null!=e}exports.transformContext={onError:()=>{},helperString:e=>e.toString(),replaceNode:e=>{},cacheHandlers:!1,prefixIdentifiers:!1,scopes:{vFor:0,vOnce:0,vPre:0,vSlot:0},expressionPlugins:["typescript"]},exports.isIntrinsicElement=isIntrinsicElement,exports.generate=generate,exports.walkElementNodes=walkElementNodes,exports.getPatchForSlotNode=getPatchForSlotNode;