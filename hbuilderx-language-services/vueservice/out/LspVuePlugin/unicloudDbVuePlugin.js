"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&__createBinding(t,e,i);return __setModuleDefault(t,e),t};Object.defineProperty(exports,"__esModule",{value:!0}),exports.UnicloudDbVuePlugin=void 0;const hx=__importStar(require("../../../core")),server_1=require("../../../htmlservice/server");class UnicloudDbAttributeValueService{constructor(e,t){this._htmlInfo=e,this._tsInfo=t,this._attributeTypes=new Map,this._attributeTypes.set("collection",["HBuilderX.DBCollectionString"]),this._attributeTypes.set("field",["HBuilderX.DBFieldString"]),this._attributeTypes.set("orderby",["HBuilderX.DBFieldString"]),this._attributeTypes.set("where",["HBuilderX.JQLString"]),this._attributeTypes.set("action",["HBuilderX.ClientDBActionString"]),this._serviceInstances=new Map,this._serviceInstances.set(hx.LanguageServiceType.TS,t.ts),this._serviceInstances.set(hx.LanguageServiceType.TYPESCRIPT_LANGUAGE_SERVICE,t.languageService),this._serviceInstances.set(hx.LanguageServiceType.HTML_LANGUAGE_SERVICE,e.languageService)}isInAttributeValue(e){return!(!e||"unicloud-db"!==e.activeTag||e.kind!==server_1.LocationInfoKind.AttributeValue)}doComplete(e,t,i){let n=this._htmlInfo.languageService.getLocationInfoAtPosition(e,t,i);if(this.isInAttributeValue(n)){let r=null==n?void 0:n.activeAttribute,s=this._attributeTypes.get(r);if(s)return hx.doComplete(s,e,t,{project:this._tsInfo.project,kind:hx.StringLocationInfoKind.IN_HTML_LIKE,ast:i,range:null==n?void 0:n.activeRange},hx.StringServicesContainer.create(this._serviceInstances),[],!1)}return{isIncomplete:!0,items:[]}}doDefinition(e,t,i){let n=[],r=this._htmlInfo.languageService.getLocationInfoAtPosition(e,t,i);if(this.isInAttributeValue(r)){let s=null==r?void 0:r.activeAttribute,o=this._attributeTypes.get(s);if(o){let s=hx.doDefinition(o,e,t,{project:this._tsInfo.project,kind:hx.StringLocationInfoKind.IN_HTML_LIKE,ast:i,range:null==r?void 0:r.activeRange},hx.StringServicesContainer.create(this._serviceInstances));n.push(...s)}}return n}}function create(e,t){let i=e.languageService,n=Object.create(null);for(let e of Object.keys(i)){const t=i[e];n[e]=(...e)=>t.apply(i,e)}let r=new UnicloudDbAttributeValueService(e,t);return n.doComplete=function(e,t,n,s){let o=i.doComplete(e,t,n,s),u=r.doComplete(e,t,n);return o.items.push(...u.items),o},n.findDefinition=function(e,t,n){let s=i.findDefinition(e,t,n);s||(s=[]);let o=r.doDefinition(e,t,n);return s.push(...o),s},n}class UnicloudDbVuePlugin{constructor(e){this.tsInfo=e,this._tsInfo=e}create(e){return create(e,this.tsInfo)}}exports.UnicloudDbVuePlugin=UnicloudDbVuePlugin;