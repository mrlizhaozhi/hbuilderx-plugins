"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&__createBinding(t,e,i);return __setModuleDefault(t,e),t};Object.defineProperty(exports,"__esModule",{value:!0}),exports.createVueOptionsTypeChecker=exports.createVueThisTypeChecker=void 0;const path=__importStar(require("path")),core_1=require("../../core");function getType(e,t,i,n){let r=i.getSymbolsInScope(t,n.SymbolFlags.Type).find((t=>t.escapedName===e));if(r)return i.getDeclaredTypeOfSymbol(r)}function asCallExpression(e,t){return e.kind==t.SyntaxKind.CallExpression?e:void 0}function isVueThisContext(e,t){var i;let n=e;for(;n&&n.kind!=t.SyntaxKind.SourceFile&&!t.isFunctionLike(n);)n=n.parent;if(t.isFunctionLike(n)){if("setup"===(null===(i=n.name)||void 0===i?void 0:i.getText()))return!1;for(n=n.parent;n&&n.kind!=t.SyntaxKind.SourceFile&&!t.isObjectLiteralExpression(n)&&!t.isFunctionLike(n);)n=n.parent;if(!t.isObjectLiteralExpression(n))return!1;if(t.isCallExpression(n.parent)){if(!n.parent.expression.getText().endsWith(".defineComponent"))return!1}}return!0}function createVueThisTypeChecker(e){return{checkExpression(t,i,n,r,o,s){var a;const u=r.kind;let l=r.getSourceFile().fileName;if((l.endsWith(".vue.js")||l.endsWith(".vue.ts")||l.endsWith(".nvue.js")||l.endsWith(".nvue.ts"))&&u===e.ts.SyntaxKind.ThisKeyword&&isVueThisContext(r,e.ts)){let t=l.slice(0,-2)+"1.__VLS_template.tsx",i=null===(a=e.languageService.getProgram())||void 0===a?void 0:a.getSourceFile(t);if(!i)return;let r=n.getSymbolsInScope(i,e.ts.SymbolFlags.FunctionScopedVariable);if(r){let e=r.find((e=>"___VLS_ctx"===e.escapedName));if(e)return n.getTypeOfSymbol(e)}}}}}function createVueOptionsTypeChecker(e){return{getContextualType(t,i,n,r,o){var s;let a=r.getSourceFile().fileName,u=a.endsWith(".vue.ts")||a.endsWith(".vue.js")||a.endsWith(".nvue.ts")||a.endsWith(".nvue.js");if(t.kind===core_1.HXProjectKind.UniApp&&u&&e.ts.isObjectLiteralExpression(r)&&e.ts.isCallExpression(r.parent)){if(r.parent.expression.getText().endsWith(".defineComponent")){let t=(0,core_1.getExtensionRootPath)(),i=path.join(t,"builtin-dts","node_modules","@dcloudio","types","uni-app","vue.d.ts"),n=e.languageService.getProgram(),r=null==n?void 0:n.getTypeChecker(),o=null==n?void 0:n.getSourceFile(i);if(o&&r){let t=r.getSymbolsInScope(o,e.ts.SymbolFlags.Module).find((e=>'"vue/types/options"'===e.escapedName));if(t){let e=null===(s=t.exports)||void 0===s?void 0:s.get("ComponentOptions");if(e&&e.declarations&&e.declarations.length>0){return r.getTypeAtLocation(e.declarations[0])}}}}}}}}exports.createVueThisTypeChecker=createVueThisTypeChecker,exports.createVueOptionsTypeChecker=createVueOptionsTypeChecker;