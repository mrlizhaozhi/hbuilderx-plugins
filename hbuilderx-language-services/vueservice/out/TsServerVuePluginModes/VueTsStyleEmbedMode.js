"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.VueTsStyleEmbedMode=void 0;const vscode_languageserver_textdocument_1=require("vscode-languageserver-textdocument"),vscode_uri_1=require("vscode-uri"),core_1=require("../../../core"),server_1=require("../../../stylusservice/server");function isStyleFile(e){return"css"===getLanguage(e)||"scss"===getLanguage(e)||"less"===getLanguage(e)}function getLanguage(e){return e.endsWith(".css")||e.endsWith(".wxss")||e.endsWith(".acss")||e.endsWith(".ttss")||e.endsWith(".qss")||e.endsWith(".nss")?"css":e.endsWith(".scss")||e.endsWith(".sass")?"scss":e.endsWith(".less")||e.endsWith(".less.erb")?"less":e.endsWith(".stylus")?"stylus":""}class VueTsStyleDefinitionSourceMap{constructor(e,t){this.info=e,this.vueCachesInProjectScope=t}isEmbedFile(e){return!!this.vueCachesInProjectScope.getEmbeddedFileInfo(e)}getTextSpan(e,t){let s=this.vueCachesInProjectScope.getEmbeddedFile(e);if(!s)return;let n=vscode_languageserver_textdocument_1.TextDocument.create(e,"any",0,s.file.content);return{start:n.offsetAt(t.start),length:n.offsetAt(t.end)-n.offsetAt(t.start)}}}class VueTsStyleEmbedMode{constructor(e,t,s){this.info=e,this.vueCachesInProjectScope=t,this.styleLanguageServiceList=s,this.vueTsStyleDefinitionSourceMap=new VueTsStyleDefinitionSourceMap(e,t)}getCompletionsAtPosition(e,t,s,n){let i={isIncomplete:!1,items:[]};const r=this.info,o=this.vueCachesInProjectScope,c=this.styleLanguageServiceList,u=getLanguage(t);let l=o.getEmbeddedFile(t);if(!l)return;let a=l.file;if(!a)return;let g=vscode_languageserver_textdocument_1.TextDocument.create(a.fileName,u,0,a.content),d=g.positionAt(s);if("stylus"===u){let e=(new server_1.ExposedStylusServer).getLanguageServiceExt();e&&e.doCompleteSync&&(i=e.doCompleteSync(g,d))}else{const e=c.get(u);if(!e)return;let t=e.parseStylesheet(g);i=e.doComplete(g,d,t)}return(0,core_1.fromLspCompletions)(i,g,r.ts)}getCompletionEntryDetails(e,t,s,n,i,r,o,c){if(!r)return;let u=vscode_uri_1.URI.parse(r).query,l=JSON.parse(u);const a=this.info,g=this.vueCachesInProjectScope,d=this.styleLanguageServiceList,f=getLanguage(t),h=d.get(f);if(!h)return;let v=g.getEmbeddedFile(t);if(!v)return;let m=v.file;if(!m)return;let p=vscode_languageserver_textdocument_1.TextDocument.create(m.fileName,f,0,m.content),S=h.parseStylesheet(p),_=p.positionAt(s),y={label:n,...l},L=h.doResolve(y,p,_,S);return(0,core_1.fromLspCompletionDetail)(L,p,a.ts)}getQuickInfoAtPosition(e,t,s){const n=this.info,i=this.vueCachesInProjectScope,r=this.styleLanguageServiceList,o=getLanguage(t),c=r.get(o);if(!c)return;let u=i.getEmbeddedFile(t);if(!u)return;let l=u.file;if(!l)return;let a=vscode_languageserver_textdocument_1.TextDocument.create(l.fileName,o,0,l.content),g=c.parseStylesheet(a),d=a.positionAt(s),f=c.doHover(a,d,g);return(0,core_1.fromLspHover)(f,a,n.ts)}getSignatureHelpItems(e,t,s,n){}getDefinitionAndBoundSpan(e,t,s){const n=this.info,i=this.vueCachesInProjectScope,r=this.styleLanguageServiceList,o=getLanguage(t),c=r.get(o);if(!c)return;let u=i.getEmbeddedFile(t);if(!u)return;let l=u.file;if(!l)return;let a=vscode_languageserver_textdocument_1.TextDocument.create(l.fileName,o,0,l.content),g=c.parseStylesheet(a),d=a.positionAt(s),f=c.tsFindDefinition(a,d,g);return(0,core_1.fromLspDefinition)(f,a,n,this.vueTsStyleDefinitionSourceMap)}getNavigationTree(e,t){this.info;const s=this.vueCachesInProjectScope,n=this.styleLanguageServiceList,i=getLanguage(t),r=n.get(i);if(!r)return;let o=s.getEmbeddedFile(t);if(!o)return;let c=o.file;if(!c)return;let u=vscode_languageserver_textdocument_1.TextDocument.create(c.fileName,i,0,c.content),l=r.parseStylesheet(u),a=r.findDocumentSymbols(u,l);return(0,core_1.fromLspNavigation)(a,u,this.info.ts,!1)}findReferences(e,t,s){}}exports.VueTsStyleEmbedMode=VueTsStyleEmbedMode;