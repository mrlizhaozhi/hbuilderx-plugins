"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.VueTsHtmlEmbedMode=void 0;const vscode_languageserver_textdocument_1=require("vscode-languageserver-textdocument"),vscode_uri_1=require("vscode-uri"),core_1=require("../../../core");class VueTsHtmlDefinitionSourceMap{constructor(e,t,i,o){this.info=e,this.vueCachesInProjectScope=t,this.htmlLanguageService=i,this.vueDataProviders=o}isEmbedFile(e){return!!this.vueCachesInProjectScope.getEmbeddedFileInfo(e)}getTextSpan(e,t){let i=this.vueCachesInProjectScope.getEmbeddedFile(e);if(!i)return;let o=vscode_languageserver_textdocument_1.TextDocument.create(e,"any",0,i.file.content);return{start:o.offsetAt(t.start),length:o.offsetAt(t.end)-o.offsetAt(t.start)}}}class VueTsHtmlEmbedMode{constructor(e,t,i,o){this.info=e,this.vueCachesInProjectScope=t,this.htmlLanguageService=i,this.vueDataProviders=o,this.vueTsHtmlDefinitionSourceMap=new VueTsHtmlDefinitionSourceMap(e,t,i,o)}getCompletionsAtPosition(e,t,i,o){const n=this.info,r=this.vueCachesInProjectScope,s=this.htmlLanguageService;let c=r.getEmbeddedFile(t);if(!c)return;let u=c.file;if(!u)return;let a=u.fileName.endsWith(".nvue.html")?"nvue":"vue",l=vscode_languageserver_textdocument_1.TextDocument.create(u.fileName,a,0,u.content),m=s.parseHTMLDocument(l),d=l.positionAt(i),v=s.doComplete(l,d,m);return v=(0,core_1.getDeduplicationData)(v),(0,core_1.fromLspCompletions)(v,l,n.ts)}getCompletionEntryDetails(e,t,i,o,n,r,s,c){if(!r)return;this.info,this.vueCachesInProjectScope;const u=this.htmlLanguageService;let a=vscode_uri_1.URI.parse(r).query,l=JSON.parse(a),m=this.vueCachesInProjectScope.getEmbeddedFile(t);if(!m)return;let d=m.file;if(!d)return;let v=d.fileName.endsWith(".nvue.html")?"nvue":"vue",h=vscode_languageserver_textdocument_1.TextDocument.create(d.fileName,v,0,d.content),f=u.parseHTMLDocument(h),g=h.positionAt(i),p={label:o,...l},_=u.doResolve(p,h,g,f),S=(0,core_1.fromLspCompletionDetail)(_,h,this.info.ts);return S||void 0}getQuickInfoAtPosition(e,t,i){this.info,this.vueCachesInProjectScope;const o=this.htmlLanguageService;let n=this.vueCachesInProjectScope.getEmbeddedFile(t);if(!n)return;let r=n.file;if(!r)return;let s=r.fileName.endsWith(".nvue.html")?"nvue":"vue",c=vscode_languageserver_textdocument_1.TextDocument.create(r.fileName,s,0,r.content),u=o.parseHTMLDocument(c),a=c.positionAt(i),l=o.doHover(c,a,u);return(0,core_1.fromLspHover)(l,c,this.info.ts)}getSignatureHelpItems(e,t,i,o){}getDefinitionAndBoundSpan(e,t,i){let o;const n=this.info,r=(this.vueCachesInProjectScope,this.htmlLanguageService);this.vueDataProviders;let s=this.vueCachesInProjectScope.getEmbeddedFile(t);if(!s)return o;let c=s.file;if(!c)return o;let u=c.fileName.endsWith(".nvue.html")?"nvue":"vue",a=vscode_languageserver_textdocument_1.TextDocument.create(c.fileName,u,0,c.content),l=r.parseHTMLDocument(a),m=a.positionAt(i),d=r.findDefinition(a,m,l);return o=(0,core_1.fromLspDefinition)(d,a,n,this.vueTsHtmlDefinitionSourceMap),o}getNavigationTree(e,t){this.info;const i=this.vueCachesInProjectScope,o=this.htmlLanguageService;this.vueDataProviders;let n=i.getEmbeddedFile(t);if(!n)return;let r=n.file;if(!r)return;let s=r.fileName.endsWith(".nvue.html")?"nvue":"vue";const c=vscode_languageserver_textdocument_1.TextDocument.create(r.fileName,s,0,r.content),u=o.parseHTMLDocument(c);let a=o.findDocumentSymbols(c,u);return(0,core_1.fromLspNavigation)(a,c,this.info.ts,!0)}findReferences(e,t,i){}}exports.VueTsHtmlEmbedMode=VueTsHtmlEmbedMode;