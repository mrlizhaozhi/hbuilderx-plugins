"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.create=void 0;const hxproject_1=require("./hxproject"),ts=require("typescript/lib/tsserverlibrary"),fs=require("fs"),vscode_uri_1=require("vscode-uri"),languageServiceProxy_1=require("./languageServiceProxy");function createDocumentProvider(e,t,r){if(e&&t)return{get version(){return t.getProjectVersion()},getDefaultLibs:e=>[],compilerOptions:{allowNonTsExtensions:!0,allowJs:!0,lib:["lib.esnext.d.ts"],target:ts.ScriptTarget.Latest,moduleResolution:ts.ModuleResolutionKind.NodeJs,experimentalDecorators:!1},get documents(){let i=[].concat(r);return t.getScriptFileNames().forEach((t=>{e.isProjectOf(t)&&i.push(t)})),i},getDocumentSnapshot(e){let i=vscode_uri_1.URI.parse(e);if(r.indexOf(i.fsPath)>=0){let e=fs.readFileSync(i.fsPath).toString();return{getText:(t,r)=>e.substring(t,r),getLength:()=>e.length,getChangeRange:()=>{}}}return t.getScriptSnapshot(i.fsPath)},hasDocument(e){let i=vscode_uri_1.URI.parse(e);return r.indexOf(i.fsPath)>=0||t.fileExists(i.fsPath)},getDocumentVersion(e){let i=vscode_uri_1.URI.parse(e);return r.indexOf(i.fsPath)>=0?"1":t.getScriptVersion(i.fsPath)}}}function create(e){let t=e.project;if(t){let r;if(t&&(t.kind==hxproject_1.hx.HXProjectKind.UniApp||t.kind==hxproject_1.hx.HXProjectKind.UniApp_Cli)){let i=hxproject_1.hx.getUnicloudServerLibs();const o=createDocumentProvider(t,e.languageServiceHost,i);r=t.createTSLanguageService(o)}return(0,languageServiceProxy_1.createTSLanguageServiceProxy)(e.languageService,t,r)}return e.languageService}exports.create=create,exports.default={create:create};