"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getCompletionFilesSync=exports.getCompletionFiles=exports.DefaultFileExtensions=void 0;const fs=require("fs"),path=require("path"),vscode_uri_1=require("vscode-uri"),imageSuffix=[".png",".jpg",".jpeg",".jpe",".gif",".bmp",".wbmp",".wbm",".svg",".webp",".ico",".icns"],mediaSuffix=[".3gpp",".webm",".wmv",".avi",".mov",".qt",".ogg",".mp3",".wav",".mid",".midi",".asf",".mpa",".m2ts",".swf",".evo",".3gp",".flv",".cda",".rm",".wma",".ram",".ra",".rmvb",".weba",".mp4",".mpg",".mpeg"],vueSuffix=[".vue",".nvue"],jsSuffix=[".js"],cssSuffix=[".css"],htmlSuffix=[".html",".htm"],fontSuffix=[".otf",".ttf",".woff",".woff2",".svg",".eot"],forwardSlash="/".charCodeAt(0),filterDirs=[".git",".svn","node_modules","unpackage",".hbuilderx"];async function getCompletionFiles(e,t,i){var s,r,l;const n="string"==typeof e?e:vscode_uri_1.URI.parse(e.uri).fsPath;if(!fs.existsSync(n))return null;const o=vscode_uri_1.URI.parse(i).fsPath,f=null!==(s=t.limit)&&void 0!==s?s:-1;if(0===f)return null;const a=null!==(r=t.timeout)&&void 0!==r?r:-1;let u=null!==(l=t.prefixPath)&&void 0!==l?l:"",p="",c="",h=!1;const m={prefixRoot:"",files:[]};if(u){const e=u.lastIndexOf("/"),t=e>=0?u.slice(0,e):"";if(u.startsWith("/")&&!u.startsWith("//")){if(p=path.resolve(n,t.slice(1)),!fs.existsSync(p))return null;h=!0}else{const e=path.dirname(vscode_uri_1.URI.parse(i).fsPath);if(p=path.resolve(e,t),!fs.existsSync(p))return null}m.prefixRoot=t,c=p}else p=n,c=path.dirname(vscode_uri_1.URI.parse(i).fsPath);if(p){const e=[];return new Promise(((i,s)=>{let r=process.uptime(),l=[p],n=!!t.withCurrentLevelFolder,u=!!t.withAllCurrentLevelFiles;for(;l.length>0&&(f<0||e.length<f);){let i=l.shift();fs.readdirSync(i,{withFileTypes:!0}).forEach((s=>{const r=s.name.toLowerCase(),f=path.join(i,s.name);if(s.isFile()){let i=u||0==t.extensionFilters.length;if(i||(i=t.extensionFilters.some((e=>r.endsWith(e)))),i){let t=path.relative(c,f).replace(/\\/g,"/");f!==o&&e.push({file:f,relative:t})}}else if(s.isDirectory()&&!filterDirs.includes(s.name.toLocaleLowerCase())&&(l.push(f),n)){let t=path.relative(c,f).replace(/\\/g,"/");t&&e.unshift({file:f,relative:t+"/",isDir:!0})}})),n=!1,u=!1;const s=process.uptime();if(a>0&&1e3*(s-r)>a)break}m.files=e,i(m)}))}return null}function getCompletionFilesSync(e,t,i){var s,r,l;const n="string"==typeof e?e:vscode_uri_1.URI.parse(e.uri).fsPath;if(!fs.existsSync(n))return null;const o=vscode_uri_1.URI.parse(i).fsPath,f=null!==(s=t.limit)&&void 0!==s?s:-1;if(0===f)return null;const a=null!==(r=t.timeout)&&void 0!==r?r:-1;let u=null!==(l=t.prefixPath)&&void 0!==l?l:"",p="",c="",h=!1;const m={prefixRoot:"",files:[]};if(u){const e=u.lastIndexOf("/"),t=e>=0?u.slice(0,e):"";if(u.startsWith("/")&&!u.startsWith("//")){if(p=path.resolve(n,t.slice(1)),!fs.existsSync(p))return null;h=!0}else{const e=path.dirname(vscode_uri_1.URI.parse(i).fsPath);if(p=path.resolve(e,t),!fs.existsSync(p))return null}m.prefixRoot=t,c=p}else p=n,c=path.dirname(vscode_uri_1.URI.parse(i).fsPath);if(p){const e=h?"/":"",i=[];return(()=>{let s=process.uptime(),r=[p],l=!!t.withCurrentLevelFolder,n=!!t.withAllCurrentLevelFiles;for(;r.length>0&&(f<0||i.length<f);){let f=r.shift();fs.readdirSync(f,{withFileTypes:!0}).forEach((s=>{const a=s.name.toLowerCase(),u=path.join(f,s.name);if(s.isFile()){let s=n||0==t.extensionFilters.length;if(s||(s=t.extensionFilters.some((e=>a.endsWith(e)))),s){let t=path.relative(c,u).replace(/\\/g,"/");u!==o&&i.push({file:u,relative:e+t})}}else if(s.isDirectory()&&!filterDirs.includes(s.name.toLocaleLowerCase())&&(r.push(u),l)){let t=path.relative(c,u).replace(/\\/g,"/");t&&i.push({file:u,relative:e+t+"/",isDir:!0})}})),l=!1,n=!1;const u=process.uptime();if(a>0&&1e3*(u-s)>a)break}return m.files=i,m})()}return null}exports.DefaultFileExtensions={image:imageSuffix,media:mediaSuffix,js:jsSuffix,css:cssSuffix,html:htmlSuffix,font:fontSuffix,vue:vueSuffix},exports.getCompletionFiles=getCompletionFiles,exports.getCompletionFilesSync=getCompletionFilesSync;