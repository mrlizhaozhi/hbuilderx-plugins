"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.gotoDefinition=exports.doComplete=void 0;const path=require("path"),fs=require("fs"),vscode_languageserver_protocol_1=require("vscode-languageserver-protocol"),uniCloudPath_1=require("../common/uniCloudPath");function doComplete(t,e,i){let n=[],o=new Set;if(null==i?void 0:i.workspaceFolder){let t=null==i?void 0:i.workspaceFolder.uri;for(let e=0;e<uniCloudPath_1.providers.length;++e){let i=path.join(t.fsPath,(0,uniCloudPath_1.getValidationRoot)(uniCloudPath_1.providers[e]));fs.existsSync(i)&&(fs.statSync(i).isDirectory()&&fs.readdirSync(i).forEach((t=>{let e=path.join(i,t);fs.statSync(e).isFile()&&t.endsWith(".js")&&o.add(t.substr(0,t.lastIndexOf(".")))})))}getUniModuleValidatateFunction(o,t.fsPath)}return o.forEach((t=>{n.push({label:t,kind:vscode_languageserver_protocol_1.CompletionItemKind.File,documentation:t})})),n}function getUniModuleValidatateFunction(t,e){let i=path.join(e,(0,uniCloudPath_1.getUniModulesDir)());fs.existsSync(i)&&fs.statSync(i).isDirectory()&&fs.readdirSync(i).forEach((n=>{let o=path.join(i,n);if(fs.statSync(o).isDirectory()){let i=path.join(e,(0,uniCloudPath_1.getUniModuleValidate)(n,""));if(!fs.existsSync(i))return;if(!fs.statSync(i).isDirectory())return;fs.readdirSync(i).forEach((e=>{let n=path.join(i,e);fs.statSync(n).isFile()&&e.endsWith(".js")&&t.add(e.substr(0,e.lastIndexOf(".")))}))}}))}function gotoDefinition(t,e){if(null==e?void 0:e.workspaceFolder){let i=null==e?void 0:e.workspaceFolder;for(let e=0;e<uniCloudPath_1.providers.length;++e){let n=path.join(i,(0,uniCloudPath_1.getValidationRoot)(uniCloudPath_1.providers[e]));if(!fs.existsSync(n))continue;if(!fs.statSync(n).isDirectory())continue;let o=fs.readdirSync(n);for(let e of o){let i=path.join(n,e);if(fs.statSync(i).isFile()&&e.endsWith(".js")){if(path.basename(i,".js")==t)return{targetUri:i,targetRange:{start:{line:0,character:0},end:{line:0,character:0}},targetSelectionRange:{start:{line:0,character:0},end:{line:0,character:0}}}}}}let n=path.join(i,(0,uniCloudPath_1.getUniModulesDir)());if(!fs.existsSync(n))return;if(!fs.statSync(n).isDirectory())return;let o=fs.readdirSync(n);for(let e of o){let o=path.join(n,e);if(fs.statSync(o).isDirectory()){let n=path.join(i,(0,uniCloudPath_1.getUniModuleValidate)(e,""));if(!fs.existsSync(n))continue;if(!fs.statSync(n).isDirectory())continue;let o=fs.readdirSync(n);for(let e of o){let i=path.join(n,e);if(fs.statSync(i).isFile()&&e.endsWith(".js")){if(path.basename(i,".js")==t)return{targetUri:i,targetRange:{start:{line:0,character:0},end:{line:0,character:0}},targetSelectionRange:{start:{line:0,character:0},end:{line:0,character:0}}}}}}}}}exports.doComplete=doComplete,exports.gotoDefinition=gotoDefinition;