"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.gotoDefinition=exports.doComplete=void 0;const fs=require("fs"),path=require("path"),vscode_languageserver_protocol_1=require("vscode-languageserver-protocol"),uniCloudPath_1=require("../common/uniCloudPath");function doComplete(e,t,n){let o=[],r=new Set;if(null==n?void 0:n.workspaceFolder){(0,uniCloudPath_1.getAllCloudObjects)(n.workspaceFolder).forEach((e=>{r.add(e.name)}))}return r.forEach((e=>{o.push({label:e,kind:vscode_languageserver_protocol_1.CompletionItemKind.Property,documentation:e})})),o}function getTargetPath(e){let t=path.join(e,"index.obj.js");return fs.existsSync(t)?t:(t=path.join(e,"index.js"),fs.existsSync(t)?t:"")}function gotoDefinition(e,t){if(null==t?void 0:t.workspaceFolder){let n=(0,uniCloudPath_1.getAllCloudObjects)(t.workspaceFolder);for(let o of n)if(o.name==e){let n=getTargetPath(o.path);if(0==n.length)return n;if(t.fileName.endsWith(".ts")||t.fileName.endsWith(".js")){return{definitions:[{textSpan:{start:0,length:0},fileName:n,contextSpan:{start:0,length:0}}],textSpan:{start:"jql-helper-docs.ts"==t.fileName?t.token.pos+t.offset-uniCloudPath_1.jqlPrefix.length:t.token.pos+1,length:e.length}}}return{definitions:[{textSpan:{start:0,length:0},originSelectionRange:{start:{line:t.range.start.line,character:t.range.start.character},end:{line:t.range.end.line,character:t.range.start.character}},targetRange:{start:{line:0,character:0},end:{line:0,character:0}},targetSelectionRange:{start:{line:0,character:0},end:{line:0,character:0}},fileName:n}]}}}}exports.doComplete=doComplete,exports.gotoDefinition=gotoDefinition;