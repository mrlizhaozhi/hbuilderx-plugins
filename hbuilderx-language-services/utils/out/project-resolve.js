"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getLibraries=exports.getSettingPath=exports.isUniAppCli=exports.isExtension=exports.isWap2App=exports.sitemapExists=exports.isApp=exports.isWepy=exports.isMpVue=exports.isMiniApp=exports.isUniAppVue=exports.getProjectType=exports.ProjectType=void 0;const fs=require("fs"),path=require("path"),os=require("os"),jsonc_1=require("jsonc"),md5=require("md5");function getSettingPath(s){s=fs.realpathSync.native(s).replace(/\\/g,"/");let e=md5(s),p=os.platform();return p="win32"==os.platform()?path.join(os.homedir(),"AppData/Roaming/HBuilder X"):path.join(os.homedir(),"Library/Application Support/HBuilder X/"),path.join(p,"projects",e,"setting.json")}function getLibraries(s){let e=getSettingPath(s);if(fs.existsSync(e)){let s=fs.readFileSync(e).toString();const[p,i]=jsonc_1.jsonc.safe.parse(s);if(!p&&i.libraries)return i.libraries}return[]}function getProjectType(s){if(!fs.existsSync(s))return ProjectType.PT_Unknown;let e=ProjectType.PT_Web;return isUniAppVue(s)?ProjectType.PT_UniApp_Vue:isMiniApp(s)?ProjectType.PT_MiniApp:isMpVue(s)?ProjectType.PT_MpVue:isWap2App(s)||isApp(s)?ProjectType.PT_App:isExtension(s)?ProjectType.PT_Extension:e}function isUniAppCli(s){let e=!1;const p=path.join(s,"package.json"),i=path.join(s,"src"),t=path.join(s,"src","manifest.json"),n=path.join(s,"src","pages.json"),o=path.join(s,"src","App.vue"),r=path.join(s,"src","App.nvue"),c=path.join(s,"src","main.js"),a=path.join(s,"src","main.ts");return fs.existsSync(p)&&fs.existsSync(t)&&fs.existsSync(n)&&fs.existsSync(i)&&(fs.existsSync(o)||fs.existsSync(r))&&(fs.existsSync(c)||fs.existsSync(a))&&(e=!0),e}function isUniAppVue(s){let e=!1;const p=path.join(s,"manifest.json"),i=path.join(s,"pages.json"),t=path.join(s,"App.vue"),n=path.join(s,"App.nvue"),o=path.join(s,"main.js"),r=path.join(s,"main.ts");return fs.existsSync(p)&&fs.existsSync(i)&&(fs.existsSync(t)||fs.existsSync(n))&&(fs.existsSync(o)||fs.existsSync(r))&&(e=!0),e||(e=isUniAppCli(s)),e}function isMiniApp(s){let e=!1;const p=path.join(s,"project.config.json"),i=path.join(s,"node_modules"),t=path.join(s,"package.json");return fs.existsSync(p)&&(e=!0,(fs.existsSync(i)||fs.existsSync(t))&&(e=!1)),e}function isMpVue(s){let e=!1;const p=path.join(s,"project.config.json"),i=path.join(s,"node_modules"),t=path.join(s,"package.json");return fs.existsSync(p)&&(fs.existsSync(i)||fs.existsSync(t))&&(e=!0),e}function isWepy(s){let e=!1;const p=path.join(s,"wepy.config.js");return fs.existsSync(p)&&(e=!0),e}function isApp(s){let e=!1;const p=path.join(s,"manifest.json"),i=path.join(s,"src","manifest.json");let t="";if((fs.existsSync(p)||fs.existsSync(i))&&(t=p),fs.existsSync(t)){let p=fs.readFileSync(t).toString();const[i,n]=jsonc_1.jsonc.safe.parse(p);if(!i){(n.name||null)&&(isExtension(s)||(e=(null==n?void 0:n.plus)||!1))}}return e}function isWap2App(s){return isApp(s)&&sitemapExists(s)}function sitemapExists(s){let e=!1;const p=path.join(s,"sitemap.json");return fs.existsSync(p)&&(e=!0),e}function isExtension(s){let e=!1;const p=path.join(s,"package.json");if(fs.existsSync(p)){let s=fs.readFileSync(p).toString();const[i,t]=jsonc_1.jsonc.safe.parse(s);if(!i){let s=!1,p=t.engines||null;p&&(s=p.HBuilderX);let i=t.main||null,n=t.contributes||null;!s||null==i&&null==n||(e=!0)}}return e}var ProjectType;exports.getSettingPath=getSettingPath,exports.getLibraries=getLibraries,exports.getProjectType=getProjectType,exports.isUniAppCli=isUniAppCli,exports.isUniAppVue=isUniAppVue,exports.isMiniApp=isMiniApp,exports.isMpVue=isMpVue,exports.isWepy=isWepy,exports.isApp=isApp,exports.isWap2App=isWap2App,exports.sitemapExists=sitemapExists,exports.isExtension=isExtension,function(s){s[s.PT_Unknown=0]="PT_Unknown",s[s.PT_Web=1]="PT_Web",s[s.PT_App=2]="PT_App",s[s.PT_UniApp=3]="PT_UniApp",s[s.PT_Wap2App=4]="PT_Wap2App",s[s.PT_Extension=5]="PT_Extension",s[s.PT_UniApp_Vue=6]="PT_UniApp_Vue",s[s.PT_MiniApp=7]="PT_MiniApp",s[s.PT_MpVue=8]="PT_MpVue",s[s.PT_WePy=9]="PT_WePy",s[s.PT_BaiduApp=10]="PT_BaiduApp",s[s.PT_AlipayApp=11]="PT_AlipayApp",s[s.PT_ByteDanceApp=12]="PT_ByteDanceApp",s[s.PT_QQApp=13]="PT_QQApp",s[s.PT_App360=14]="PT_App360",s[s.PT_HuaweiApp=15]="PT_HuaweiApp",s[s.PT_QuickAppUnion=16]="PT_QuickAppUnion",s[s.PT_KuaiShouApp=17]="PT_KuaiShouApp"}(ProjectType=exports.ProjectType||(exports.ProjectType={}));