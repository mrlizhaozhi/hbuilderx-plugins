"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.jqlPrefix=exports.getAllCloudObjects=exports.getAllCloudFunctions=exports.isNotUniModulesPages=exports.isUniMoudlesPages=exports.fixPath=exports.isUniCloudServerFile=exports.getUniModuleAction=exports.getUniModuleCloudFunction=exports.getUniModuleValidate=exports.getUniModuleDatabase=exports.getUniModuleUniCloud=exports.getUniModulesDir=exports.getValidationRoot=exports.getCloudActionRoot=exports.getCloudDatabaseRoot=exports.getCloudFunctionsRoot=exports.getUniCloudRoot=exports.providers=void 0;const fs=require("fs"),path=require("path");let providers=["aliyun","tcb"];exports.providers=providers;const jqlPrefix="let db = uniCloud.database();";function fixPath(t){return t.replace(/\\/g,"/")}function isUniMoudlesPages(t){return/uni_modules\/\\S+\/pages\/\\S+.vue/i.test(t)||/uni_modules\/\\S+\/pages\/\\S+.nvue/i.test(t)}function isNotUniModulesPages(t){return!(t.startsWith("uni_modules")&&t.includes("\\pages\\")&&t.endsWith("vue"))&&!(t.startsWith("uni_modules")&&t.includes("/pages/")&&t.endsWith("vue"))}function hasCloudResources(t){for(let e of providers){let o=path.join(t,"uniCloud-",e);if(fs.existsSync(o))return!0}return!1}function isUniCloudServerFile(t,e){let o=!1;for(let n of providers){let i=path.join(e,getCloudFunctionsRoot(n));if(t.startsWith(i)){o=!0;break}let u=path.join(e,"uni_modules/\\S+/uniCloud-",n,"cloudfunctions/*.js");if(new RegExp(u).test(fixPath(t))){o=!0;break}}return o}function getUniCloudRoot(t){return"uniCloud-"+t}function getCloudFunctionsRoot(t){return getUniCloudRoot(t)+"/cloudfunctions"}function getCloudDatabaseRoot(t){return getUniCloudRoot(t)+"/database"}function getCloudActionRoot(t){return getCloudFunctionsRoot(t)+"/uni-clientDB-actions"}function getValidationRoot(t){return getUniCloudRoot(t)+"/database/validateFunction"}function getUniModulesDir(){return"uni_modules"}function getUniModuleUniCloud(t,e){return getUniModulesDir()+"/"+t+"/uniCloud"}function getUniModuleDatabase(t,e){return getUniModuleUniCloud(t,e)+"/database"}function getUniModuleValidate(t,e){return getUniModuleUniCloud(t,e)+"/database/validateFunction"}function getUniModuleCloudFunction(t,e){return getUniModuleUniCloud(t,e)+"/cloudfunctions"}function getUniModuleAction(t,e){return getUniModuleCloudFunction(t,e)+"/uni-clientDB-actions"}function getAllCloudObjects(t){let e=getAllCloudFunctions(t),o=new Set;return e.forEach((t=>{fs.existsSync(path.join(t.path,"index.obj.js"))&&o.add(t)})),o}function getAllCloudFunctions(t){let e=new Set;for(let o=0;o<providers.length;++o){let n=getCloudFunctionsRoot(providers[o]),i=path.join(t,n);fs.existsSync(i)&&fs.readdirSync(i).forEach((t=>{let o=path.join(i,t);fs.statSync(o).isDirectory()&&"common"!==t&&"uni-clientDB-actions"!==t&&e.add({name:t,path:o})}))}let o=getUniModulesDir(),n=path.join(t,o);return fs.existsSync(n)&&fs.statSync(n).isDirectory()&&fs.readdirSync(n).forEach((o=>{let i=path.join(n,o);if(fs.statSync(i).isDirectory()){let n=getUniModuleCloudFunction(o,""),i=path.join(t,n);fs.existsSync(i)&&fs.statSync(i).isDirectory()&&fs.readdirSync(i).forEach((t=>{let o=path.join(i,t);"common"!==t&&"uni-clientDB-actions"!==t&&fs.statSync(o).isDirectory()&&e.add({name:t,path:o})}))}})),e}exports.jqlPrefix=jqlPrefix,exports.fixPath=fixPath,exports.isUniMoudlesPages=isUniMoudlesPages,exports.isNotUniModulesPages=isNotUniModulesPages,exports.isUniCloudServerFile=isUniCloudServerFile,exports.getUniCloudRoot=getUniCloudRoot,exports.getCloudFunctionsRoot=getCloudFunctionsRoot,exports.getCloudDatabaseRoot=getCloudDatabaseRoot,exports.getCloudActionRoot=getCloudActionRoot,exports.getValidationRoot=getValidationRoot,exports.getUniModulesDir=getUniModulesDir,exports.getUniModuleUniCloud=getUniModuleUniCloud,exports.getUniModuleDatabase=getUniModuleDatabase,exports.getUniModuleValidate=getUniModuleValidate,exports.getUniModuleCloudFunction=getUniModuleCloudFunction,exports.getUniModuleAction=getUniModuleAction,exports.getAllCloudObjects=getAllCloudObjects,exports.getAllCloudFunctions=getAllCloudFunctions;