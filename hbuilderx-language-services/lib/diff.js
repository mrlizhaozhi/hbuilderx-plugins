"use strict";function stringDiff(t,i,e){return new LcsDiff(new StringDiffSequence(t),new StringDiffSequence(i)).ComputeDiff(e).changes}exports.__esModule=!0,exports.stringDiff=stringDiff;var StringDiffSequence=function(){function t(t){this.source=t}return t.prototype.getElements=function(){for(var t=this.source,i=new Int32Array(t.length),e=0,n=t.length;e<n;e++)i[e]=t.charCodeAt(e);return i},t}(),DiffChange=function(){function t(t,i,e,n){this.originalStart=t,this.originalLength=i,this.modifiedStart=e,this.modifiedLength=n}return t.prototype.getOriginalEnd=function(){return this.originalStart+this.originalLength},t.prototype.getModifiedEnd=function(){return this.modifiedStart+this.modifiedLength},t}(),Debug=function(){function t(){}return t.Assert=function(t,i){if(!t)throw new Error(i)},t}();exports.Debug=Debug;var MyArray=function(){function t(){}return t.Copy=function(t,i,e,n,r){for(var o=0;o<r;o++)e[n+o]=t[i+o]},t.Copy2=function(t,i,e,n,r){for(var o=0;o<r;o++)e[n+o]=t[i+o]},t}(),DiffChangeHelper=function(){function t(){this.m_changes=[],this.m_originalStart=1073741824,this.m_modifiedStart=1073741824,this.m_originalCount=0,this.m_modifiedCount=0}return t.prototype.MarkNextChange=function(){(this.m_originalCount>0||this.m_modifiedCount>0)&&this.m_changes.push(new DiffChange(this.m_originalStart,this.m_originalCount,this.m_modifiedStart,this.m_modifiedCount)),this.m_originalCount=0,this.m_modifiedCount=0,this.m_originalStart=1073741824,this.m_modifiedStart=1073741824},t.prototype.AddOriginalElement=function(t,i){this.m_originalStart=Math.min(this.m_originalStart,t),this.m_modifiedStart=Math.min(this.m_modifiedStart,i),this.m_originalCount++},t.prototype.AddModifiedElement=function(t,i){this.m_originalStart=Math.min(this.m_originalStart,t),this.m_modifiedStart=Math.min(this.m_modifiedStart,i),this.m_modifiedCount++},t.prototype.getChanges=function(){return(this.m_originalCount>0||this.m_modifiedCount>0)&&this.MarkNextChange(),this.m_changes},t.prototype.getReverseChanges=function(){return(this.m_originalCount>0||this.m_modifiedCount>0)&&this.MarkNextChange(),this.m_changes.reverse(),this.m_changes},t}(),LcsDiff=function(){function t(i,e,n){void 0===n&&(n=null),this.ContinueProcessingPredicate=n;var r=t._getElements(i),o=r[0],a=r[1],s=r[2],h=t._getElements(e),g=h[0],f=h[1],l=h[2];this._hasStrings=s&&l,this._originalStringElements=o,this._originalElementsOrHash=a,this._modifiedStringElements=g,this._modifiedElementsOrHash=f,this.m_forwardHistory=[],this.m_reverseHistory=[]}return t._getElements=function(t){var i=t.getElements();return i instanceof Int32Array?[[],i,!1]:[[],new Int32Array(i),!1]},t.prototype.ElementsAreEqual=function(t,i){return this._originalElementsOrHash[t]===this._modifiedElementsOrHash[i]&&(!this._hasStrings||this._originalStringElements[t]===this._modifiedStringElements[i])},t.prototype.OriginalElementsAreEqual=function(t,i){return this._originalElementsOrHash[t]===this._originalElementsOrHash[i]&&(!this._hasStrings||this._originalStringElements[t]===this._originalStringElements[i])},t.prototype.ModifiedElementsAreEqual=function(t,i){return this._modifiedElementsOrHash[t]===this._modifiedElementsOrHash[i]&&(!this._hasStrings||this._modifiedStringElements[t]===this._modifiedStringElements[i])},t.prototype.ComputeDiff=function(t){return this._ComputeDiff(0,this._originalElementsOrHash.length-1,0,this._modifiedElementsOrHash.length-1,t)},t.prototype._ComputeDiff=function(t,i,e,n,r){var o=[!1],a=this.ComputeDiffRecursive(t,i,e,n,o);return r&&(a=this.PrettifyChanges(a)),{quitEarly:o[0],changes:a}},t.prototype.ComputeDiffRecursive=function(t,i,e,n,r){for(r[0]=!1;t<=i&&e<=n&&this.ElementsAreEqual(t,e);)t++,e++;for(;i>=t&&n>=e&&this.ElementsAreEqual(i,n);)i--,n--;if(t>i||e>n){var o=void 0;return e<=n?(Debug.Assert(t===i+1,"originalStart should only be one more than originalEnd"),o=[new DiffChange(t,0,e,n-e+1)]):t<=i?(Debug.Assert(e===n+1,"modifiedStart should only be one more than modifiedEnd"),o=[new DiffChange(t,i-t+1,e,0)]):(Debug.Assert(t===i+1,"originalStart should only be one more than originalEnd"),Debug.Assert(e===n+1,"modifiedStart should only be one more than modifiedEnd"),o=[]),o}var a=[0],s=[0],h=this.ComputeRecursionPoint(t,i,e,n,a,s,r),g=a[0],f=s[0];if(null!==h)return h;if(!r[0]){var l=this.ComputeDiffRecursive(t,g,e,f,r),d=[];return d=r[0]?[new DiffChange(g+1,i-(g+1)+1,f+1,n-(f+1)+1)]:this.ComputeDiffRecursive(g+1,i,f+1,n,r),this.ConcatenateChanges(l,d)}return[new DiffChange(t,i-t+1,e,n-e+1)]},t.prototype.WALKTRACE=function(t,i,e,n,r,o,a,s,h,g,f,l,d,u,m,_,y,p){var c,S=null,C=new DiffChangeHelper,E=i,v=e,A=d[0]-_[0]-n,D=-1073741824,L=this.m_forwardHistory.length-1;do{(H=A+t)===E||H<v&&h[H-1]<h[H+1]?(u=(f=h[H+1])-A-n,f<D&&C.MarkNextChange(),D=f,C.AddModifiedElement(f+1,u),A=H+1-t):(u=(f=h[H-1]+1)-A-n,f<D&&C.MarkNextChange(),D=f-1,C.AddOriginalElement(f,u+1),A=H-1-t),L>=0&&(t=(h=this.m_forwardHistory[L])[0],E=1,v=h.length-1)}while(--L>=-1);if(c=C.getReverseChanges(),p[0]){var M=d[0]+1,O=_[0]+1;if(null!==c&&c.length>0){var w=c[c.length-1];M=Math.max(M,w.getOriginalEnd()),O=Math.max(O,w.getModifiedEnd())}S=[new DiffChange(M,l-M+1,O,m-O+1)]}else{C=new DiffChangeHelper,E=o,v=a,A=d[0]-_[0]-s,D=1073741824,L=y?this.m_reverseHistory.length-1:this.m_reverseHistory.length-2;do{var H;(H=A+r)===E||H<v&&g[H-1]>=g[H+1]?(u=(f=g[H+1]-1)-A-s,f>D&&C.MarkNextChange(),D=f+1,C.AddOriginalElement(f+1,u+1),A=H+1-r):(u=(f=g[H-1])-A-s,f>D&&C.MarkNextChange(),D=f,C.AddModifiedElement(f+1,u+1),A=H-1-r),L>=0&&(r=(g=this.m_reverseHistory[L])[0],E=1,v=g.length-1)}while(--L>=-1);S=C.getChanges()}return this.ConcatenateChanges(c,S)},t.prototype.ComputeRecursionPoint=function(t,i,e,n,r,o,a){var s=0,h=0,g=0,f=0,l=0,d=0;t--,e--,r[0]=0,o[0]=0,this.m_forwardHistory=[],this.m_reverseHistory=[];var u=i-t+(n-e),m=u+1,_=new Int32Array(m),y=new Int32Array(m),p=n-e,c=i-t,S=t-e,C=i-n,E=(c-p)%2==0;_[p]=t,y[c]=i,a[0]=!1;for(var v=1;v<=u/2+1;v++){var A=0,D=0;g=this.ClipDiagonalBound(p-v,v,p,m),f=this.ClipDiagonalBound(p+v,v,p,m);for(var L=g;L<=f;L+=2){h=(s=L===g||L<f&&_[L-1]<_[L+1]?_[L+1]:_[L-1]+1)-(L-p)-S;for(var M=s;s<i&&h<n&&this.ElementsAreEqual(s+1,h+1);)s++,h++;if(_[L]=s,s+h>A+D&&(A=s,D=h),!E&&Math.abs(L-c)<=v-1&&s>=y[L])return r[0]=s,o[0]=h,M<=y[L]&&v<=1448?this.WALKTRACE(p,g,f,S,c,l,d,C,_,y,s,i,r,h,n,o,E,a):null}var O=(A-t+(D-e)-v)/2;if(null!==this.ContinueProcessingPredicate&&!this.ContinueProcessingPredicate(A,O))return a[0]=!0,r[0]=A,o[0]=D,O>0&&v<=1448?this.WALKTRACE(p,g,f,S,c,l,d,C,_,y,s,i,r,h,n,o,E,a):(t++,e++,[new DiffChange(t,i-t+1,e,n-e+1)]);l=this.ClipDiagonalBound(c-v,v,c,m),d=this.ClipDiagonalBound(c+v,v,c,m);for(L=l;L<=d;L+=2){h=(s=L===l||L<d&&y[L-1]>=y[L+1]?y[L+1]-1:y[L-1])-(L-c)-C;for(M=s;s>t&&h>e&&this.ElementsAreEqual(s,h);)s--,h--;if(y[L]=s,E&&Math.abs(L-p)<=v&&s<=_[L])return r[0]=s,o[0]=h,M>=_[L]&&v<=1448?this.WALKTRACE(p,g,f,S,c,l,d,C,_,y,s,i,r,h,n,o,E,a):null}if(v<=1447){var w=new Int32Array(f-g+2);w[0]=p-g+1,MyArray.Copy2(_,g,w,1,f-g+1),this.m_forwardHistory.push(w),(w=new Int32Array(d-l+2))[0]=c-l+1,MyArray.Copy2(y,l,w,1,d-l+1),this.m_reverseHistory.push(w)}}return this.WALKTRACE(p,g,f,S,c,l,d,C,_,y,s,i,r,h,n,o,E,a)},t.prototype.PrettifyChanges=function(t){for(var i=0;i<t.length;i++){for(var e=t[i],n=i<t.length-1?t[i+1].originalStart:this._originalElementsOrHash.length,r=i<t.length-1?t[i+1].modifiedStart:this._modifiedElementsOrHash.length,o=e.originalLength>0,a=e.modifiedLength>0;e.originalStart+e.originalLength<n&&e.modifiedStart+e.modifiedLength<r&&(!o||this.OriginalElementsAreEqual(e.originalStart,e.originalStart+e.originalLength))&&(!a||this.ModifiedElementsAreEqual(e.modifiedStart,e.modifiedStart+e.modifiedLength));)e.originalStart++,e.modifiedStart++;var s=[null];i<t.length-1&&this.ChangesOverlap(t[i],t[i+1],s)&&(t[i]=s[0],t.splice(i+1,1),i--)}for(i=t.length-1;i>=0;i--){e=t[i],n=0,r=0;if(i>0){var h=t[i-1];h.originalLength>0&&(n=h.originalStart+h.originalLength),h.modifiedLength>0&&(r=h.modifiedStart+h.modifiedLength)}o=e.originalLength>0,a=e.modifiedLength>0;for(var g=0,f=this._boundaryScore(e.originalStart,e.originalLength,e.modifiedStart,e.modifiedLength),l=1;;l++){var d=e.originalStart-l,u=e.modifiedStart-l;if(d<n||u<r)break;if(o&&!this.OriginalElementsAreEqual(d,d+e.originalLength))break;if(a&&!this.ModifiedElementsAreEqual(u,u+e.modifiedLength))break;var m=this._boundaryScore(d,e.originalLength,u,e.modifiedLength);m>f&&(f=m,g=l)}e.originalStart-=g,e.modifiedStart-=g}return t},t.prototype._OriginalIsBoundary=function(t){return t<=0||t>=this._originalElementsOrHash.length-1||this._hasStrings&&/^\s*$/.test(this._originalStringElements[t])},t.prototype._OriginalRegionIsBoundary=function(t,i){if(this._OriginalIsBoundary(t)||this._OriginalIsBoundary(t-1))return!0;if(i>0){var e=t+i;if(this._OriginalIsBoundary(e-1)||this._OriginalIsBoundary(e))return!0}return!1},t.prototype._ModifiedIsBoundary=function(t){return t<=0||t>=this._modifiedElementsOrHash.length-1||this._hasStrings&&/^\s*$/.test(this._modifiedStringElements[t])},t.prototype._ModifiedRegionIsBoundary=function(t,i){if(this._ModifiedIsBoundary(t)||this._ModifiedIsBoundary(t-1))return!0;if(i>0){var e=t+i;if(this._ModifiedIsBoundary(e-1)||this._ModifiedIsBoundary(e))return!0}return!1},t.prototype._boundaryScore=function(t,i,e,n){return(this._OriginalRegionIsBoundary(t,i)?1:0)+(this._ModifiedRegionIsBoundary(e,n)?1:0)},t.prototype.ConcatenateChanges=function(t,i){var e=[];if(0===t.length||0===i.length)return i.length>0?i:t;if(this.ChangesOverlap(t[t.length-1],i[0],e)){var n=new Array(t.length+i.length-1);return MyArray.Copy(t,0,n,0,t.length-1),n[t.length-1]=e[0],MyArray.Copy(i,1,n,t.length,i.length-1),n}n=new Array(t.length+i.length);return MyArray.Copy(t,0,n,0,t.length),MyArray.Copy(i,0,n,t.length,i.length),n},t.prototype.ChangesOverlap=function(t,i,e){if(Debug.Assert(t.originalStart<=i.originalStart,"Left change is not less than or equal to right change"),Debug.Assert(t.modifiedStart<=i.modifiedStart,"Left change is not less than or equal to right change"),t.originalStart+t.originalLength>=i.originalStart||t.modifiedStart+t.modifiedLength>=i.modifiedStart){var n=t.originalStart,r=t.originalLength,o=t.modifiedStart,a=t.modifiedLength;return t.originalStart+t.originalLength>=i.originalStart&&(r=i.originalStart+i.originalLength-t.originalStart),t.modifiedStart+t.modifiedLength>=i.modifiedStart&&(a=i.modifiedStart+i.modifiedLength-t.modifiedStart),e[0]=new DiffChange(n,r,o,a),!0}return e[0]=null,!1},t.prototype.ClipDiagonalBound=function(t,i,e,n){if(t>=0&&t<n)return t;var r=i%2==0;return t<0?r===(e%2==0)?0:1:r===((n-e-1)%2==0)?n-1:n-2},t}();exports.LcsDiff=LcsDiff;