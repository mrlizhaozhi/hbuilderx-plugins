"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.runSafe=exports.formatError=void 0;const vscode_languageserver_1=require("vscode-languageserver");function formatError(e,r){if(r instanceof Error){let o=r;return`${e}: ${o.message}\n${o.stack}`}return"string"==typeof r?`${e}: ${r}`:r?`${e}: ${r.toString()}`:e}function runSafe(e,r,o,n){return new Promise((t=>{setImmediate((()=>(n.isCancellationRequested&&t(cancelValue()),e().then((e=>{n.isCancellationRequested?t(cancelValue()):t(e)}),(e=>{console.error(formatError(o,e)),t(r)})))))}))}function cancelValue(){return new vscode_languageserver_1.ResponseError(vscode_languageserver_1.ErrorCodes.RequestCancelled,"Request cancelled")}exports.formatError=formatError,exports.runSafe=runSafe;