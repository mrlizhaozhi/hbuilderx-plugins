"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getExternalDataProvider=exports.getDependencyDataProvider=exports.getWorkspaceDataProvider=exports.gridsomeTagProvider=exports.onsenTagProvider=exports.elementTagProvider=exports.VeturDataProvider=void 0;const fs=require("fs"),path=require("path"),ts=require("typescript");class VeturDataProvider{constructor(e,t){this.id=e,this._tags=[],this._tagMap={},this._enable=!0,this._tagMap=t,this._tags=Object.values(t)}clone(){return new VeturDataProvider(this.id,this._tagMap)}getId(){return this.id}get enable(){return this._enable}set enable(e){this._enable=e}isApplicable(e){return this._enable&&"vue"==e}provideTags(){return this._tags}provideAttributes(e){const t=[],r=e=>{t.push(e)};let s=this._tagMap[e];return s&&s.attributes.forEach(r),t}provideValues(e,t){var r;const s=[];t=t.toLowerCase();let a=this._tagMap[e];return a&&(null!==(r=a.attributes)&&void 0!==r?r:[]).forEach((e=>{e.name.toLowerCase()===t&&e.values&&e.values.forEach((e=>{s.push(e)}))})),s}}exports.VeturDataProvider=VeturDataProvider;const elementTags=require("element-helper-json/element-tags.json"),elementAttributes=require("element-helper-json/element-attributes.json"),onsenTags=require("vue-onsenui-helper-json/vue-onsenui-tags.json"),onsenAttributes=require("vue-onsenui-helper-json/vue-onsenui-attributes.json"),gridsomeTags=require("gridsome-helper-json/gridsome-tags.json"),gridsomeAttributes=require("gridsome-helper-json/gridsome-attributes.json");function findConfigFile(e,t){return ts.findConfigFile(e,ts.sys.fileExists,t)}function getWorkspaceDataProvider(e,t){if(!t.vetur)return null;const r=findConfigFile(e,t.vetur.tags),s=findConfigFile(e,t.vetur.attributes);try{if(r&&s){const e=JSON.parse(fs.readFileSync(r,"utf-8"));return getExternalDataProvider("__vetur-workspace",e,JSON.parse(fs.readFileSync(s,"utf-8")))}return null}catch(e){return null}}function getDependencyDataProvider(e,t,r){if(!r.vetur)return null;try{const s=require.resolve(path.join(t,r.vetur.tags),{paths:[e]}),a=require.resolve(path.join(t,r.vetur.attributes),{paths:[e]}),n=JSON.parse(fs.readFileSync(s,"utf-8"));return getExternalDataProvider(t,n,JSON.parse(fs.readFileSync(a,"utf-8")))}catch(e){return console.error(e.stack),null}}function getExternalDataProvider(e,t,r){let s=new Map;Object.keys(r).forEach((e=>{var t;let a=r[e],n={name:e,description:a.description},i="event"===a.type;"boolean"===a.type?n.valueSet="v":!i&&a.options instanceof Array&&(n.values=a.options.map((e=>({name:e}))));let o=e.indexOf("/"),u=e.slice(o>=0?o+1:0);n.name=(i?"[event]":"")+u;let l=e.slice(0,o>=0?o:0);s.has(l)||s.set(l,[]),null===(t=s.get(l))||void 0===t||t.push(n)}));let a={};return Object.keys(t).forEach((e=>{var r,n;let i=t[e],o=[];if(i.attributes instanceof Array)for(let t=0;t<i.attributes.length;t++){let a=i.attributes[t],u="[event]"+a;o.push(...(null!==(r=s.get(""))&&void 0!==r?r:[]).filter((e=>e.name===a||e.name===u))),o.push(...(null!==(n=s.get(e))&&void 0!==n?n:[]).filter((e=>e.name===a||e.name===u)))}a[e]={name:e,description:i.description,attributes:o}})),new VeturDataProvider(e,a)}exports.elementTagProvider=getExternalDataProvider("element",elementTags,elementAttributes),exports.onsenTagProvider=getExternalDataProvider("onsen",onsenTags,onsenAttributes),exports.gridsomeTagProvider=getExternalDataProvider("gridsome",gridsomeTags,gridsomeAttributes),exports.getWorkspaceDataProvider=getWorkspaceDataProvider,exports.getDependencyDataProvider=getDependencyDataProvider,exports.getExternalDataProvider=getExternalDataProvider;