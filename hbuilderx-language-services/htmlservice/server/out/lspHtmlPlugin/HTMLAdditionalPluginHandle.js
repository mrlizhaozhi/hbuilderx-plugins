"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TsHtmlAdditionalDefinitionHandle=exports.TsHtmlAdditionalCompletionHandle=void 0;const core_1=require("../../../../core"),plugins_1=require("../plugins");class TsHtmlAdditionalCompletionHandle{constructor(t,e,i){this.ls=t,this.allInfo=e,this.dataProviders=i}doExtraCompletion(t,e,i,n){let o=this.ls.getLocationInfoAtPosition(e,i,n);if(!o)return t;if(!o.activeAttribute)return t;if(o.kind===plugins_1.LocationInfoKind.AttributeValue)t=this.addPathCompletion(t,e,i,o);return t}addPathCompletion(t,e,i,n){if(!n)return t;if(!n.activeAttribute)return t;let o=n.activeTag;if(!o)return t;let r=n.activeAttribute,a=[];this.dataProviders.forEach((t=>{t.provideAttributes(o).forEach((t=>{t.name===r&&t.valueSet&&a.push(t.valueSet)}))}));let l={range:(0,core_1.getContextData)(e,e.offsetAt(i)," \t\n\r'\":{[()]},*>+").contextRange,kind:core_1.StringLocationInfoKind.IN_HTML_LIKE,ast:void 0,project:this.allInfo.project},s=new Map,d=core_1.StringServicesContainer.create(s);return t=(0,core_1.doComplete)(a,e,i,l,d,t.items,!1)}}exports.TsHtmlAdditionalCompletionHandle=TsHtmlAdditionalCompletionHandle;class TsHtmlAdditionalDefinitionHandle{constructor(t,e,i){this.ls=t,this.allInfo=e,this.dataProviders=i}doExtraDefinition(t,e,i,n){let o=this.ls.getLocationInfoAtPosition(e,i,n);if(!o)return t;if(!o.activeAttribute)return t;if(t||(t=[]),o.kind===plugins_1.LocationInfoKind.AttributeValue)t=this.getDefinitionFromPath(t,e,i,o);return t}getDefinitionFromPath(t,e,i,n){if(!n)return t;if(!n.activeAttribute)return t;let o=n.activeTag;if(!o)return t;let r=n.activeAttribute,a=[];this.dataProviders.forEach((t=>{t.provideAttributes(o).forEach((t=>{t.name===r&&t.valueSet&&a.push(t.valueSet)}))}));let l={range:(0,core_1.getContextData)(e,e.offsetAt(i)," \t\n\r'\":{[()]},*>+").contextRange,kind:core_1.StringLocationInfoKind.IN_HTML_LIKE,ast:void 0,project:this.allInfo.project},s=new Map,d=core_1.StringServicesContainer.create(s),c=(0,core_1.doDefinition)(a,e,i,l,d);return c&&0!==c.length?c:t}}exports.TsHtmlAdditionalDefinitionHandle=TsHtmlAdditionalDefinitionHandle;