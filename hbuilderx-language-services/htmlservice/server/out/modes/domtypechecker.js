"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const ts=require("typescript");class DomCheckerPlugin{constructor(e){this.htmlDocProvider=e}checkExpression(e,t,r,i,s,l){var n;let a=this.htmlDocProvider?this.htmlDocProvider(""):void 0;if(i.kind===ts.SyntaxKind.PropertyAccessExpression){if((null===(n=i.parent)||void 0===n?void 0:n.kind)===ts.SyntaxKind.CallExpression){let e=r.defaultCheckExpression(i,s,l),t=r.getSignaturesOfType(e,ts.SignatureKind.Call);return t&&t.forEach((e=>{var t;let s=e.getReturnType();if(s&&"HTMLElement"===(null===(t=s.symbol)||void 0===t?void 0:t.escapedName)||s.getProperty("getElementsByTagName")){let t=i.parent,s=t.getFullText(i.getSourceFile()),l="";if(s.indexOf(".getElementById")>0){let e=u(t.arguments);e&&e.kind==ts.SyntaxKind.StringLiteral&&(l=e.text)}else if(s.indexOf(".querySelector")){let e=u(t.arguments);if(e&&e.kind==ts.SyntaxKind.StringLiteral){let t=e.text;t&&t.startsWith("#")&&(l=t.substring(1))}}if(null==l||0==l.length)return;let n="";if(o(null==a?void 0:a.roots,(e=>{if(e.attributes&&e.attributes.id){let t=e.attributes.id;if((t.startsWith('"')&&t.startsWith('"')||t.startsWith("'")&&t.startsWith("'"))&&(t=t.substring(1,t.length-1)),t===l&&e.tag)return n=e.tag,!1}return!0})),n&&n.length>0){n=n.toLowerCase();let t={a:"Link",img:"Image",li:"LI",ul:"UList",textarea:"TextArea",p:"Paragraph",ol:"OList",iframe:"IFrame",hr:"HR",br:"BR"};if(t[n])n=t[n];else{let e=n[0].toUpperCase();n=e+n.substring(1)}let s=r.getSymbolsInScope(i,ts.SymbolFlags.Interface|ts.SymbolFlags.Class).find((e=>e.escapedName===`HTML${n}Element`));s&&(e.resolvedReturnType=r.getDeclaredTypeOfSymbol(s))}}})),e}}return;function o(e,t){if(e&&e.length>0)for(let r=0;r<e.length;r++)t(e[r])&&o(e[r].children,t)}function u(e){if(e&&e.length>0)return e[0]}}}exports.default=DomCheckerPlugin;