"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,a,r){void 0===r&&(r=a),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[a]}})}:function(e,t,a,r){void 0===r&&(r=a),e[r]=t[a]}),__exportStar=this&&this.__exportStar||function(e,t){for(var a in e)"default"===a||Object.prototype.hasOwnProperty.call(t,a)||__createBinding(t,e,a)};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getLanguageModes=exports.VueLanguageModeId=void 0;const vscode_css_languageservice_1=require("vscode-css-languageservice"),vscode_html_languageservice_1=require("vscode-html-languageservice"),languageModelCache_1=require("../languageModelCache"),cssMode_1=require("./cssMode"),embeddedSupport_1=require("./embeddedSupport"),htmlMode_1=require("./htmlMode"),javascriptMode_1=require("./javascriptMode"),vueTemplateMode_1=require("./vueTemplateMode"),vueStyleMode_1=require("./vueStyleMode"),htmlDataProviderParticipant_1=require("./htmlDataProviderParticipant");var VueLanguageModeId;function getLanguageModes(e,t,a,r){const o=(0,vscode_html_languageservice_1.getLanguageService)({clientCapabilities:a}),i=(0,vscode_css_languageservice_1.getCSSLanguageService)({clientCapabilities:a}),s=(0,vscode_html_languageservice_1.getLanguageService)({clientCapabilities:a});let u=(0,languageModelCache_1.getLanguageModelCache)(10,60,(e=>o.parseHTMLDocument(e))),n=(0,languageModelCache_1.getLanguageModelCache)(10,60,(e=>(0,embeddedSupport_1.getDocumentRegions)(o,e))),d=[];d.push(n);let g=Object.create(null);function c(e){if(e)return"vue:css"===e||"vue:scss"===e||"vue:less"===e||"vue:stylus"===e?VueLanguageModeId.Style:e}g.html=(0,htmlMode_1.getHTMLMode)({clientCapabilities:a,fileSystemProvider:r},o,u,t),e.css&&(g.css=(0,cssMode_1.getCSSMode)(i,n,t)),e.javascript&&(g.javascript=(0,javascriptMode_1.getJavaScriptMode)(n,u,"javascript",t),g.typescript=(0,javascriptMode_1.getJavaScriptMode)(n,u,"typescript",t)),g[VueLanguageModeId.Style]=(0,vueStyleMode_1.getVueCSSMode)({clientCapabilities:a,fileSystemProvider:r},n,t),g[VueLanguageModeId.Template]=(0,vueTemplateMode_1.getVueTemplateMode)({clientCapabilities:a,fileSystemProvider:r},s,t);const l=(0,htmlDataProviderParticipant_1.getHTMLDataProviderParticipant)();return{async updateDataProviders(e){e.push(l),o.setDataProviders(!0,e)},getModeAtPosition(e,t){let a=c(n.get(e).getLanguageAtPosition(t));return a?g[a]:void 0},getModesInRange:(e,t)=>n.get(e).getLanguageRanges(t).map((e=>{let t=c(e.languageId);return{start:e.start,end:e.end,mode:t&&g[t],attributeValue:e.attributeValue}})),getAllModesInDocument(e){let t=[];for(let a of n.get(e).getLanguagesInDocument()){let e=c(a),r=e?g[e]:void 0;r&&t.push(r)}return t},getAllModes(){let e=[];for(let t in g){let a=g[t];a&&e.push(a)}return e},getMode:e=>g[e],onDocumentRemoved(e){d.forEach((t=>t.onDocumentRemoved(e)));for(let t in g)g[t].onDocumentRemoved(e)},dispose(){d.forEach((e=>e.dispose())),d=[];for(let e in g)g[e].dispose();g={}}}}__exportStar(require("vscode-html-languageservice"),exports),function(e){e.Style="vue-style",e.Script="vue-script",e.Template="vue-template"}(VueLanguageModeId=exports.VueLanguageModeId||(exports.VueLanguageModeId={})),exports.getLanguageModes=getLanguageModes;