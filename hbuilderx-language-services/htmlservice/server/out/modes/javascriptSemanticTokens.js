"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getSemanticTokens=exports.getSemanticTokenLegend=void 0;const ts=require("typescript");function getSemanticTokenLegend(){return 11!==tokenTypes.length&&console.warn("TokenType has added new entries."),4!==tokenModifiers.length&&console.warn("TokenModifier has added new entries."),{types:tokenTypes,modifiers:tokenModifiers}}function getSemanticTokens(e,t,n){let o=[];return collectTokens(e,n,{start:0,length:t.getText().length},((e,n,s)=>{o.push({start:t.positionAt(e.getStart()),length:e.getWidth(),typeIdx:n,modifierSet:s})})),o}function collectTokens(e,t,n,o){const s=e.getProgram();if(s){const a=s.getTypeChecker();function i(e){if(e&&ts.textSpanIntersectsWith(n,e.pos,e.getFullWidth())){if(ts.isIdentifier(e)){let t=a.getSymbolAtLocation(e);if(t){t.flags&ts.SymbolFlags.Alias&&(t=a.getAliasedSymbol(t));let n=classifySymbol(t);if(void 0!==n){let s=0;if(e.parent){tokenFromDeclarationMapping[e.parent.kind]===n&&e.parent.name===e&&(s=1)}const a=t.valueDeclaration,i=a?ts.getCombinedModifierFlags(a):0,r=a?ts.getCombinedNodeFlags(a):0;i&ts.ModifierFlags.Static&&(s|=2),i&ts.ModifierFlags.Async&&(s|=4),(i&ts.ModifierFlags.Readonly||r&ts.NodeFlags.Const||t.getFlags()&ts.SymbolFlags.EnumMember)&&(s|=8),o(e,n,s)}}}ts.forEachChild(e,i)}}const r=s.getSourceFile(t);r&&i(r)}}function classifySymbol(e){const t=e.getFlags();if(t&ts.SymbolFlags.Class)return 0;if(t&ts.SymbolFlags.Enum)return 1;if(t&ts.SymbolFlags.TypeAlias)return 5;if(t&ts.SymbolFlags.Type){if(t&ts.SymbolFlags.Interface)return 2;if(t&ts.SymbolFlags.TypeParameter)return 4}const n=e.valueDeclaration||e.declarations&&e.declarations[0];return n&&tokenFromDeclarationMapping[n.kind]}exports.getSemanticTokenLegend=getSemanticTokenLegend,exports.getSemanticTokens=getSemanticTokens;const tokenTypes=[];tokenTypes[0]="class",tokenTypes[1]="enum",tokenTypes[2]="interface",tokenTypes[3]="namespace",tokenTypes[4]="typeParameter",tokenTypes[5]="type",tokenTypes[6]="parameter",tokenTypes[7]="variable",tokenTypes[8]="property",tokenTypes[9]="function",tokenTypes[10]="member";const tokenModifiers=[];tokenModifiers[2]="async",tokenModifiers[0]="declaration",tokenModifiers[3]="readonly",tokenModifiers[1]="static";const tokenFromDeclarationMapping={[ts.SyntaxKind.VariableDeclaration]:7,[ts.SyntaxKind.Parameter]:6,[ts.SyntaxKind.PropertyDeclaration]:8,[ts.SyntaxKind.ModuleDeclaration]:3,[ts.SyntaxKind.EnumDeclaration]:1,[ts.SyntaxKind.EnumMember]:8,[ts.SyntaxKind.ClassDeclaration]:0,[ts.SyntaxKind.MethodDeclaration]:10,[ts.SyntaxKind.FunctionDeclaration]:9,[ts.SyntaxKind.MethodSignature]:10,[ts.SyntaxKind.GetAccessor]:8,[ts.SyntaxKind.PropertySignature]:8,[ts.SyntaxKind.InterfaceDeclaration]:2,[ts.SyntaxKind.TypeAliasDeclaration]:5,[ts.SyntaxKind.TypeParameter]:4};