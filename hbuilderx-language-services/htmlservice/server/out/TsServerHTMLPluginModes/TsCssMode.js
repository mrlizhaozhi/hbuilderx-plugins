"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CssEmbedMode=void 0;const vscode_uri_1=require("vscode-uri"),core_1=require("../../../../core"),HtmlExtraType_1=require("./HtmlExtraType");class CssEmbedMode{constructor(e,t,s){this.info=e,this.htmlCachesInProjectScope=t,this.styleLanguageServiceList=s,this.htmlTsStyleDefinitionSourceMap=new HtmlExtraType_1.HtmlTsDefinitionSourceMap(e,t)}initialize(e,t,s){const o=this.htmlCachesInProjectScope.getUpToDateInfo(e);if(!o)return;let i=o.htmlDocument,n=o.getEmbeddedDocument("css"),r="css";if(s){let e=s.parseHTMLDocument(i);if(3===e.roots.length){let t=e.roots[2].attributes;t&&t.lang&&(r=t.lang.slice(1,-1))}}["css","scss","less"].includes(r)||(r="css");let c=this.styleLanguageServiceList.get(r);if(!c)return;let l=c.parseStylesheet(n),u=n.positionAt(t);return{sourceDocument:i,cssDocument:n,stylesheet:l,position:u,languageServer:c}}getCompletionsAtPosition(e,t,s,o){const i=this.info,n=this.initialize(t,s);if(!n)return;n.sourceDocument;const r=n.languageServer,c=n.cssDocument,l=n.stylesheet,u=n.position;let a=r.doComplete(c,u,l);return(0,core_1.fromLspCompletions)(a,c,i.ts)}getCompletionEntryDetails(e,t,s,o,i,n,r,c){if(!n)return;let l=vscode_uri_1.URI.parse(n).query,u=JSON.parse(l);const a=this.info,m=this.initialize(t,s);if(!m)return;m.sourceDocument;const p=m.languageServer,f=m.cssDocument,g=m.stylesheet,h=m.position;let d={label:o,...u},D=p.doResolve(d,f,h,g);return(0,core_1.fromLspCompletionDetail)(D,f,a.ts)}getQuickInfoAtPosition(e,t,s){const o=this.info,i=this.initialize(t,s);if(!i)return;i.sourceDocument;const n=i.languageServer,r=i.cssDocument,c=i.stylesheet,l=i.position;let u=n.doHover(r,l,c);return(0,core_1.fromLspHover)(u,r,o.ts)}getSignatureHelpItems(e,t,s,o){}getDefinitionAndBoundSpan(e,t,s){const o=this.info,i=this.initialize(t,s);if(!i)return;i.sourceDocument;const n=i.languageServer,r=i.cssDocument,c=i.stylesheet,l=i.position;let u=n.tsFindDefinition(r,l,c);return(0,core_1.fromLspDefinition)(u,r,o,void 0)}getNavigationTree(e,t,s){this.info;const o=this.initialize(t,0,s);if(!o)return;o.sourceDocument;const i=o.languageServer,n=o.cssDocument,r=o.stylesheet;o.position;let c=i.findDocumentSymbols(n,r);return(0,core_1.fromLspNavigation)(c,n,this.info.ts,!1)}findReferences(e,t,s){}}exports.CssEmbedMode=CssEmbedMode;