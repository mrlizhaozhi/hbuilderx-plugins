"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.HtmlIdClassProvider=exports.registerHTMLPlugin=exports.enablePluginProxy=exports.LocationInfoKind=void 0;const vscode_html_languageservice_1=require("vscode-html-languageservice");var LocationInfoKind;function getLocationInfoAtPositionImpl(e,t,n,o){o||(o=e.parseHTMLDocument(t));let i=t.offsetAt(n);const a=o.findNodeBefore(i);if(!a)return;const s=t.getText(),r=e.createScanner(s,a.start);let c="",g="",d=r.scan();for(;d!==vscode_html_languageservice_1.TokenType.EOS&&r.getTokenOffset()<=i;){switch(d){case vscode_html_languageservice_1.TokenType.StartTagOpen:if(r.getTokenEnd()===i){const e=T(vscode_html_languageservice_1.TokenType.StartTag);return{activeRange:{start:t.positionAt(i),end:t.positionAt(e)},kind:LocationInfoKind.StartTagOpen,position:n}}break;case vscode_html_languageservice_1.TokenType.StartTag:if(r.getTokenOffset()<=i&&i<=r.getTokenEnd())return{activeRange:{start:t.positionAt(r.getTokenOffset()),end:t.positionAt(r.getTokenEnd())},kind:LocationInfoKind.StartTag,activeTag:r.getTokenText(),position:n};c=r.getTokenText();break;case vscode_html_languageservice_1.TokenType.AttributeName:if(r.getTokenOffset()<=i&&i<=r.getTokenEnd())return{activeRange:{start:t.positionAt(r.getTokenOffset()),end:t.positionAt(r.getTokenEnd())},kind:LocationInfoKind.AttributeName,activeTag:c,activeAttribute:r.getTokenText(),position:n};g=r.getTokenText();break;case vscode_html_languageservice_1.TokenType.DelimiterAssign:if(r.getTokenEnd()===i){const e=T(vscode_html_languageservice_1.TokenType.AttributeValue);return{activeRange:{start:t.positionAt(i),end:t.positionAt(e)},kind:LocationInfoKind.AttributeValue,activeTag:c,activeAttribute:g,position:n}}break;case vscode_html_languageservice_1.TokenType.AttributeValue:if(r.getTokenOffset()<=i&&i<=r.getTokenEnd()){let e=r.getTokenText(),o=0;return(e.startsWith("'")||e.startsWith('"'))&&(o=1),{activeRange:{start:t.positionAt(r.getTokenOffset()+o),end:t.positionAt(r.getTokenEnd()-o)},kind:LocationInfoKind.AttributeValue,activeTag:c,activeAttribute:g,position:n}}break;case vscode_html_languageservice_1.TokenType.Whitespace:if(i<=r.getTokenEnd())switch(r.getScannerState()){case vscode_html_languageservice_1.ScannerState.AfterOpeningStartTag:const e=r.getTokenOffset(),o=T(vscode_html_languageservice_1.TokenType.StartTag);return{activeRange:{start:t.positionAt(e),end:t.positionAt(o)},kind:LocationInfoKind.StartTagOpen,position:n};case vscode_html_languageservice_1.ScannerState.WithinTag:case vscode_html_languageservice_1.ScannerState.AfterAttributeName:return{activeRange:{start:t.positionAt(r.getTokenEnd()),end:t.positionAt(r.getTokenEnd())},kind:LocationInfoKind.AttributeName,activeTag:c,position:n};case vscode_html_languageservice_1.ScannerState.BeforeAttributeValue:return{activeRange:{start:t.positionAt(r.getTokenEnd()),end:t.positionAt(r.getTokenEnd())},kind:LocationInfoKind.AttributeValue,activeTag:c,activeAttribute:g,position:n};case vscode_html_languageservice_1.ScannerState.AfterOpeningEndTag:return{activeRange:{start:t.positionAt(r.getTokenOffset()-1),end:t.positionAt(r.getTokenOffset()-1)},kind:LocationInfoKind.EndTagOpen,activeTag:c,activeAttribute:g,position:n};case vscode_html_languageservice_1.ScannerState.WithinContent:return{activeRange:{start:t.positionAt(i),end:t.positionAt(r.getTokenEnd())},kind:LocationInfoKind.InsideContent,activeTag:c,activeAttribute:g,position:n}}break;case vscode_html_languageservice_1.TokenType.EndTagOpen:if(i<=r.getTokenEnd()){const e=r.getTokenOffset()+1,o=T(vscode_html_languageservice_1.TokenType.EndTag);return{activeRange:{start:t.positionAt(e),end:t.positionAt(o)},kind:LocationInfoKind.EndTagOpen,activeTag:c,activeAttribute:g,position:n}}break;case vscode_html_languageservice_1.TokenType.EndTag:if(i<=r.getTokenEnd()){let e=r.getTokenOffset()-1;for(;e>=0;){const o=s.charAt(e);if("/"===o)return{activeRange:{start:t.positionAt(e),end:t.positionAt(r.getTokenEnd())},kind:LocationInfoKind.EndTag,activeTag:c,activeAttribute:g,position:n};if(!/^\s*$/.test(o))break;e--}}break;case vscode_html_languageservice_1.TokenType.StartTagClose:if(i<=r.getTokenEnd()&&c)return{activeRange:{start:t.positionAt(r.getTokenEnd()),end:t.positionAt(r.getTokenEnd())},kind:LocationInfoKind.EndTagOpen,activeTag:c,activeAttribute:g,position:n};break;case vscode_html_languageservice_1.TokenType.Content:if(i<=r.getTokenEnd())return{activeRange:{start:t.positionAt(r.getTokenOffset()),end:t.positionAt(r.getTokenEnd())},kind:LocationInfoKind.InsideContent,activeTag:c,activeAttribute:g,position:n};break;default:if(i<=r.getTokenEnd())return}d=r.scan()}function T(e){return i===r.getTokenEnd()&&(d=r.scan(),d===e&&r.getTokenOffset()===i)?r.getTokenEnd():i}}!function(e){e[e.StartTagOpen=0]="StartTagOpen",e[e.StartTag=1]="StartTag",e[e.EndTagOpen=2]="EndTagOpen",e[e.EndTag=3]="EndTag",e[e.AttributeName=4]="AttributeName",e[e.AttributeValue=5]="AttributeValue",e[e.InsideContent=6]="InsideContent"}(LocationInfoKind||(LocationInfoKind={})),exports.LocationInfoKind=LocationInfoKind;const g_htmlPlugins=[];function enablePluginProxy(e){let t=e.languageService;return t.doResolve=function(e,t,n,o){return e},t.getLocationInfoAtPosition=function(e,n,o){return getLocationInfoAtPositionImpl(t,e,n,o)},t.findDefinition=function(e,t,n){},t.isFollowedBy=function(e,n,o,i){for(var a=t.createScanner(e,n,o),s=a.scan();s===vscode_html_languageservice_1.TokenType.Whitespace;)s=a.scan();return s===i},g_htmlPlugins.forEach((n=>{t=n.create({languageService:t,project:e.project})})),t}function registerHTMLPlugin(e){g_htmlPlugins.push(e)}exports.enablePluginProxy=enablePluginProxy,exports.registerHTMLPlugin=registerHTMLPlugin;class HtmlIdClassProvider{constructor(e){this.htmlCachesInProjectScope=e}getEmbedCssDocument(e){const t=this.htmlCachesInProjectScope.getUpToDateInfo(e.uri);if(!t)return;const n=t.getEmbeddedDocument("css");if(e!==t.htmlDocument)return;let o=[];return o.push({document:n,sourceMap:void 0}),o}getSourceDocument(e){return this.htmlCachesInProjectScope.getSourceFileFromEmbeddedFileName(e.uri)}}exports.HtmlIdClassProvider=HtmlIdClassProvider;