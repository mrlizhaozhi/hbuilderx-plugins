"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getNodeFSRequestService=void 0;const requests_1=require("../requests"),vscode_uri_1=require("vscode-uri"),fs=require("fs"),vscode_css_languageservice_1=require("vscode-css-languageservice");function getNodeFSRequestService(){function e(e){if("file"!==(0,requests_1.getScheme)(e))throw new Error("fileRequestService can only handle file URLs")}return{getContent:(s,i)=>(e(s),new Promise(((e,r)=>{const c=vscode_uri_1.URI.parse(s);fs.readFile(c.fsPath,i,((s,i)=>{if(s)return r(s);e(i.toString())}))}))),stat:s=>(e(s),new Promise(((e,i)=>{const r=vscode_uri_1.URI.parse(s);fs.stat(r.fsPath,((s,r)=>{if(s)return"ENOENT"===s.code?e({type:vscode_css_languageservice_1.FileType.Unknown,ctime:-1,mtime:-1,size:-1}):i(s);let c=vscode_css_languageservice_1.FileType.Unknown;r.isFile()?c=vscode_css_languageservice_1.FileType.File:r.isDirectory()?c=vscode_css_languageservice_1.FileType.Directory:r.isSymbolicLink()&&(c=vscode_css_languageservice_1.FileType.SymbolicLink),e({type:c,ctime:r.ctime.getTime(),mtime:r.mtime.getTime(),size:r.size})}))}))),readDirectory:s=>(e(s),new Promise(((e,i)=>{const r=vscode_uri_1.URI.parse(s).fsPath;fs.readdir(r,{withFileTypes:!0},((s,r)=>{if(s)return i(s);e(r.map((e=>e.isSymbolicLink()?[e.name,vscode_css_languageservice_1.FileType.SymbolicLink]:e.isDirectory()?[e.name,vscode_css_languageservice_1.FileType.Directory]:e.isFile()?[e.name,vscode_css_languageservice_1.FileType.File]:[e.name,vscode_css_languageservice_1.FileType.Unknown])))}))})))}}exports.getNodeFSRequestService=getNodeFSRequestService;