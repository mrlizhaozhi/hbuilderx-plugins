"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.deactivate=exports.activate=void 0;const nodeFs_1=require("./nodeFs"),vscode_1=require("vscode"),htmlClient_1=require("../htmlClient"),node_1=require("vscode-languageclient/node"),util_1=require("util"),fs=require("fs"),client_1=require("../../../../utils/client");function activate(e){const t=`./htmlservice/server/${-1!==getPackageInfo(e).main.indexOf("/dist/")?"dist":"out"}/node/htmlServerMain`,n=e.asAbsolutePath(t);let o;o=e.extensionMode==vscode_1.ExtensionMode.Development?{execArgv:["--nolazy","--inspect=16044"]}:{execArgv:["--nolazy"]};const i={run:{module:n,transport:node_1.TransportKind.ipc},debug:{module:n,transport:node_1.TransportKind.ipc,options:o}};(0,htmlClient_1.startClient)(e,((e,t,n)=>new client_1.HXLanguageClient(e,t,i,n)),{fs:(0,nodeFs_1.getNodeFSRequestService)(),TextDecoder:util_1.TextDecoder})}function deactivate(){}function getPackageInfo(e){const t=e.asAbsolutePath("./htmlservice/package.json");try{return JSON.parse(fs.readFileSync(t).toString())}catch(e){return console.log(`Problems reading ${t}: ${e}`),{name:"",version:"",aiKey:"",main:""}}}exports.activate=activate,exports.deactivate=deactivate;